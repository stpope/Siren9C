<H3>Siren 9C Workbook</H3><hr><h3 id="IntroductiontothisOutline">1 - Introduction to this Outline</h3>Introduction to the Siren 9C Workbook</br>
</br>
Welcome to Siren 9C!</br>
</br>
What is this?</br>
</br>
This document is the Siren user's guide. This manual is available as a web site for on-line browsing (see http://FASTLabInc.com/Siren or https://github.com/stpope/Siren9C), or from within the Smalltalk run-time system in a workspace outline view (the best way to read it).</br>
</br>
Throughout this document, there are executable Smalltalk expressions, which are generally enclosed in square brackets, as in</br>
</br>
&emsp;[ some code ]</br>
</br>
If you are reading this text within Smalltalk, you can select this text by double-clicking on either of the square brackets, and then using the pop-up contextual menu to evaluate the expression (see the menu items "do it," "print it,"  "inspect it," or "debug it"). There is a more complete description of how to use these features in the section below on getting started. </br>
</br>
Who is this intended for?</br>
</br>
Before we start, readers should be reminded that Siren is a Smalltalk-80-based programming framework for developing music/sound applications. Siren is not an application in itself. The ideal user will be literate in some object-oriented programming language, and possess at least a moderate understanding of musical terms.</br>
</br>
For those unfamiliar with the syntax of Smalltalk, there is a section at the end of this outline (page 39) that introduces the language.</br>
</br>
How do I use this tool?</br>
</br>
If you're reading this within Siren, the window is a workspace-list view. You can select different pages of the outline from the list above, and scroll within a page in this lower view. You can move the horizontal divider line (above) if you want a smaller topic list and larger text view.</br>
</br>
----</br>
</br>
Stephen Travis Pope (stephen@HeavenEverywhere.com)</br>
Munich, October 1984 - Santa Barbara, May 1996-May 2020 - Ojai, January 2023</br>
</p><hr><h3 id="Siren9Overview">2 - Siren 9 Overview</h3>What is Siren?</br>
</br>
The Siren system is a software framework for music and sound composition, processing, performance, and analysis; it is a collection of 200-350 classes (depending on which version and platform you're using) written in Smalltalk-80 (40 kLOC or so). Siren 9C works on Squeak Smalltalk (https://squeak.org) and (to varying degrees) on the Cuis and VisualWorks Smalltalk implementations. Siren-on-Squeak supports streaming I/O via OpenSoundControl (OSC), MIDI, and multi-channel audio ports.  Siren-on-Cuis supports the GUI tools, but not the full MIDI I/O facilities.  Squeak is expected to be the main platform for on-going development.</br>
</br>
The Siren release is available via the web from the URL https://github.com/stpope/Siren9C.  Note that you need a Squeak Smalltalk virtual machine and run-time to use Siren; you can get one of these for your desired host platform from https://github.com/OpenSmalltalk/opensmalltalk-vm/releases.  If you want to use the MIDI I/O, you'll need a compiled file of the MIDI primitives for your platform; the C-language source for these is included with the release, as is a compiled library for M1-based Macs (libportmidi.2.0.3.dylib).</br>
</br>
Siren is a programming framework and tool kit; the intended audience is Smalltalk developers, or users willing to learn Smalltalk in order to write their own applications. The built-in applications are meant as demonstrations of the use of the libraries, rather than as end-user applications. Siren is not a MIDI sequencer, nor a score notation editor, through both of these applications would be straightforward to implement with the Siren framework.</br>
</br>
There are several elements to Siren:</br>
&emsp;1. The Smoke music representation language</br>
&emsp;&emsp;(object models for music magnitudes, events, event lists, generators, functions, and sounds);</br>
&emsp;2. Voices, schedulers and I/O drivers</br>
&emsp;&emsp;(real-time and file-based "voice" objects for sound, score file, OSC, and MIDI I/O);</br>
&emsp;3. User interface components for musical applications</br>
&emsp;&emsp;(a music/audio UI framework, tools, and widgets);</br>
&emsp;4. Several built-in applications </br>
&emsp;&emsp;(editors and browsers for Smoke objects); and</br>
&emsp;5. External library interfaces for streaming I/O and DSP math</br>
&emsp;&emsp;(sound/MIDI/OSC I/O, fast FFT, CSL & Loris sound analysis/resynthesis packages )</br>
</br>
Each of these components is described below in its own section of this document.</br>
</br>
If you can read a bit of Smalltalk and want a quick tour before proceeding, read the condensed "Siren Demo Script" that's on page 32 of this outline.</br>
</br>
Where's More Documentation?</br>
</br>
Siren and its predecessors and components (ARA, DoubleTalk, HyperScore ToolKit, and MODE) are documented in several extended book chapters and articles:</br>
&emsp;-- "Squeak: Open Personal Computing and Multimedia" (Mark Guzdial and Kim </br>
&emsp;&emsp;Rose, eds, Prentice-Hall, 2002);</br>
&emsp;--  "Musical Signal Processing" (C. Roads, S. T. Pope, G. DePoli, and A. Piccialli, </br>
&emsp;&emsp;eds. Swets & Zeitlinger, 1997);</br>
&emsp;--  "The Interim DynaPiano" in "Computer Music Journal" 16:3, Fall, 1992 </br>
&emsp;&emsp;(also on the CMJ Web site);</br>
&emsp;-- "The Well-Tempered Object: Musical Applications of Object-Oriented Software </br>
&emsp;&emsp;Technology" (S. T. Pope, ed. MIT Press, 1991); and the </br>
&emsp;-- Proceedings of the 1986, 1987, 1989, 1991, 1992, 1994, 1996, 1997, 2003 and 2022</br>
&emsp;&emsp;International Computer Music Conferences (ICMCs).</br>
</br>
Mny more MODE- and Smoke-related documents (including the above references) are available in the Doc folder of this release or as PDF files on the page http://HeavenEverywhere.com/stp/publs.html.</br>
</br>
The official Siren home pages are,</br>
&emsp;http://FASTLabInc.com/Siren</br>
and</br>
&emsp;https://github.com/stpope/Siren9C</br>
</br>
Here are the on-line Docs: the best in-depth doc (book chapter) is in,</br>
&emsp;http://FASTLabInc.com/Siren/Doc/SirenBookChapter.pdf</br>
</br>
The read the demo code workbook (this text), go to,</br>
&emsp;http://FASTLabInc.com/Siren/Siren9C.Workbook.html</br>
</br>
If you like to read manuals, take a look at the auto-generated Siren 7.5 manual,</br>
&emsp;http://FASTLabInc.com/Siren/Manual</br>
</br>
Watch the detailed Siren demos at,</br>
&emsp;https://vimeo.com/120751122</br>
&emsp;https://vimeo.com/421319630</br>
</br>
History</br>
</br>
Siren and its predecessors stem from music systems that I've developed in the process of composing and realizing my music. Of the early ancestors, the MShell (1980-83) was the score processing shell used for "4" (1980-82); ARA (1982-4) was an outgrowth of the Lisp system used for "Bat out of Hell" (1983); the DoubleTalk system (1984-7) was based on the Smalltalk-80-based Petri net editing system used for "Requiem Aeternam dona Eis" (1986); the HyperScore ToolKit's various versions (1986-90) were used (among others) for "Day" (1988), and the MODE (1990-96) was developed to realize "Kombination XI" (1990) and "Paragraph 31: All Gates are Open" (1993).</br>
</br>
Siren-on-Squeak (1996-2002) was a simple re-implementation of the MODE in the Squeak version of Smalltalk; it added the representations and tools I needed for "Four Magic Sentences" (1998-2000).  Siren 7.4 added tools from the realizations of "Eternal Dream" (2002) and "Leur Songe de la Paix" (2003).  The newest release incorporates new code from "Jerusalem's Secrets" and "Ora penso invece che il mondo..." (2005-6), which are both components of "Secrets, Dreams, Fiath and Wonder (2000-18).  In each of these cases, some amount of effort was spent--after the completion of the composition--to make the tools more general-purpose. </br>
</br>
Portability</br>
</br>
The Smalltalk portion of Siren is 100% cross-platform, and the external interfaces to sound file, MIDI, and sound streaming I/O use cross-platform libraries. There are a few places (aubio, SHARC interfaces) that assume UNIX shell commands can be run from within Smalltalk; I'm not certain how these port to Windows.</br>
</br>
The core of Siren is not dependent on the dialect of Smalltalk, and in fact, runs well in Squeak, VisualWorks and Cuis. The bulk of the interactive tools and GUIs are based on my own display list graphics framework, and are thus also portable. The actual integrated applications and GUIs in Siren 9.0 used VisualWorks-specific application model classes, though.  The porting of the GUIs to Squeak is in-progress at the time of this writing.</br>
</p><hr><h3 id="GettingStartedusingSiren">3 - Getting Started using Siren</h3>Getting Started with Siren</br>
</br>
Depending on what your background, you may take any one of several paths to get started with Siren. </br>
</br>
RTFM: Please read the in-depth book chapter,</br>
&emsp;http://FASTLabInc.com/Siren/Doc/SirenBookChapter.pdf</br>
</br>
This workbook is also available on-line at,</br>
&emsp;http://fastlabinc.com/Siren/Workbook</br>
</br>
If you're impatient to see what Siren can do, jump ahead to the demo script near the end of this outline (Chapter 32 or so).</br>
</br>
If you're a literate programmer, but unfamiliar with the Smalltalk language or environment, skip ahead to the short introduction to reading the Smalltalk language at the end of this document.</br>
</br>
If you're an experienced Smalltalk developer, I encourage you to read through the rest of this document, and use the in-line code examples as starting points to explore the implementation classes. Use the pop-up menu item "debug it" to get right into the code.</br>
</br>
Executing code: do-it, print-it, inspect-it and debug-it</br>
</br>
As a very simple introduction, look at the following line of code</br>
&emsp;3 + 4</br>
this is a perfectly well-formed Smalltalk program. To execute it, you simply have to select the text, and then use the pop-up contextual menu to compile and run it; we call this "do-it" in the menu. Try selecting the above line and selecting the menu item "do-it."</br>
</br>
You might notice that nothing visible happened. The system happily compiled and executed the program, but then threw away the result. To print the result object from an expression, use the menu item "print-it." Try this again with the above example code. This should now have printed the string "7" at the end of the text you selected.</br>
</br>
To make text selection easier in this outline, I generally enclose text that's intended as a code example in square brackets (to make selecting the code easier -- you simply need to click on the opening or closing brackets). In many cases, I also place a "d,", "p," "i," or "db" after the text to give you a hint as to whether to do-it, print-it, inspect-it, or debug-it. Try this on the examples below.</br>
</br>
&emsp;[ 3 + 4 ] d</br>
&emsp;[ 3 + 4 ] p</br>
</br>
&emsp;[ 100 factorial ] p</br>
&emsp;[ 100 factorial ] i</br>
</br>
Now try looking at the code of a Siren event list example; say "debug-it" to the expression below, which will bring up the code in a debugger; in this view, use the menu bar below the top-most stack list to "step-into" the block; now you'll be looking at the randomExample: method itself. You can use the "into"| and "over" buttons to single step through this method, inspecting the objects in use with the inspectors at the bottom of the debugger.</br>
</br>
&emsp;[ EventList randomExample: 20 ] db</br>
</br>
On most platforms, command-key (or ctrl-key or whatever) combinations are available, for example:</br>
</br>
&emsp;cmd+d&emsp;=&emsp;do-it (execute the selected code)</br>
&emsp;cmd+p&emsp;=&emsp;print-it (execute the selected code and print the result)</br>
&emsp;cmd+i&emsp;=&emsp;inspect-it (execute the selected code and open an inspector on the result)</br>
&emsp;cmd+I&emsp;=&emsp;explore-it (an alternative inspector)</br>
</br>
These last 2 are the most impoerant as ways to start learning the design of Siren:</br>
&emsp;&emsp;&emsp;</br>
&emsp;cmd+D=&emsp;debug-it (open a debugger on the selected code)</br>
&emsp;cmd+b&emsp;=&emsp;browse-it (open a source code on the selected code)</br>
</br>
Note the operation of the "browse-it" command; it expects that you have selected an expression with 2 tokens, typically a class constructor message for one of the demos, as in</br>
</br>
&emsp;[EventList randomExample] b</br>
</p><hr><h3 id="SirenSetupandTesting">4 - Siren Setup and Testing</h3>Setting up Siren</br>
</br>
To test the Siren set-up and I/O, open the configuration/test panel,</br>
</br>
&emsp;[SirenSession openUtility] d </br>
</br>
</br>
or the narrower vertical version</br>
</br>
&emsp;[SirenSession openUtilityVert] d </br>
</br>
</br>
You can see the system configuration and test the MIDI, sound file, and sound IO here.  If you use MIDI, use the left (or top) row of buttons to set it up and test it. The 2nd row of buttons is used to test sound IO.  There's a section below in this workbook about the Siren utility and transport panes.</br>
</br>
The right-most (bottom) buttons are important utilities. The "clean up" button stops the scheduler and shuts down MIDI and sound IO (for use in an emergency).</br>
</br>
Normally, one wants to establish MIDI connectivity first; the top/left most button on the panel says "Configure MIDI" and has sub-menus to reset/initialize the MIDI driver, and to select the default I/O devices.  If you choose the "reset" option, it should print your MIDI device table in the Transcript; test this.  Below this, the test button allows you to test simple MIDI I/O.  Make sure this works before trying any of the more advanced MIDI Examples.</br>
</br>
</br>
</br>
</br>
Special initialization</br>
</br>
See the method SirenUtility class initialize [SirenUtility initialize] b, with which you can customize Siren so that it finds your devices, servers, and data files. See especially the lines,</br>
</br>
&emsp;DefaultMIDIIn := 4.&emsp;&emsp;&emsp;&emsp;&emsp;"Tune these to your setup"</br>
&emsp;DefaultMIDIOut := 10.</br>
&emsp;DefaultOSCHost := #[127 0 0 1].</br>
&emsp;DefaultOSCPort := 54321.</br>
&emsp;Verbosity := 1.&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"0 = pretty silent, only error logging;</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; 1 = medium-verbose IO interface logging; </br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; 2 = full scheduler and verbose interface logging"</br>
&emsp;[...]</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"Set search paths"</br>
&emsp;self addDir: 'Databases' to: SoundDir.&emsp;"STP-specific"</br>
&emsp;self addDir: '3-Credo/*' to: SoundDir.&emsp;"You can add using wildcards"</br>
</br>
</br>
</br>
Setting up the External Interfaces</br>
</br>
Siren uses several external interfaces (based on the user primitives) for access to external data and I/O. The Smalltalk code for these interfaces is in the category MusicIO-External. The external libraries Siren uses are:</br>
</br>
&emsp;Streaming MIDI I/O -- PortMidi -- see https://github.com/PortMidi/portmidi</br>
</br>
(In the past there were several more required libraries, but luckily sound I/O, FFT and several other facilities have been included in recent Smalltalks.)</br>
</br>
You need to have these libraries installed (normally in a directory such as /usr/local/lib), and compile and link the C-language interface libraries in the subdirectory DLLCC for sound or MIDI I/O to work with Siren. Binaries are available for Mac OSX. There are full sources and pre-compiled versions of the required libraries on the CSL web site; look at http://FASTLabInc.com/CSL.</br>
</br>
To get CSL visit, &emsp;http://FASTLabInc.com/CSL   or   https://github.com/stpope/CSL7</br>
</br>
</br>
Testing MIDI I/O</br>
</br>
This will open the MIDI driver and play a note; printing messages to the Transcript.</br>
&emsp;[MIDIPort testANote]</br>
</br>
</br>
Test this using a MIDI dump utility (such as MIDIMonitor), or a soft-synth, or outboard MIDI hardware. There are many other tests in class MIDIPort.</br>
</br>
Testing OpenSoundControl output</br>
</br>
</br>
The following example will send out a few OSC messages; test it with a dumpOSC utility, or with the CSL OSC server example. There are many other tests in class OSCVoice.</br>
&emsp;[OSCVoice vSOSExample3]</br>
</br>
Testing sound file I/O</br>
</br>
</br>
This should play a sound file (accellerated German)</br>
&emsp;[SirenSession testSoundFiles]</br>
</br>
</br>
Testing the Siren scheduler</br>
</br>
</br>
To test the built-in real-time scheduler, try the following block, which will display colored rectangles on the top window for 5 seconds, then refresh the screen.</br>
&emsp;[ActionEvent playExample]</br>
</br>
If nothing happens, or the screen goes white, or anything else unexpected occurs, you can always interrupt the system by typing cmd+. (CMD-DOT) and using the utility window button "stop exheculer" button to clear the event schedule.</br>
</br>
</br>
</br>
MIDI/Sound Configuration</br>
</br>
Siren's MIDI support depends on a platform-independent interface class that talks to VM-side primitives that talk to OS-level device drivers. There are class settings in MIDIPort for the default I/O devices.</br>
</br>
Smalltalk Options</br>
</br>
There are several configurable parts to Siren. Class SirenUtility is the general place to find utility messages related to Siren set-up and global variables. Look at its class variables and initialization method. </br>
</br>
Several of the voice classes have "default" methods that return a default instance. Look at MIDIVoice default, and Voice default.</br>
</br>
Siren looks in default directory for scores and sound files. By default this is called "Data" and is a sub-folder of the folder where the virtual image is executing. There are methods in class SirenUtility to change this. </br>
</br>
Useful Utilities</br>
</br>
There are several sound/MIDI utilities that Siren users generally need; these include:</br>
&emsp;a MIDI dump utility such as MIDIMonitor from Snoize;</br>
&emsp;an OSC dump utility such as dumpOSC from CNMAT;</br>
&emsp;an OSC send script such as sendOSC from CNMAT; and</br>
&emsp;an audio patching utility such as Jack or Audio Hijack.</br>
</br>
Siren House-keeping</br>
</br>
To clear out temp. event lists, use,</br>
&emsp;[SirenSession flushTempEventLists]</br>
</br>
</br>
or to flush all,</br>
&emsp;[SirenSession instance freeLists]</br>
</br>
To flush and close down the scheduler,</br>
&emsp;[Schedule interrupt; flush; release]</br>
</br>
To send MIDI all notes off, flush ports, throw away open ports, clear out temp event lists, etc.</br>
&emsp;[MIDIPort cleanUp]</br>
</br>
Check here to see if there are any left-over objecgts being held onto,</br>
&emsp;[DependentsFields inspect]</br>
</p><hr><h3 id="SirenDesignOverview">5 - Siren Design Overview</h3>Siren Design Notes</br>
</br>
There are several elements to Siren:</br>
&emsp;1. The Smoke music representation language</br>
&emsp;&emsp;(object models for music magnitudes, events, event lists, generators, functions, and sounds);</br>
&emsp;2. Voices, schedulers and I/O drivers</br>
&emsp;&emsp;(real-time and file-based "voice" objects for sound, score file, OSC, and MIDI I/O);</br>
&emsp;3. User interface components for musical applications</br>
&emsp;&emsp;(a music/audio UI framework, tools, and widgets);</br>
&emsp;4. Several built-in applications </br>
&emsp;&emsp;(editors and browsers for Smoke objects); and</br>
&emsp;5. External library interfaces for streaming I/O and DSP math</br>
&emsp;&emsp;(sound/MIDI/OSC I/O, fast FFT, CSL & Loris sound analysis/resynthesis packages )</br>
</br>
</br>
Siren Design Patterns</br>
</br>
To understand Siren's design, you should be familiar with the terminology of object-oriented design patterns, as laid out in the books "Design Patterns: Elements of Reusable Object-Oriented Software" (Gamma, Helm, Johnson, and Vlissides, Addison-Wesley 1995), and "The Design Patterns Smalltalk Companion" (Alpert, Brown, and Woolf, Addison-Wesley 1998).</br>
</br>
The following list introduces the design patterns found in Siren, and gives the parts of the system where they are used and a brief definition of each.</br>
</br>
Composite -- events/event lists, display items/display lists -- class structure for building tree-like hierarchies of objects</br>
</br>
Adaptor -- voices, ports, graphics -- interface objects translate between message protocol "languages"</br>
</br>
Singleton -- ports, scheduler, external interfaces -- a class is limited to having a single well-known instance.</br>
</br>
Decorator -- event modifiers, voices, layout -- one object "wraps" another and forwards messages sent to it.</br>
</br>
Observer -- MVC, MIDI -- an object registers istelf as an "observer" of some aspect of another object, wanting to get update messages when the observed object changes.</br>
</br>
Strategy -- layout managers, event generators, voices -- a set of classes provide a family of algorithms that encapsulate their client objects.</br>
</br>
Proxy -- voices, ports, Smoke -- one object serves as a representative of another in some context.</br>
</br>
Chain of Responsibility -- MVC, voices, input -- object-oriented recursion iterates through tree structures using composed command objects.</br>
</br>
Visitor -- Smoke, voices, graphics -- active objects traverse data structures operating on them.</br>
</br>
Double-dispatching -- Smoke -- polymorphic operators support mixed-mode operations among families of classes.</br>
</br>
Multi-threading -- scheduler</br>
</br>
</br>
</br>
The Siren Class Categories</br>
</br>
The list below is the class categories (akin to sub-packages) in  Siren; this is how the classes are organized.</br>
</br>
Music-Models-Representation -- abstract music magnitude models</br>
Music-Models-Implementation -- music magnitude implementation classes</br>
Music-Events -- central event classes, EventLists</br>
Music-EventGenerators -- EventGenerators: chords, clouds, etc.</br>
Music-EventModifiers -- EventModifiers: rubato, swell</br>
Music-Functions -- functions of time</br>
Music-Sound -- abstract and concrete sound classes</br>
Music-PitchClasses -- Pitch classes (octave-independent pitch notation), chords and key signatures</br>
Music-PitchScales -- Scales and harmony</br>
Music-Support -- Scheduler, Utility, Session classes, abstract device, port and editor models</br>
</br>
MusicIO-Voices -- Voice hierarchy</br>
MusicIO-MIDI -- MIDI voices and devices</br>
MusicIO-OSC -- OSC streams</br>
</br>
MusicUI-DisplayLists -- Core display items and list</br>
MusicUI-DisplayListViews -- Basic DL views</br>
MusicUI-Editors -- Music editors and support</br>
MusicUI-Functions -- Function editors</br>
MusicUI-Layout -- Layout managers for various notations</br>
</br>
VisualWorks only:</br>
</br>
</br>
MusicApps-CSL -- Support for the CREATE Signal Library (CSL)</br>
MusicApps-Loris -- Support for the Loris analysis/resynthesis package</br>
MusicApps-LPC -- Rudimentary support for linear predictive coding</br>
MusicApps-SHARC -- Readers for the Sandell Harmonic Archive timbre database</br>
</br>
The primary class hierarchies of Siren are given below grouped into categories. The text indentation signifies sub/super-class relationships, and instances variable names are shown.</br>
</br>
Music Magnitude Models</br>
</br>
&emsp;Magnitude</br>
&emsp;&emsp;MusicMagnitude -- value</br>
&emsp;&emsp;&emsp;MusicModel -- class generality table</br>
&emsp;&emsp;&emsp;&emsp;Chroma</br>
&emsp;&emsp;&emsp;&emsp;&emsp;ModeMember</br>
&emsp;&emsp;&emsp;&emsp;&emsp;Pitch</br>
&emsp;&emsp;&emsp;&emsp;Chronos</br>
&emsp;&emsp;&emsp;&emsp;&emsp;Duration</br>
&emsp;&emsp;&emsp;&emsp;&emsp;Meter</br>
&emsp;&emsp;&emsp;&emsp;Ergon</br>
&emsp;&emsp;&emsp;&emsp;&emsp;Amplitude</br>
&emsp;&emsp;&emsp;&emsp;Positus</br>
&emsp;&emsp;&emsp;&emsp;&emsp;Directionality</br>
&emsp;&emsp;&emsp;&emsp;&emsp;Position</br>
&emsp;&emsp;&emsp;&emsp;&emsp;Spatialization</br>
</br>
Music Magnitude Implementations</br>
</br>
&emsp;Magnitude</br>
&emsp;&emsp;MusicMagnitude -- value</br>
&emsp;&emsp;&emsp;ConditionalDuration</br>
&emsp;&emsp;&emsp;NominalMagnitude</br>
&emsp;&emsp;&emsp;&emsp;SymbolicLoudness</br>
&emsp;&emsp;&emsp;&emsp;SymbolicPitch</br>
&emsp;&emsp;&emsp;NumericalMagnitude</br>
&emsp;&emsp;&emsp;&emsp;HertzPitch</br>
&emsp;&emsp;&emsp;&emsp;IntervalMagnitude</br>
&emsp;&emsp;&emsp;&emsp;&emsp;MIDIPitch</br>
&emsp;&emsp;&emsp;&emsp;&emsp;MIDIVelocity</br>
&emsp;&emsp;&emsp;&emsp;MSecondDuration</br>
&emsp;&emsp;&emsp;&emsp;&emsp;SecondDuration</br>
&emsp;&emsp;&emsp;&emsp;RatioMagnitude -- relative</br>
&emsp;&emsp;&emsp;&emsp;&emsp;RatioDuration</br>
&emsp;&emsp;&emsp;&emsp;&emsp;RatioLoudness</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;DBLoudness</br>
&emsp;&emsp;&emsp;&emsp;&emsp;RatioPitch</br>
&emsp;&emsp;&emsp;OrdinalMagnitude -- table</br>
&emsp;&emsp;&emsp;&emsp;Length</br>
&emsp;&emsp;&emsp;&emsp;Sharpness</br>
&emsp;&emsp;&emsp;PField -- name  field</br>
</br>
Events</br>
</br>
&emsp;AbstractEvent -- properties</br>
&emsp;&emsp;DurationEvent -- duration</br>
&emsp;&emsp;&emsp;ActionEvent -- action</br>
&emsp;&emsp;&emsp;MusicEvent -- pitch  loudness  voice</br>
&emsp;&emsp;&emsp;&emsp;EventList -- events  index  startedAt</br>
</br>
EventLists</br>
</br>
&emsp;AbstractEvent -- properties</br>
&emsp;&emsp;DurationEvent -- duration</br>
&emsp;&emsp;&emsp;MusicEvent -- pitch  loudness  voice</br>
&emsp;&emsp;&emsp;&emsp;EventList -- events  index  startedAt</br>
&emsp;&emsp;&emsp;&emsp;&emsp;EventGenerator</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Cloud -- density</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;DynamicCloud</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;SelectionCloud</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;DynamicSelectionCloud</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Cluster</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Chord -- root  inversion</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Arpeggio -- delay</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Roll -- number  delta  noteDuration</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Trill</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;Ostinato -- list  playing  process</br>
</br>
Functions</br>
</br>
&emsp;AbstractEvent -- properties</br>
&emsp;&emsp;DurationEvent -- duration</br>
&emsp;&emsp;&emsp;Function -- data  range  domain</br>
&emsp;&emsp;&emsp;&emsp;FourierSummation -- myForm  myArray</br>
&emsp;&emsp;&emsp;&emsp;LinearFunction</br>
&emsp;&emsp;&emsp;&emsp;&emsp;ExponentialFunction</br>
&emsp;&emsp;&emsp;&emsp;&emsp;SplineFunction -- linSeg</br>
&emsp;&emsp;&emsp;&emsp;Sound</br>
&emsp;&emsp;&emsp;&emsp;&emsp;GranularSound -- grains</br>
&emsp;&emsp;&emsp;&emsp;&emsp;StoredSound -- samplesInMemory  firstIndex  changed</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;FloatSound</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;VirtualSound -- source</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;CompositeSound -- components</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;GapSound -- cutList</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;WordSound</br>
</br>
Voices</br>
&emsp;Model -- dependents</br>
&emsp;&emsp;Voice -- name  instrument  stream</br>
&emsp;&emsp;&emsp;MIDIFileVoice -- fileType  tracks  ppq  tempo</br>
&emsp;&emsp;&emsp;MIDIVoice -- currentTime</br>
&emsp;&emsp;&emsp;NotelistVoice -- parameterMap</br>
&emsp;&emsp;&emsp;&emsp;CmixVoice</br>
&emsp;&emsp;&emsp;&emsp;CmusicVoice</br>
&emsp;&emsp;&emsp;&emsp;CsoundVoice</br>
&emsp;&emsp;&emsp;SoundVoice</br>
</p><hr><h3 id="Siren9CClassList">6 - Siren 9C Class List</h3></br>
Siren 9C (Squeak) class list by category in subclass order</br>
</br>
------Music-Models-Representation</br>
</br>
MusicMagnitude</br>
MusicModel</br>
Chroma</br>
Chronos</br>
Ergon</br>
Amplitude</br>
MDuration</br>
Meter</br>
ModeMember</br>
PField</br>
Pitch</br>
Positus</br>
Directionality</br>
Position</br>
Spatialization</br>
</br>
------Music-Models-Implementation</br>
</br>
ConditionalDuration</br>
NominalMagnitude</br>
NumericalMagnitude</br>
HertzPitch</br>
IntervalMagnitude</br>
MIDIPitch</br>
MIDIVelocity</br>
MeasureDuration</br>
OrdinalMagnitude</br>
Length</br>
RatioMagnitude</br>
RatioDuration</br>
RatioLoudness</br>
DBLoudness</br>
RatioPitch</br>
SecondDuration</br>
MSecondDuration</br>
Sharpness</br>
SymbolicLoudness</br>
SymbolicPitch</br>
USecondDuration</br>
</br>
------Music-Events</br>
</br>
MAbstractEvent</br>
DurationEvent</br>
ActionEvent</br>
MusicEvent</br>
EventList</br>
RestEvent</br>
</br>
------Music-EventGenerators</br>
</br>
EventGenerator</br>
Cloud</br>
Cluster</br>
Chord</br>
Arpeggio</br>
DynamicCloud</br>
Ostinato</br>
Peal</br>
Roll</br>
Score11</br>
SelectionCloud</br>
DynamicSelectionCloud</br>
ExtDynamicSelectionCloud</br>
Trill</br>
</br>
------Music-EventModifiers</br>
</br>
EventModifier</br>
Rubato</br>
Swell</br>
</br>
------Music-Functions</br>
</br>
Function</br>
FourierSummation</br>
FunctionEvent</br>
FunctionGraph</br>
LinearFunction</br>
ExponentialFunction</br>
Spectrum</br>
SplineFunction</br>
</br>
------Music-PitchClasses</br>
</br>
MusicalInterval</br>
ChromaticInterval</br>
DiatonicInterval</br>
MusicalDescendingInterval</br>
OctaveDependentNote</br>
PitchClass</br>
PitchClassAltered</br>
PitchClassChord</br>
OctaveDependentChord</br>
PitchClassDoubleFlat</br>
PitchClassDoubleSharp</br>
PitchClassFlat</br>
PitchClassNatural</br>
PitchClassSharp</br>
Signature</br>
Triad</br>
</br>
------Music-PitchScales</br>
</br>
Scale</br>
BohlenPierceScale</br>
ChromaticScale</br>
DoubleHarmonic</br>
HarmonicMinorScale</br>
HungarianMinor</br>
MajorScale</br>
MelodicMinorScale</br>
NeapolitanMajor</br>
NeapolitanMinor</br>
Oriental</br>
PentatonicScale</br>
PseudoMinorScale</br>
</br>
------Music-Sound</br>
</br>
FloatSound</br>
Sound</br>
ComponentSound</br>
VirtualSound</br>
CompositeSound</br>
GapSound</br>
</br>
------Music-Support</br>
</br>
DeviceModel</br>
EditorModel</br>
EventAssociation</br>
EventScheduler</br>
PortModel</br>
SEventQueue</br>
ScheduleRecord</br>
SirenSession</br>
SirenUtility</br>
Timer</br>
</br>
------MusicIO-Voices</br>
</br>
Voice</br>
MIDIFileVoice</br>
NotelistVoice</br>
CmixVoice</br>
CmusicVoice</br>
CsoundVoice</br>
SoundVoice</br>
SuperColliderVoice</br>
VoiceDialog</br>
</br>
------MusicIO-MIDI</br>
</br>
MIDIDevice</br>
MIDIDump</br>
MIDIFB01</br>
MIDIPF70</br>
MIDIPacket</br>
MIDIPort</br>
MIDIVoice</br>
PortMIDILibrary</br>
PortMIDIPort</br>
</br>
------MusicIO-OSC</br>
</br>
AbstractOSCPacket</br>
OSCBundle</br>
OSCByteConvertor</br>
OSCMessage</br>
OSCPort</br>
OSCVoice</br>
TypedOSCMessage</br>
</br>
------MusicUI-DisplayLists</br>
</br>
DisplayItem</br>
DisplayLine</br>
DisplayList</br>
DisplayRectangle</br>
DisplayPolyline</br>
DisplayString</br>
DisplayVisual</br>
OpaqueImage</br>
</br>
------MusicUI-DisplayListViews</br>
</br>
DisplayListController</br>
DisplayListView</br>
DisplayListWindow</br>
InnerDisplayListMorph</br>
</br>
------MusicUI-Layout</br>
</br>
LayoutManager</br>
HierarchyLayoutManager</br>
IndentedListLayoutManager</br>
IndentedTreeLayoutManager</br>
StructureAccessor</br>
STreeAccessor</br>
TimeSequenceLayoutManager</br>
PitchTimeLayoutManager</br>
PositionTimeLayoutManager</br>
</br>
------MusicUI-Editors</br>
</br>
EventListEditor</br>
EventListFileViewer</br>
EventListPanel</br>
EventListText</br>
EventListTreeEditor</br>
EventListTreeItem</br>
ScoreView</br>
TimeSequenceController</br>
PitchTimeController</br>
TimeSequenceView</br>
PhraseView</br>
PitchTimeView</br>
HauerSteffensView</br>
PositionTimeView</br>
</br>
------MusicUI-Functions</br>
</br>
FunctionController</br>
FunctionView</br>
</br>
</p><hr><h3 id="TheSmokeMusicRepresentation">7 - The Smoke Music Representation</h3>The Smoke Music Representation</br>
</br>
The "kernel" of Siren is in the classes related to representing the basic musical magnitudes (pitch, loudness, duration, etc.), and for creating and manipulating event and event list objects. This package is known as the Smallmusic Object Kernel (Smoke--name suggested by Danny Oppenheim).</br>
</br>
Smoke is an implementation-language-independent music representation, description language, and interchange format that was developed by a group of researchers at CCRMA/Stanford and CNMAT/Berkeley during 1990/91. </br>
</br>
The basic design requirements are that the representation support the following:</br>
&emsp;--abstract models of the basic musical quantities (scalar magnitudes such as pitch, loudness, and duration); </br>
&emsp;--flexible grain-size of "events" in terms of "notes," "grains," "elements," or "textures";</br>
&emsp;--event, control, and sampled sound processing description levels;</br>
</br>
&emsp;--nested/hierarchical event-tree structures for flexible description of "parts," "tracks," or other parallel or sequential organizations;</br>
&emsp;--annotation and marking of event tree structures supporting the creation of heterarchies (lattices) and hypermedia networks;</br>
&emsp;--annotation including common-practise notation possible;</br>
</br>
&emsp;--instrument/note (voice/event, performer/music) abstractions;</br>
&emsp;--separation of "data" from "interpretation" ("what" vs. "how" in terms of providing for interpretation objects--voices);</br>
</br>
&emsp;--abstractions for the description of "middle-level" musical structures (e.g., chords, clusters, or trills);</br>
&emsp;--sound functions, granular description, or other (non-note-oriented) description abstractions;</br>
&emsp;--description of sampled sound synthesis and processing models such as sound file mixing or DSP;</br>
</br>
&emsp;--possibility of building convertors for many common formats, such as MIDI data, Adagio, note lists, DSP code, instrument definitions, or mixing scripts; and</br>
&emsp;--possibility of parsing live performance into some rendition in the representation, and of interpreting it (in some rendition) in real-time.</br>
</br>
The "executive summary" of Smoke from (from the 1992 ICMC paper) is as follows. Music (i.e., a musical surface or structure), can be represented as a series of "events" (which generally last from tens of msec to tens of sec). Events are simply property lists or dictionaries that are defined for some duration; they can have named properties whose values are arbitrary. These properties may be music-specific objects (such as pitches or spatial positions), and models of many common musical magnitudes are provided. </br>
</br>
Events are grouped into "event lists" (AKA composite events or event collections) by their relative start times. Event lists are events themselves and can therefore be nested into trees (i.e., an event list can have another event list as one of its events); they can also map their properties onto their component events. This means that an event can be "shared" by being in more than one event list at different relative start times and with different properties mapped onto it.</br>
</br>
Events and event lists are "performed" by the action of a scheduler passing them to an interpretation object or voice. Voice objects and applications determine the interpretation of events' properties, and may assume the existence of "standard" property names such as duration, pitch, loudness, voice, or position. Voices map application-independent event properties onto the specific parameters of I/O devices or formatted files. A scheduler expands and/or maps event lists and sends their events to their voices in real time.</br>
</br>
Sampled sounds can also be described as objects, by means of synthesis "patches," or signal processing scripts involving a vocabulary of sound manipulation messages.</br>
</br>
Examples</br>
</br>
Move to the following sections for extensive examples of Smoke object creation and manipulation.</br>
</p><hr><h3 id="MusicMagnitudesandModels">8 - Music Magnitudes and Models</h3>Smoke Music Magnitude Models</br>
</br>
Smoke uses objects called music magnitudes to represent the basic "units of measure" of musical sound: duration, pitch, amplitude, etc. MusicMagnitude objects are characterized by their identity, class, species, and value (e.g., the pitch object that represents 'c3' has its object identity, the class SymbolicPitch, the species Pitch, and the value 'c3' [a string]). MusicMagnitude behaviors distinguish between class membership and species in a multiple-inheritance-like scheme that allows the object representing "440.0 Hz" to share pitch-like and real-number-like behaviors. This means that its behavior can depend on what it represents (a pitch), or how its value is stored (a floating-point number). </br>
</br>
The mixed-mode music magnitude arithmetic is defined using the technique of species-based coercion, i.e., class Pitch knows whether a string note name or Hertz value is more general. This provides capabilities similar to those of systems that use the techniques of multiple inheritance and multiple polymorphism (such as C++ and the Common Lisp Object System), but in a much simpler and scalable manner. All meaningful coercion messages (e.g., (440.0 Hz asMIDIKeyNumber)), and mixed-mode operations (e.g., (1/4 beat + 80 msec)) are defined.</br>
</br>
The basic model classes include Pitch, Loudness, and Duration; exemplary extensions include Length, Sharpness, Weight, and Breath for composition- or notation-specific magnitudes. The handling of time as a parameter is finessed via the abstraction of duration. All times are durations of events or delays, so that no "real" or "absolute" time object is needed. Duration objects can have simple numerical or symbolic values, or they can be conditions (e.g., the duration until some event X occurs), Boolean expressions of other durations, or arbitrary blocks of Smalltalk-80 code. </br>
</br>
Functions of one or more variables are yet another type of signal-like music magnitude. The Siren Function class hierarchy includes (e.g.,) line segment, exponential segment, spline segment and Fourier summation functions. </br>
</br>
In the verbose Smoke format music magnitudes, events and event lists are created by instance creation messages sent to the appropriate classes. The first three expressions in the examples below create various music magnitudes and coerce them into other representations. </br>
</br>
The terse form for music magnitude creation uses post-operators (unary messages) such as 440 hz or 250 msec, as shown in the examples below.</br>
</br>
Users can extend the music magnitude framework with their own classes that refine the existing models of define totally new kinds of musical metrics.</br>
</br>
Basic MusicMagnitude Models</br>
&emsp;</br>
Durations</br>
&emsp;SecondDuration -- 1 sec</br>
&emsp;MSecondDuration -- 100 msec (milliseconds)</br>
&emsp;USecondDuration -- 100000 usec (microseconds)</br>
&emsp;RatioDuration -- 1/4 beat (relative fractions of some tempo scale)</br>
&emsp;ConditionalDuration -- until: [ :t | boolean-block]</br>
</br>
Pitches</br>
&emsp;HertzPitch -- 440.0 hz</br>
&emsp;MIDIPitch -- 60 pitch -- (or 60 key) can be non-integer for microtonal tunings (use #asFracMIDI)</br>
&emsp;SymbolicPitch -- 'c#3' pitch -- several different pitch spellings supported</br>
&emsp;RatioPitch -- 11/9 of: anotherPitch -- used for fraction-oriented tunings</br>
</br>
Amplitude/Loudness Objects</br>
&emsp;DBLoudness -- -3 dB -- can be negative relative to 0 dB or positive-valued</br>
&emsp;RatioLoudness -- 0.7071 ampl (or 0.7071 loudness) -- range of 0.0 to 1.0</br>
&emsp;SymbolicLoudness -- 'fff' ampl</br>
&emsp;MIDIVelocity -- 96 velocity</br>
</br>
Other Music Magnitudes</br>
&emsp;OrdinalMagnitudes -- have order but no explicit value (e.g., 'mf')</br>
&emsp;PField -- name/slot/value -- used for note lists</br>
&emsp;See also magnitude accessors in LayoutManagers</br>
</br>
MusicMagnitude Examples</br>
</br>
Verbose MusicMagnitude Creation and Coercion Messages</br>
</br>
&emsp;(Duration value: 1/16) asMsec&emsp;&emsp;&emsp;"Answers Duration 62 msec." </br>
&emsp;(Pitch value: 60) asHertz &emsp;&emsp;&emsp;&emsp;"Answers Pitch 261.623 Hz." </br>
&emsp;(Amplitude value: 'ff') asMIDI&emsp;&emsp;"Answers MIDI key velocity 100." </br>
</br>
Terse MusicMagnitude Creation using post-operators</br>
</br>
&emsp;440 Hz&emsp;&emsp;&emsp;&emsp;&emsp;"a HertzPitch"</br>
&emsp;'c#3' pitch&emsp;&emsp;&emsp;&emsp;&emsp;"a SymbolicPitch"</br>
&emsp;'cs3' pitch&emsp;&emsp;&emsp;&emsp;&emsp;"a SymbolicPitch"</br>
&emsp;60 pitch&emsp;&emsp;&emsp;&emsp;&emsp;"a MIDIPtch"</br>
&emsp;60 key&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"a MIDIPtch"</br>
&emsp;250 msec&emsp;&emsp;&emsp;&emsp;&emsp;"a MSecondDuration"</br>
&emsp;1/4 beat&emsp;&emsp;&emsp;&emsp;&emsp;"a RatioDuration"</br>
&emsp;-16 dB&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"a DBLoudness"</br>
&emsp;'fff' ampl&emsp;&emsp;&emsp;&emsp;&emsp;"a SymbolicLoudness"</br>
&emsp;0.1 ampl&emsp;&emsp;&emsp;&emsp;&emsp;"a RatioLoudness"</br>
</br>
MusicMagnitude Coercion Examples</br>
</br>
&emsp;440 Hz asSymbol&emsp;&emsp;&emsp;"--> 'a3' pitch"</br>
&emsp;(1/4 beat) asMsec&emsp;&emsp;&emsp;"--> 250 msec"</br>
&emsp;#mf ampl asMIDI&emsp;&emsp;&emsp;"--> 70 vel"</br>
&emsp;-16 dB asRatio value&emsp; &emsp;"--> 0.158489"</br>
&emsp;0.1 ampl asMIDI&emsp;&emsp;&emsp;"--> 12 vel"</br>
</br>
Duration Coercion Example--create a 1/8 beat duration and coerce it into a couple of other representations, printing the result to the Smalltalk transcript. To execute this, double-click just inside the open-bracket to select the entire expression and use the pop-up menu or command key (control-d) to "do it."</br>
</br>
&emsp;[ | me |</br>
&emsp;me := Siren.Duration value: 1/8.</br>
&emsp;Transcript cr; show: me printString, ' = ',</br>
&emsp;&emsp;me asSec printString, ' = ',</br>
&emsp;&emsp;me asUsec printString; cr] d</br>
</br>
Pitch Coercion Example--create a named pitch (middle C) and print it to the transcript as Hz and as a MIDI key number.</br>
</br>
&emsp;[ | me |</br>
&emsp;me := Pitch value: 'c3'.</br>
&emsp;Transcript show: me printString, ' = ',</br>
&emsp;&emsp;me asHertz printString, ' = ',</br>
&emsp;&emsp;me asMIDI printString; cr.</br>
&emsp;"me inspect"] d</br>
</br>
Amplitude Coercion Example--create a named dynamic value and print it as an amplitude ratio and a MIDI velocity.</br>
</br>
&emsp;[ | me |</br>
&emsp;me := Amplitude value: #mf.</br>
&emsp;Transcript show: me printString, ' = ',</br>
&emsp;&emsp;me asRatio printString, ' = ',</br>
&emsp;&emsp;me asDB printString, ' = ',</br>
&emsp;&emsp;me asMIDI printString; cr.</br>
&emsp;"me inspect"] d</br>
</br>
Mixed-mode Arithmetic--demonstrate adding beats and msec, or note names and Hertz values. Select and print these.</br>
</br>
&emsp;[(1/2 beat) + 100 msec]&emsp;&emsp;&emsp;&emsp;" (0.6 beat")</br>
&emsp;['a4' pitch + 25 Hz]&emsp;&emsp;&emsp;&emsp;&emsp;" (465.0 Hz)"</br>
&emsp;[('a4' pitch + 100 Hz) asMIDI]&emsp;&emsp;&emsp;" (73 key)"</br>
&emsp;[('a4' pitch + 100 Hz) asFracMIDI]&emsp;" (72.5455 key)"</br>
&emsp;['mp' ampl + 3 dB]&emsp;&emsp;&emsp;&emsp;&emsp;" (-4.6 dB)"</br>
</br>
Microtonality</br>
</br>
Alberto de Campo's microtonal extensions allow MIDI pitches to be floating-point numbers (e.g., MIDI key 60.25) and named pitches to have "remainder" values (e.g., c3 + 25 cents) as in the following examples.</br>
</br>
&emsp;[438 Hz asSymbol] &emsp; &emsp;"rounds to nearest chromatic note, a3."</br>
&emsp;[443.5 Hz asMIDI]&emsp;&emsp;&emsp;"ditto."</br>
&emsp;[265 Hz asFracMIDI]&emsp;&emsp;"converts to float chromatics; can be rounded, used</br>
 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;for MIDI pitch bend or for precise synthesis in Hz."</br>
&emsp;[61.26 key asHertz]&emsp;&emsp;"float chromatics can also be used directly; for</br>
 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;microtonal scales this is clearer than Hz (to me at least)."</br>
&emsp;[260.0 Hz asFracSymbol] &emsp;"is rounded, but keeps track of offsets in</br>
  &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;an inst var (fracPitch); survives conversions etc."</br>
</br>
Note that asMIDI and asSymbol can now be used to round pitches to chromatics, while the messages asFracMIDI and asFracSymbol keep the full microtonal precision.</br>
</br>
Conditional Durations</br>
</br>
Conditional durations allow one to have state-dependent events lists.</br>
</br>
&emsp;[ConditionalDuration exampleWithRands]</br>
&emsp;[ConditionalDuration until: [ :x | x > 5]]</br>
</br>
Extending Siren's MusicMagnitude Models</br>
</br>
Developers and composers can extend the core Smoke representation by adding new magnitude models (abstract species classes with instance creation methods, post-fix operators and a generality table) and concrete magnitudes (with units, coercion methods, and print/store). This is relatively easy and can be very useful for a composition that uses a new model for its structure.</br>
</p><hr><h3 id="PitchClassesandScales">9 - Pitch Classes and Scales</h3>MusES Pitch Classes, Intervals, Scales, and Chords</br>
</br>
Siren incorporates some of Francois Pachet et al's MusES pitch class package (see https://www.francoispachet.fr/wp-content/uploads/2021/01/pachet-96b.pdf). A pitch class is an abstraction of a single pitch or note name (e.g., C in any octave, or 'fa' in any key), and there are relationships for pitch class spelling (f#, la flat), pitch equivalence, enharmonic equivalence (do sharp = re flat), and interval algebra.</br>
</br>
Based on this, chords and scales can be defined according to pitch class rules.</br>
</br>
To make the code easy to use, MusES puts a shortcut in the Smalltalk global dictionary; the global variable N holds the PitchClass class, making the following code examples easier to read.</br>
</br>
Print these to see results, or look at the advanced EventGenerator examples.</br>
</br>
Pitch expressions (print these)</br>
&emsp;[N C sharp sharp]</br>
&emsp;[N C augmentedFourth]</br>
&emsp;[N C diminishedThirteenth]</br>
&emsp;[N C augmentedFourth pitchEqual: N C diminishedFifth]</br>
&emsp;[N D sharp closestEnharmonic]</br>
&emsp;[N E flat closestEnharmonic] </br>
</br>
Intervals</br>
&emsp;[N do flat intervalBetween: N sol]</br>
&emsp;[MusicalInterval perfectFourth topIfBottomIs: N F sharp]</br>
&emsp;[MusicalInterval allIntervalsType: 4]</br>
</br>
Scales</br>
&emsp;[PitchClass B majorScale notes]</br>
&emsp;[PitchClass D flat melodicMinorScale notes]</br>
</br>
To use a scale as real pitches, you need to give it an octave, as in</br>
&emsp;[PitchClass C majorScale asPitchesInOctave: 5]</br>
&emsp;[(HungarianMinor root: N fa) asPitchesInOctave: 2] </br>
</br>
Chords</br>
&emsp;(PitchClassChord new fromString: 'C') notes</br>
&emsp;(PitchClassChord new fromString: 'Re maj7') notes</br>
&emsp;(PitchClassChord new fromString: 'C 13 aug9') notes</br>
&emsp;(PitchClassChord new fromString: 'C aug9 dim5') notes</br>
</br>
Key signatures</br>
&emsp;[Signature choseSignature]</br>
&emsp;[(Signature new nbSharps: 4) tonality]</br>
&emsp;[Signature fromTonality: N E flat majorScale]</br>
</br>
EventList Examples using Scales</br>
</br>
&emsp;[((NeapolitanMinor root: N do) generateChordsPoly: 5 inOctave: 3) scrambled] p</br>
</br>
Extending the Models of Pitch Classes and Scales</br>
</br>
Obviously, this framework is designed for ease of extension, and new interval types, scale rules, families of key signatures are all straightforward to add.</br>
</br>
[(BohlenPierceScale root: N mi) notes]</br>
</p><hr><h3 id="SmokeEventsandProperties">10 - Smoke Events and Properties</h3>Smoke Events</br>
</br>
All musical structures in Smoke--from micro-sound components of a note, to entire compositions--are represented as event objects. Events are very simple objects that have lists of properties, and get/set methods for managing these properties. The Event object in Smoke is modeled as a property-list dictionary with a duration. Events have no notion of external time until their durations become active. Event behaviors include duration and property accessing, and "performance," where the semantics of the operation depends on another object--a voice or driver as described below. </br>
</br>
The event classes are quite simple; events have little interesting behavior (most of that being taken over by event lists and voices), and there is not a rich hierarchy of kinds of events.</br>
</br>
The primary messages that events understand are property getter/setters,</br>
&emsp;(anEvent duration: someDurationObject)</br>
&emsp;</br>
to set the duration time of the event to some Duration-type music magnitude, and property accessing messages such as </br>
&emsp;(anEvent color: #blue)</br>
&emsp;</br>
to set the "color" (an arbitrary property) to an arbitrary value (the symbol #blue). </br>
</br>
The meaning of an event's properties is interpreted by voices and user interface objects; it is obvious that (e.g.,) a pitch could be mapped differently by a MIDI output voice and a graphical notation editor. It is common to have events with complex objects as properties (e.g., envelope functions, real-time controller maps, DSP scripts, structural annotation, version history, or compositional algorithms), or with more than one copy of some properties (e.g., one event with enharmonic pitch name, key number, and frequency, each of which may be interpreted differently by various voices or structure accessors). The distinction between a complex event object model and adaptors and visitors with dynamic state is intentionally blurred.</br>
</br>
That there is no prescribed "level" or "grain size" for events in Smoke. There may be a one-to-one or many-to-one relationship between events and "notes," or single event objects may be used to represent long complex textures or surfaces.</br>
</br>
Note the way that Smoke uses the Smalltalk concatenation message "," (comma) to denote the construction of events and event lists; (magnitude, magnitude) means to build an event with the two magnitudes as properties, and (event, event) or ((duration -> event) , (duration -> event)) means to build an event list with the given events as components.</br>
</br>
There are classes for events are as follows.</br>
&emsp;AbstractEvent -- just a property list</br>
&emsp;DurationEvent -- adds duration and scheduling behavior</br>
&emsp;MusicEvent -- adds pitch, loudness and voice</br>
&emsp;ActionEvent -- has a block that it evaluates when scheduled</br>
</br>
It is seldom necessary to extend the hierarchy of events.</br>
</br>
Event Creation Examples</br>
</br>
Verbose Event Creation Messages -- Class messages</br>
&emsp;</br>
"Create a `generic' event."</br>
&emsp;MusicEvent duration: 1/4 pitch: 'c3' ampl: 'mf'</br>
</br>
"Create one with added properties."</br>
&emsp;(MusicEvent dur: 1/4 pitch: 'c3') color: #green; accent: #sfz</br>
</br>
Terse Event Creation using concatenation of music magnitudes--inspect these.</br>
</br>
&emsp;[440 Hz, (1/4 beat), 44 dB]</br>
</br>
&emsp;[490 Hz, (1/7 beat), 56 dB, (#voice -> #flute), (#embrochure -> #tight)]</br>
</br>
&emsp;[(#c4 pitch, 0.21 sec, 64 velocity) voice: MIDIVoice default]</br>
</p><hr><h3 id="EventListsandStructureinSmoke">11 - EventLists and Structure in Smoke</h3>Smoke Event Lists</br>
</br>
In accordance to the "composite" OO design pattern, EventList objects hold onto collections of events that are tagged and sorted by their start times (represented as the duration between the start time of the container event list and that of the constituent event). The event list classes are subclasses of Event themselves. This means that event lists can behave like events and can therefore be arbitrarily deeply nested, i.e., one event list can contain another as one of its events. </br>
</br>
The primary messages to which event lists respond (in addition to the behavior they inherit by being events), ar;</br>
&emsp;(anEventList add: anEvent at: aDuration) -- to add an event to the list</br>
&emsp;(anEventList play) -- to play the event list on its voice (or a default one)</br>
&emsp;(anEventList edit) -- to open a graphical editor in the event list</br>
&emsp;(anEventList open) -- either edit, play or inspect, depending on the <SHIFT> and <CTRL> keys</br>
</br>
</br>
and Smalltalk-80 collection iteration and enumeration messages such as </br>
&emsp;(anEventList do: [1-arg-block]) -- to iterate over a list's events</br>
&emsp;(anEventList select: [Bool-Block]) -- to select the events that satisfy the given (Boolean) function block. </br>
</br>
Event lists can map their own properties onto their events in several ways. Properties can be defined as lazy or eager, to signify whether they map themselves when created (eagerly) or when the event list is performed (lazily). This makes it easy to create several event lists that have copies of the same events and map their own properties onto the events at performance time under interactive control. Voices handle mapping of event list properties via event modifiers, as described below.</br>
</br>
In a typical hierarchical Smoke score, data structure composition is used to manage the large number of events, event generators and event modifiers necessary to describe a full performance. The score is a tree--possibly a forest (i.e., with multiple roots) or a lattice (i.e., with cross-branch links between the inner nodes)--of hierarchical event lists representing sections, parts, tracks, phrases, chords, or whatever abstractions the user desires to define. Smoke does not define any fixed event list subclasses for these types; they are all various compositions of parallel or sequential event lists.</br>
</br>
Note that events do not know their start times; this is always relative to some outer scope. This means that events can be shared among many event lists, the extreme case being an entire composition where one event is shared and mapped by many different event lists (as described in (Scaletti 1989)). The fact that the Smoke text-based event and event list description format consists of executable Smalltalk-80 message expressions (see examples below), means that it can be seen as either a declarative or a procedural description language. The goal is to provide "something of a cross between a music notation and a programming language" (Dannenberg 1989). </br>
</br>
Event List Examples</br>
</br>
The verbose way of creating an event list is to create a named instance and add events explicitly as shown in the first example below, which creates a D-major chord (D, F-sharp, A).</br>
</br>
&emsp;[((EventList newNamed: #Chord1)</br>
&emsp;&emsp;add: (1/2  beat, 'd3'  pitch,  'mf' ampl)  at: 0;</br>
&emsp;&emsp;add: (1/2  beat, 'fs3'  pitch, 'mf' ampl)  at: 0;</br>
&emsp;&emsp;add: (1/2  beat, 'a4'   pitch, 'mf' ampl)  at: 0) open] d</br>
</br>
This same chord could be defined more tersely as a dictionary of (duration => event) pairs,</br>
</br>
&emsp;[((0 => (1/2 beat, 'd3' pitch, 'mf' ampl)), </br>
&emsp;  (0 => (1/2 beat, 'fs3' pitch, 'mf' ampl)), </br>
&emsp;  (0 => (1/2 beat, 'a4' pitch, 'mf' ampl))) open]</br>
</br>
Note the use of the "=>" message, which works just like Smalltalk's "->'" in that it creates an association between the key on the left and the value on the right; the difference is that it creates a special kind of association called an EventAssociation.</br>
</br>
This could be done even more compactly using a Chord object (see the discussion of event generators below) as,</br>
</br>
&emsp;[((Chord majorTriadOn: 'd3' inversion: 0) duration: 1/2 beat) eventList open]</br>
</br>
Terse EventList creation using concatenation of events or (duration, event) asociations looks like,</br>
</br>
&emsp;[(440 Hz , (1/2 beat) , 44.7 dB) ,&emsp;&emsp;&emsp;&emsp;&emsp;"note the comma between events"</br>
&emsp;   (1 => ((1.396 sec, 0.714 ampl) phoneme: #xu))]&emsp;"2nd event starts at 1 second"</br>
&emsp;</br>
&emsp;[ (5 sec, 0 dB) asEventList]&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"simplest-possible event list"</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</br>
Bach Example--First measure of Fugue 2 from the Well-Tempered Klavier (ignoring the initial rest).</br>
</br>
&emsp;&emsp;(((0 beat) => (1/8 beat,  'c3' pitch)),</br>
&emsp;&emsp;((1/16 beat) => (1/8 beat, 'b2'  pitch)),</br>
&emsp;&emsp;((1/8 beat)  => (1/4 beat,  'c3' pitch)),</br>
&emsp;&emsp;((1/4 beat) => (1/4 beat, 'g2'  pitch)),</br>
&emsp;&emsp;((3/8 beat) => (1/4 beat, 'a-flat2'  pitch)),</br>
&emsp;&emsp;((1/2 beat) => (1/8 beat,  'c3' pitch)),</br>
&emsp;&emsp;((1/16 beat) => (1/8 beat, 'b2'  pitch)),</br>
&emsp;&emsp;((1/8 beat)  => (1/4 beat,  'c3' pitch)),</br>
&emsp;&emsp;((3/4 beat) => (1/4 beat, 'd3'  pitch)),</br>
&emsp;&emsp;((7/8 beat) => (1/4 beat, 'g2'  pitch)))</br>
</br>
There are more comfortable event list creation methods, such as the following examples.</br>
</br>
Play a chromatic scale giving the initial and final pitches (as MIDI key numbers) and total duration (in seconds)</br>
</br>
&emsp;[(EventList scaleFrom: 48 to: 60 in: 1.5) open] d</br>
</br>
Create 64 random events with parameters in the given ranges and play them over the default output voice.</br>
</br>
&emsp;[(EventList randomExample: 32 </br>
&emsp;&emsp;from: ((#duration: -> (50 to: 200)),&emsp;&emsp;"durations in msec"</br>
&emsp;&emsp;&emsp;&emsp;(#pitch: -> (36 to: 60)),&emsp;&emsp;&emsp;"pitchs as MIDI key numbers"</br>
&emsp;&emsp;&emsp;&emsp;(#ampl: -> (48 to: 120)),&emsp;&emsp;&emsp;"amplitudes as MIDI key velocities"</br>
&emsp;&emsp;&emsp;&emsp;(#voice: -> (1 to: 1)))) open] d&emsp;&emsp;"voices as numbers"</br>
</br>
Note that the argument for the keyword "from:" is a dictionary in the form (property-name -> value-interval).</br>
</br>
Same with named instruments = play using named instruments</br>
</br>
&emsp;[(EventList randomExample: 64 </br>
&emsp;&emsp;from: ((#duration: -> (0.25 to: 0.6)),&emsp;&emsp;&emsp;"dur in sec"</br>
&emsp;&emsp;&emsp;&emsp;(#pitch: -> (36 to: 60)),&emsp;&emsp;&emsp;&emsp;"MIDI pitch"</br>
&emsp;&emsp;&emsp;&emsp;(#ampl: -> (48 to: 120)),&emsp;&emsp;&emsp;&emsp;"MIDI velocity"</br>
&emsp;&emsp;&emsp;&emsp;(#voice: -> #(organ1 flute2 clarinet bassoon1 marimba bass1)))) open] d</br>
</br>
Event lists don't have to have pitches at all, as in the word,</br>
</br>
&emsp;[EventList named: 'phrase1'  </br>
&emsp;&emsp;fromSelectors: #(duration: loudness: phoneme:)&emsp;&emsp;&emsp;"3 parameters"</br>
&emsp;&emsp;values: (Array with: #(595 545 545 540 570 800 540) &emsp;&emsp;"3 value arrays"</br>
&emsp;&emsp;&emsp;&emsp;&emsp;with: #(0.8 0.4 0.5 0.3 0.2 0.7 0.1) </br>
&emsp;&emsp;&emsp;&emsp;&emsp;with: #(#dun #kel #kam #mer #ge #sprae #che)).</br>
&emsp;(EventList named: 'phrase1') inspect] d</br>
</br>
Note the format of the arguments to the message "fromSelectors: values:" used above, the first is an array of property selector symbols, and the second is an array of arrays for the property data.  Note also the use of a name for the event list.  If you name eevntlists or voices, they are stored in a global dictionary so that they can later be remembered.  The utility tool has a button to inspect the shared data (Inspect DB) and to flush it (Flush all).</br>
</br>
There are a number of useful EventList instance creation methods based on the "fromSelectors: values:" method, for example, the following example shows the use of data lists in a serial style for score creation.</br>
</br>
&emsp;[(EventList serialExample: 64 </br>
&emsp;&emsp;from: ((#duration: -> #(0.25 0.25 0.25 0.5)) , </br>
&emsp;&emsp;&emsp;&emsp;(#pitch: -> #(48 50 52 53 52)) ,</br>
&emsp;&emsp;&emsp;&emsp;(#ampl: -> #(48 94)) ,</br>
&emsp;&emsp;&emsp;&emsp;(#voice: -> #(1)))) editPTV] </br>
</br>
This example creates a scale where the event property types (duration, pitch, amplitude) are mixed.</br>
</br>
&emsp;[EventList scaleExample2] I</br>
</br>
Here's another example of creating a simple melody</br>
</br>
&emsp;[(EventList named: 'melody'  </br>
&emsp;&emsp;fromSelectors: #(pitch: duration:)</br>
&emsp;&emsp;values: (Array with: #(c d e f g) </br>
&emsp;&emsp;&emsp;&emsp;&emsp;with: #(4 8 8 4 4) reciprocal)) open]</br>
</br>
Event lists can have mixed properties in the events; inspect this</br>
&emsp;[EventList scaleExample2]</br>
 </br>
You can create event lists with snippets of code such as the following 2-octave whole-tone scale.</br>
</br>
&emsp;[ | elist |</br>
&emsp;elist := EventList newAnonymous.</br>
&emsp;0 to: 12 do:</br>
&emsp;&emsp;[ :index |</br>
&emsp;&emsp;elist add: (1/4  beat, (index * 2 + 48) key,  #mf ampl)].</br>
&emsp;elist open ]</br>
</br>
Event lists can be nested into arbitrary structures, as in the following group of four sub-groups</br>
</br>
&emsp;[((EventList newNamed: 'Test/Groups')</br>
&emsp;&emsp;add: (EventList randomExample: 8 </br>
&emsp;&emsp;&emsp;from: ((#duration: -> (60 to: 120)), (#pitch: -> (36 to: 40)), (#ampl: -> #(110)))) at: 0 sec;</br>
&emsp;&emsp;add: (EventList randomExample: 8 </br>
&emsp;&emsp;&emsp;from: ((#duration: -> (60 to: 120)), (#pitch: -> (40 to: 44)), (#ampl: -> #(100)))) at: 1.5 sec;</br>
&emsp;&emsp;add: (EventList randomExample: 8 </br>
&emsp;&emsp;&emsp;from: ((#duration: -> (60 to: 120)), (#pitch: -> (44 to: 48)), (#ampl: -> #(80)))) at: 3 sec;</br>
&emsp;&emsp;add: (EventList randomExample: 8</br>
&emsp;&emsp;&emsp;from: ((#duration: -> (60 to: 120)), (#pitch: -> (48 to: 52)), (#ampl: -> #(70)))) at: 4.5 sec) </br>
&emsp;editPTV] d</br>
</br>
Smalltalk methods can process event lists in many different ways, as in this code that uses the eventsDo: [] message to increase the durations of the last notes in each of the subgroups from the previous example.</br>
</br>
&emsp;[(EventList named: 'Test/Groups') eventsDo: </br>
&emsp;&emsp;[ :sublist | | evnt |&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"Remember: this is hierarchical, to the events are the sub-groups"</br>
&emsp;&emsp;evnt := sublist events last event.&emsp;&emsp;&emsp;"get the first note of each group"</br>
&emsp;&emsp;evnt duration: evnt duration * 4].&emsp;&emsp;"multiply the duration by 4"</br>
&emsp;(EventList named: 'Test/Groups') open ]</br>
</br>
</br>
In the following example, we iterate over a scale and make it slow down to changing the event start times</br>
</br>
&emsp;[ | elist |</br>
&emsp;elist := EventList scaleFrom: 60 to: 36 in: 4. </br>
&emsp;1 to: elist size do: </br>
&emsp;&emsp;[ :index | | assoc |</br>
&emsp;&emsp;assoc := elist events at: index.</br>
&emsp;&emsp;assoc key: (assoc key * (1 + (index / elist events size)))].</br>
&emsp;elist editPTV ]</br>
</br>
There are many more event list processing examples in the various class example methods, and in the event generator example that follow in this workbook.</br>
</br>
</br>
</br>
Storage and Utilities</br>
</br>
Note the use of event list names in the above examples. All named event lists are stored in a hierarchical dictionary named EventLists that's held in class SirenSession. To look at all named event lists, execute the following</br>
&emsp;[SirenSession eventLists] I</br>
</br>
If you create an event list with a name that contains the character '/', then it is assumed to be in a subdictionary of the top-level event list dictionary, as in the example above that created an event list named 'Hierarchical/4Groups.' You can use this to manage your own sketches and pieces. If you create an event list named 'Opus1/Prelude/Exposition/Theme1' then the hierarchy of implicit in the name will be reflected by an automatically created hierarchical set of event list dictionaries.</br>
</br>
For example,</br>
&emsp;[SirenSession eventList: 'piece1/mvmnt1/part1' put: EventList new]</br>
and later,</br>
&emsp;[evtL := SirenSession eventList: 'piece1/mvmnt1/part1']</br>
</br>
There's a pop-up menu in the transport view (not ported to Squeak in 9C) that allows you to select event lists from this hierarchy.</br>
</br>
You can erase the temporary lists (those in the dictionary named #Temp) from the EventList dictionary with,</br>
&emsp;[SirenSession flushTempEventLists]</br>
</br>
or to flush all,</br>
&emsp;[SirenSession flushAllEventLists]</br>
</br>
Inspect a dictionary of all known event lists.</br>
&emsp;[SirenSession eventLists inspect]</br>
</br>
To read in a stored file, simply,</br>
&emsp;[(Filename named: 'events.st') fileIn]</br>
</br>
Load all event lists (.ev, .midi, and .gio files), from the data directories.</br>
&emsp;[SirenSession loadDemoData]</br>
</br>
Extending The Event/EventList Framework</br>
</br>
There are a number of approaches one can take to extend the Smoke framework. The core event classes rarely need extension of subclassing. Simple methods in a workspace or class example methods can create and process event lists through many stages, and the built-in persistency and versioning in s7 files aids composers in the stages of content creation, refinement, sorting, and mixing. </br>
</br>
It is often useful to add new EventList instance creation method for short-hand representations of chords, scales, etc. One can also write new processing methods (e.g., filters) in the EventList class. These can also be placed on EventGenerator or EventModifier classes (see the next workbook sections).</br>
</p><hr><h3 id="ControlFunctionsandtheirApplication">12 - Control Functions and their Application</h3>Siren Functions</br>
</br>
There are several classes that represent functions of 1 variable (typ. time) such as envelopes or waveforms. These objects can be described using (e.g.,) linear or exponential interpolation between n-dimensional break-points, Fourier sine summation, cubic splines, or as raw sampled data. In addition to the instance creation methods, Functions understand array-like accessing method at: or atX: to get at their values.</br>
</br>
The FunctionView displays up to 4 functions and supports simple editing (editing not ported to Squeak yet).</br>
</br>
Function Creation Examples</br>
</br>
The expressions below demonstrate the various creation techniques for Siren functions.</br>
</br>
If you like thicker function plots, do this,</br>
&emsp;[FunctionView lineWidth: 2]</br>
</br>
Basic ramp up/down (linear and exponential flavors)</br>
&emsp;[(LinearFunction from: #((0 0) (0.5 1) (1 0))) at: 0.25] p</br>
&emsp;[(ExponentialFunction from: #((0 0 5) (0.5 1 -5) (1 0))) at: 0.25 ] p</br>
</br>
ADSR-like envelopes</br>
&emsp;[(LinearFunction from: #((0 0) (0.1 1) (0.16 0.7) (0.8 0.4) (1 0))) edit] d</br>
&emsp;[(ExponentialFunction from: #((0 0 5) (0.1 1 -12) (0.8 0.4 -2) (1 0))) edit] d</br>
</br>
Open a view with a linear envelope, an exponential envelope, a spline curve, and a sum-of-sines function</br>
&emsp;[FunctionView multiFunctionExample]</br>
</br>
Sine Summation band-limited approximation of a square wave</br>
&emsp;[(FourierSummation from: #((1 1 0)  (3 0.3 0)  (5 0.2 0)  (7 0.15 0)  (9 0.11 0)  (11 0.09 0))) edit] d</br>
</br>
Other Function creatipon examples</br>
&emsp;[(Function randomOfSize: 512 from: 0.2 to: 0.9) edit] d</br>
&emsp;[FunctionView onFunction: </br>
&emsp;&emsp;(Function from: #( 0 1 0 0.5 1.0 0.5 0 1 0 0.3 0.6 0.9 1 0.5 0.25 0.125 0.0625 0 1 0))] d</br>
</br>
Using Functions</br>
</br>
One can apply a function to any property of an event list, as in the example below, which makes a crescendo/decrescendo using an exponential triangle function.</br>
</br>
&emsp;[ | list fcn |</br>
&emsp;list := EventList newNamed: #test3.</br>
&emsp;(0 to: 4000 by: 100) do: &emsp;&emsp;&emsp;"4 seconds, 10 notes per second"</br>
&emsp;&emsp;&emsp;[ :index |&emsp;&emsp;&emsp;&emsp;&emsp;"add the same note"</br>
&emsp;&emsp;&emsp;list add: (MusicEvent dur: 100 pitch: 36 ampl: 250) at: index].</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"create a fcn that fades in and then out"</br>
&emsp;fcn := ExponentialFunction from: #((0 0.1 2) (0.5 1 -2) (1 0.1)).</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"apply the fcn to the loudness of the event list"</br>
&emsp;list applyFunction: fcn to: #loudness.</br>
&emsp;list editPTV] d&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"edit the event list in a pitch-time view"</br>
</br>
The next examples show how functions can be queried; the first expression displays a function that has large changes in its slope; the expressions after that illustrate that one can ask a function for an X value where it crosses a threshold of difference from some other X value, e.g., the 2nd expression below means "find the first value after X = 0.1 where the value is more than 0.01 different from the value at X = 0.1." This is quite useful in data reduction and in output scheduling (i.e., don't keep sending the same controller value)</br>
</br>
Create a function with a large change in slope.</br>
&emsp;[(LinearFunction from: #((0 0.2) (0.6 0.3) (0.62 1.0) (1.0 0.3))) edit] d</br>
</br>
</br>
Query the delta threshold in the low-slope section</br>
&emsp;[(LinearFunction from: #((0 0.2) (0.6 0.3) (0.62 1.0) (1.0 0.3))) </br>
&emsp;&emsp;&emsp;nextXMoreThan: 0.01 from: 0.1] p</br>
&emsp;&emsp;</br>
Query the delta threshold in the high-slope section</br>
&emsp;[(LinearFunction from: #((0 0.2) (0.6 0.3) (0.62 1.0) (1.0 0.3))) </br>
&emsp;&emsp;&emsp;nextXMoreThan: 0.1 from: 0.6] p</br>
</br>
Functions support standard arithmetic, so that one can scale them by numbers, or add/multiply functions as though they were numbers, as illustrated by the examples below.</br>
</br>
&emsp;[((FourierSummation from: #((5 0.1 0))) + 0.6) open]</br>
</br>
&emsp;[ | sin tri rnd |</br>
&emsp;tri := LinearFunction from: #((0 0) (0.5 0.9) (1 0)).</br>
&emsp;sin := FourierSummation from: #((17 0.05 0)).</br>
&emsp;rnd := Function randomOfSize: 512 from: 0.0 to: 1.0.</br>
&emsp;FunctionView lineWidth: 2.&emsp;&emsp;&emsp;"set a bold line width"</br>
&emsp;FunctionView onFunctions: </br>
&emsp;&emsp;(Array </br>
&emsp;&emsp;&emsp;with: (tri + sin) &emsp;&emsp;&emsp;&emsp;"blue: triangle + sine"</br>
&emsp;&emsp;&emsp;with: (tri * sin + 0.2) &emsp;&emsp;&emsp;"red: triangle * sine + offset"</br>
&emsp;&emsp;&emsp;with: (rnd * 0.1 + 0.5) &emsp;&emsp;&emsp;"cyan: noise with scale/offset"</br>
&emsp;&emsp;&emsp;with: (tri * 0.25))&emsp;&emsp;&emsp;&emsp;"brown: triangle scaled by constant"</br>
&emsp;&emsp;withColors: (Array with: Color blue with: Color red</br>
&emsp;&emsp;&emsp;&emsp;with: Color cyan muchDarker with: Color brown)] d</br>
</br>
Function Views</br>
</br>
The following multi-linear-function view example creates 4 linear functions and displays them</br>
</br>
&emsp;[FunctionView lineWidth: 2.&emsp;&emsp;&emsp;"set a bold line width"</br>
&emsp;FunctionView onFunctions: (Array </br>
&emsp;&emsp;&emsp;with: (LinearFunction from: #((0@0) (0.15@1.0) (0.25@0.75) (0.75@0.5) (1@0))) </br>
&emsp;&emsp;&emsp;with: (LinearFunction from: #((0@0.1) (0.3@0.7) (0.7@0.45) (1@0))) </br>
&emsp;&emsp;&emsp;with: (LinearFunction from: #((0@0) (0.05@1) (0.2@0.35) (1@0))) </br>
&emsp;&emsp;&emsp;with: (LinearFunction from: #((0@0.2) (0.6@0.3) (1@0.3))))</br>
&emsp;&emsp;withColors: (Array with: Color blue with: Color red</br>
&emsp;&emsp;&emsp;&emsp;with: Color cyan with: Color green)] d</br>
</br>
The next example mixes the types of function as well as the normalization switches</br>
</br>
&emsp;[FunctionView </br>
&emsp;&emsp;onFunctions: (Array with: (LinearFunction from: #((0 0) (0.12 1) (0.17 0.74) </br>
&emsp;&emsp;&emsp;&emsp;(0.35 0.5) (0.9 0.4) (1 0) )) </br>
&emsp;&emsp;&emsp;with: (FourierSummation from: #((1 0.5 0)  (3 0.15 0)  (5 0.1 0)  (7 0.075 0)  (9 0.055 0)  (11 0.05 0)))</br>
&emsp;&emsp;&emsp;with: (ExponentialFunction from: #((0 0 5) (0.05 1 -5) (0.2 0.25 -1) (1 0))) </br>
&emsp;&emsp;&emsp;with: (SplineFunction from: #((0 0.5) (0.3 0.6) (0.7 0.5) (0.85 0.7) (1 0.6))))</br>
&emsp;&emsp;&emsp;withColors: FunctionView defaultColors</br>
&emsp;&emsp;normalize: #(false true false false)] d</br>
</br>
Playing functions as controllers</br>
</br>
Several of the voice classes (see below) can use Siren functions to send out sampled continuous control messages. The class FunctionEvent provides the methods needed to package functions in event lists, and allows you to specify a fixed update rate or a value change threshold for output scheduling. The following example sends out OSC frequency updates at the rate of 4 Hz to the address /osc/1/ampl with values taken from a linear envelope. Start an OSC dump utility before executing this.</br>
</br>
&emsp;[OSCVoice functionExample] b</br>
</br>
Similarly, one can use functions as MIDI controller messages, as in this example, which uses a linear function to create a swell on an organ note (assumed a GeneralMIDI synth).</br>
&emsp;[MIDIPort functionExample] b</br>
</br>
</br>
</br>
Spectra and Signal Analysis (Not available in Squeak in version 9C)</br>
</br>
A spectrum is simply another kind of function (with real or complex values), and Siren supports the fast Fourier transform for spectral analysis and resynthesis via the FFTW lbrary. There is also a simple spectral display, as illustrated by the examples below.</br>
</br>
Create a swept sine wave and take its fft.</br>
&emsp;[Spectrum sweepExample display]</br>
</br>
Read a file (T'ang dynasty speech) and show the spectrogram</br>
&emsp;[Spectrum fileExample display] db</br>
</br>
Loading SHARC (Sandell Harmonic ARChive) spectral sets (Not available in Squeak in version 9C)</br>
</br>
Siren also has special classes that read spectral samples from Greg Sandell's SHARC timbre database (http://www.timbre.ws/sharc/files/README.txt); these sampled spectra can be used for sum-of-sines synthesis. The following example illustrates the loading of a SHARC sample for a tuba. It assumes that the SHARC database is somewhere in the user's data folder list.</br>
&emsp;[SHARCInstrument fromDir: 'tuba'] i</br>
&emsp;[(Function from: (((SHARCInstrument fromDir: 'tuba') samples at: #c3) asWavetable: 1024)) edit: 512] d</br>
&emsp;[((SHARCInstrument fromDir: 'tuba') samples at: #c3) asSumOfSines] i</br>
</br>
To load the entire SHARC database, use the following.</br>
&emsp;[SHARCInstrument loadOrchDir: 'sharc'] d</br>
&emsp;[SHARCInstrument orchestra] i</br>
</br>
There's an example of using a SHARC spectrum sample set to drive a CSL sum-of-sines synthesizer via OSC in this method</br>
&emsp;[OSCVoice sosExample1]&emsp;db</br>
</br>
Extending the Function Framework</br>
</br>
As with other areas of Siren, the Function framework is designed for ease of extension. One can construct a new type of function with a simple instance creation method and implementation of the at: method. There are also often cases where one needs an additional behavior in the base Function class. For extending the behavior of functions with respect to events and event lists, you can customize the eventList apply: function.</br>
</p><hr><h3 id="EventGeneratorsforMiddle-levelMusicalStructures">13 - EventGenerators for Middle-level Musical Structures</h3>Siren Event Generators</br>
</br>
The EventGenerator and EventModifier packages provide for music description and performance using generic or composition-specific middle-level objects. Event generators are used to represent the common structures of the musical vocabulary such as chords, clusters, progressions, ostinati, or algorithms. Each event generator subclass knows how it is described--e.g., a chord with a root and an inversion, or an ostinato with an event list and repeat rate--and can perform itself once or repeatedly, acting like a Smalltalk-80 control structure or returning a static event list for further processing. </br>
</br>
EventModifier objects generally hold onto a function and a property name; they can be told to apply their functions to the named property of an event list lazily or eagerly. Event generators and modifiers are described in more detail in the 1989 ICMC paper (see the file Doc/icmc.89.egens.pdf).</br>
</br>
Examples</br>
</br>
Clusters and Chords are simple one-dimensional event generators.</br>
</br>
&emsp;[(Cluster dur: 2.0</br>
&emsp;&emsp;pitchSet: #(48 50 52 54 56)  &emsp;&emsp;"whole-tone cluster"</br>
&emsp;&emsp;ampl: 100</br>
&emsp;&emsp;voice: 1) open]</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;:F major chord"</br>
&emsp;[((Chord majorTetradOn: 'f4' inversion: 0) duration: 1.0) open]</br>
</br>
Rolls are also-1-D, but are rhythm-only.</br>
Create and play a simple drum roll--another 1-D event generator.</br>
</br>
&emsp;[((Roll length: 2000 rhythm: 50 note: 72) ampl: 80) open] d</br>
</br>
&emsp;[((Roll length: 2000 rhythm: 50 note: 60) ampl: 80) eventList playOn: MIDIVoice default] d</br>
</br>
Clouds are stochastic descriptions of event lists whereby one can give the numerical range of each of several standard properties.</br>
</br>
Create and edit a low 6 second stochastic cloud with 5 events per second.</br>
</br>
&emsp;[ | c |</br>
&emsp;c := (Cloud dur: 6 sec&emsp;&emsp;&emsp;"lasts 6 sec."</br>
&emsp;&emsp;pitch: (48 to: 60)  &emsp;&emsp;&emsp;"with pitches in this range"</br>
&emsp;&emsp;ampl: (80 to: 120) &emsp;&emsp;&emsp;"and amplitudes in this range"</br>
&emsp;&emsp;voice: (1 to: 1)&emsp;&emsp;&emsp;&emsp;"select from these voices"</br>
&emsp;&emsp;density: 5) eventList.&emsp;&emsp;"play 5 notes per sec. and get the event list"</br>
&emsp;c editPTV]</br>
</br>
To create a dynamic cloud, one gives starting and ending ranges for the properties.</br>
Play a 6-second cloud that goes from low to high and soft to loud.</br>
</br>
&emsp;[(DynamicCloud dur: 8 sec  </br>
&emsp;&emsp;pitch: #((24 to: 49) (60 to: 60))&emsp;&emsp;"given starting and ending selection ranges"</br>
&emsp;&emsp;ampl: #((20 to: 40) (90 to: 120))</br>
&emsp;&emsp;voice: (1 to: 8)</br>
&emsp;&emsp;density: 8) open]</br>
</br>
A selection cloud selects values from the data arrays that are given in the instance creation method.</br>
</br>
&emsp;[(SelectionCloud dur: 4  sec</br>
&emsp;&emsp;pitch: #(32 40 48 50 52 55 57 )</br>
&emsp;&emsp;ampl: #(80 40 120)</br>
&emsp;&emsp;voice: #(1)</br>
&emsp;&emsp;density: 8) open]</br>
</br>
&emsp;[(SelectionCloud dur: 4  sec</br>
&emsp;&emsp;pitch: ((NeapolitanMinor root: N do) asPitchesInOctave: 4)</br>
&emsp;&emsp;ampl: #(80 40 120)</br>
&emsp;&emsp;voice: #(1)</br>
&emsp;&emsp;density: 8) edit]</br>
</br>
By obvious extension, a dynamic selection cloud allows one to specify the start and finish selection sets.</br>
The first example below plays a selection cloud that makes a transition from one triad to another; the subsequent ones are progressively more arvanced.</br>
</br>
&emsp;[(DynamicSelectionCloud dur: 6 sec</br>
&emsp;&emsp;pitch: #( #(48 50 52) #(72 74 76) )&emsp;"starting and ending pitch sets"</br>
&emsp;&emsp;ampl: #(60 80 120)</br>
&emsp;&emsp;voice: #(1)</br>
&emsp;&emsp;density: 12) open]</br>
</br>
Transition between scales</br>
</br>
&emsp;[ | set1 set2 |</br>
&emsp;set1 := ((Oriental root: N do) asPitchesInOctave: 4).</br>
&emsp;set2 := ((Oriental root: N sol) asPitchesInOctave: 2).</br>
&emsp;(DynamicSelectionCloud dur: 6 sec</br>
&emsp;&emsp;pitch: (Array with: set1 with: set2)</br>
&emsp;&emsp;ampl: #(60 80 120)</br>
&emsp;&emsp;voice: #(1)</br>
&emsp;&emsp;density: 12) open]</br>
</br>
Two dynamic selection cloud transitions at once</br>
</br>
</br>
&emsp;[ | c |</br>
&emsp;c := (DynamicSelectionCloud dur: 6 sec</br>
&emsp;&emsp;pitch: #( #(53 50 52) #(72 74 75) )&emsp;"starting and ending pitch sets"</br>
&emsp;&emsp;ampl: #(40 60 30)</br>
&emsp;&emsp;voice: #(1)</br>
&emsp;&emsp;density: 12) eventList.</br>
&emsp;c addAll: (DynamicSelectionCloud dur: 6 sec</br>
&emsp;&emsp;pitch: #( #(76 78 80) #(60 62 64) )&emsp;"starting and ending pitch sets"</br>
&emsp;&emsp;ampl: #(40 60 30)</br>
&emsp;&emsp;voice: #(1)</br>
&emsp;&emsp;density: 8) eventList.</br>
&emsp;c editPTV] d</br>
</br>
The extended DynamicSelectionCloud uses a multi-part pitch set  of the format (time -> chord) (time -> chord) ... as in the following example, which creates a list of the tetrachords of the Neapolitan minor scale, then scrambles the list, then transposes every second chord up two octaves, then plays an extended dynamic selection cloud made from this list.</br>
&emsp;</br>
&emsp;[ | score chords list |&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"generate the tetrads from the selected scale; scramble the order"</br>
&emsp;chords := ((NeapolitanMinor root: N do) generateChordsPoly: 4 inOctave: 2) shuffled.</br>
&emsp;list := OrderedCollection new.</br>
&emsp;1 to: 7 do:</br>
&emsp;&emsp;[ :ind |&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"shift every other one up 2 octaves"</br>
&emsp;&emsp;ind even ifTrue: [list add: ((ind - 1) * 3 -> ((chords at: ind) collect: [ :no | no + 24]))]</br>
&emsp;&emsp;&emsp;ifFalse: [list add: ((ind - 1) * 3 -> (chords at: ind))]].</br>
&emsp;score := (ExtDynamicSelectionCloud dur: 8&emsp;&emsp;"now make a cloud from these"</br>
&emsp;&emsp;pitch: list</br>
&emsp;&emsp;ampl: 60</br>
&emsp;&emsp;voice: nil</br>
&emsp;&emsp;density: 10) eventList.</br>
&emsp;score eventsDo: [ :ev |&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"plug in the properties for FM"</br>
&emsp;&emsp;ev inst: '/i1/pn'.</br>
&emsp;&emsp;ev modIndex: 2.0.</br>
&emsp;&emsp;ev ratio: 1.02.</br>
&emsp;&emsp;ev pos: 0.0].</br>
&emsp;SirenSession eventList: 'EvGens/dsCloud1' put: score.</br>
&emsp;score editPTV] d</br>
</br>
As an example of a more sophisticated event generator, Mark Lentczner's bell peals ring the changes.</br>
</br>
&emsp;[(Peal on: #(60 62 65)) eventList open]</br>
</br>
&emsp;[ | peal list |</br>
&emsp;peal := Peal on: #(60 62 65 67).</br>
&emsp;list := EventList new.</br>
&emsp;peal playOn: list durations: 240 meter: 100 at: 0.</br>
"&emsp;list voice: #marimba."</br>
"&emsp;list playOn: MIDIVoice default."</br>
&emsp;list open]</br>
</br>
One can get an event generator's event list and process it using Smalltalk code blocks, as in this example, which takes a simple selection cloud and applies both a crescendo function and a beat pattern to it.</br>
</br>
&emsp;[ | dur cloud list ramp1 ramp2 pattern start |</br>
&emsp;dur := 6 sec.</br>
&emsp;cloud := (SelectionCloud</br>
&emsp;&emsp;dur: dur  </br>
&emsp;&emsp;pitch: ((NeapolitanMinor root: N do) asPitchesInOctave: 4)</br>
&emsp;&emsp;ampl: #(80)</br>
&emsp;&emsp;voice: #(1)</br>
&emsp;&emsp;density: 10).</br>
&emsp;list := cloud eventList.</br>
&emsp;SirenSession eventList: 'Examples/NeapCloud' put: list.</br>
&emsp;ramp1 := (ExponentialFunction from: #((0 0.2 5) (1 0.8))).&emsp;"2 ramps that will be summed"</br>
&emsp;ramp2 := (ExponentialFunction from: #((0 0 5) (0.2 0.2))).</br>
&emsp;pattern := #(0.1 0.1 0.2 0.2 0.1).&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"beat pattern"</br>
&emsp;start := 0.</br>
&emsp;1 to: list size do: &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"loop through the list's events"</br>
&emsp;&emsp;[ :count | | assoc scale |</br>
&emsp;&emsp;assoc := list events at: count.&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"get the current association"</br>
&emsp;&emsp;assoc key: start sec.&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"reset the start time"</br>
&emsp;&emsp;start := start + (pattern at: (count \\ pattern size) + 1).</br>
&emsp;&emsp;scale := (ramp1 at: (count / list size)) + (ramp2 at: ((count asFloat / list size) \\ ramp2 size)).</br>
&emsp;&emsp;assoc value ampl: (scale * 80) velocity].&emsp;&emsp;&emsp;&emsp;&emsp;"scale the amplitude"</br>
&emsp;list editPTV]</br>
</br>
Extending EventGenerators</br>
</br>
New kinds of event generator can be programmed with constructor and eventList: methods. The framework facilitates the design of fancier behaviors and parameterized event generators.</br>
</p><hr><h3 id="Score11EventGenerators">14 - Score11 EventGenerators</h3>Test Workspace - stp - 230128</br>
</br>
Known bugs</br>
&emsp;TSV selection update</br>
&emsp;PTV time-region selection(?)</br>
&emsp;DLV selection handles scale with zoom</br>
&emsp;PitchClass octave bugs - (HungarianMinor root: N fa) asPitchesInOctave: 3</br>
&emsp;Ostinato doesn't wait right.</br>
</br>
ToDo</br>
&emsp;MIDI input: kbd & ctrlrs</br>
&emsp;Function & Sound editors</br>
&emsp;CSL vocoder resynth stage</br>
&emsp;New transport panel</br>
</br>
Post-build testing</br>
</br>
Test plug-ins</br>
</br>
&emsp;CStandardLibrary new abs: -42 </br>
&emsp;FFITestLibrary ffiPrintString: 'Hello' </br>
&emsp;FFITestLibrary ffiTestChars: $A with: 32 with: 0 with: 0</br>
&emsp;FFITestLibrary ffiTestInts: 100 with: 32 with: 0 with: 0 </br>
&emsp;[ExternalAddress loadSymbol: 'pm_initialize' module: PortMIDILibrary moduleName]</br>
&emsp;[ExternalAddress loadSymbol: 'not-there' module: PortMIDILibrary moduleName]</br>
</br>
&emsp;[Undeclared inspect]</br>
&emsp;[Smalltalk garbageCollect]</br>
&emsp;[Utilities openUsefulExpressions]</br>
&emsp;[DirectoryEntry currentDirectory]</br>
&emsp;[DependentsFields]</br>
&emsp;[MIDIPort allNotesOff]</br>
&emsp;[MIDIPort cleanUp]</br>
</br>
New Siren GUI Tools</br>
</br>
&emsp;[SirenSession openUtilityVert]</br>
&emsp;[VoiceDialog open]</br>
</br>
==================================</br>
</br>
Display list view examples</br>
</br>
&emsp;[DisplayListView exampleRectangles]</br>
&emsp;[DisplayRectangle rectangleExample2]&emsp;&emsp;"slow - uses rotated rects"</br>
&emsp;[DisplayListView exampleLines]</br>
&emsp;[DisplayListView examplePolylines]</br>
&emsp;[DisplayListView exampleVisuals]</br>
&emsp;[(DisplayList stringsX: 6000 byY: 10000) display]</br>
&emsp;[DisplayListView exampleMixed]&emsp;&emsp;"huge display list - takes a while"</br>
&emsp;[DisplayList exampleHierarchical display]</br>
</br>
&emsp;Display the old and new glyph catalogs</br>
</br>
&emsp;[DisplayVisual displayMusicConstants]&emsp;&emsp;</br>
&emsp;[DisplayVisual displayMusicGlyphs]&emsp;</br>
</br>
Music notation demos</br>
</br>
&emsp;[TimeSequenceView randomExample]</br>
&emsp;[PitchTimeView randomExample]</br>
&emsp;[PitchTimeView randomExample2]</br>
&emsp;[EventList randomSWSSExample2 editPTV]</br>
&emsp;[HauerSteffensView randomExampleQ]</br>
&emsp;[HauerSteffensView cloudExample]</br>
&emsp;[HauerSteffensView cloudsExample]</br>
&emsp;[HauerSteffensView cloudsExample2]</br>
&emsp;[DynamicCloud focusExample]</br>
&emsp;[HauerSteffensView scaleExample]</br>
&emsp;[HauerSteffensView scaleExample2]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[PitchTimeView openOnEventList: EventList randomExample label: 'P T V' pianoRoll: true]</br>
&emsp;[EventList accellExample open]</br>
</br>
Advanced Event Generators</br>
</br>
&emsp;[(Peal on: #(60 62 64 65) duration: (1/8) beat) eventList editPTV]</br>
&emsp;[Arpeggio example1]&emsp;&emsp; "Plays midi"</br>
</br>
&emsp;[Score11 melody1]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[ExtDynamicSelectionCloud chordExample2]</br>
</br>
Function views</br>
</br>
&emsp;[Function functionViewExample]</br>
&emsp;[FunctionView multiFunctionExample]</br>
&emsp;[FunctionView onFunctions: (Function fromFile: 'G1.2a1.env')]</br>
</br>
--------------------------</br>
</br>
Roll timing tests</br>
</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList asSoundScore play]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList playOn: MIDIVoice default]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList </br>
&emsp;&emsp;&emsp;&emsp;&emsp;playOn: (OSCVoice cslHost: pMapForCSLSimpleFM)]</br>
</br>
----</br>
</br>
MIDI Tests</br>
</br>
&emsp;[PortMIDILibrary pm_count_devices ]</br>
&emsp;[PortMIDILibrary pm_default_input_device ] </br>
&emsp;[PortMIDILibrary pm_default_output_device ] </br>
&emsp;PortMIDILibrary pm_test: PortMIDILibrary new pm_default_output_device </br>
&emsp;[PortMIDIPort listDeviceTable]</br>
&emsp;[PortMIDILibrary testAllNotes]</br>
&emsp;[ExternalLibrary clearAllCaches.]</br>
&emsp;[PortMIDILibrary pm_terminate]</br>
&emsp;[MIDIVoice scaleExample]</br>
&emsp;[MIDIVoice randomExample]</br>
</br>
Various verbose MIDIVoice creation methods</br>
</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice defaultOut: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Kontakt' channel: 3)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Nord' channel: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice on: </br>
&emsp;&emsp;&emsp;(MIDIDevice </br>
&emsp;&emsp;&emsp;&emsp;outOn: (PortMIDIPort indexOfOutNamed: '*Kontakt*') </br>
&emsp;&emsp;&emsp;&emsp;port: MIDIPort concreteClass default) </br>
&emsp;&emsp;&emsp;channel: 3)]</br>
&emsp;[PortMIDIPort streams]</br>
&emsp;[EventList multiVoiceExample playOn: MIDIVoice default]</br>
</br>
OSC Tests</br>
</br>
&emsp;Default CSL Synthesis Server Instruments (see CSL7/Src/IO/OSC_main.cpp)</br>
</br>
&emsp;1 - 10 ---- 10 plucked strings</br>
&emsp;&emsp; "fff" - amp, pitch, pos</br>
&emsp;11 - 20 ---- 10 FM instruments</br>
&emsp;&emsp;"ffff" - dur amp pitch pos</br>
&emsp;&emsp;"ffffff" - dur, ampl, c_fr, m_fr, ind, pos</br>
&emsp;21 - 30 ---- 10 FM bells</br>
&emsp;&emsp; "fffffff" - dur, ampl, pitch,  gliss, rat,  ind,  pos</br>
&emsp;31 - 34 ---- 4 sound files (words)</br>
&emsp;&emsp;"ff" - amp, pos</br>
&emsp;35 - 50 ---- 16 SHARC SOS voices (different instruments)</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;51 - 55 ---- 5 basic SHARC-spectrum instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;56 - 61 ---- 5 SHARC-instrument additive cross-fade instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;62 - 63 ---- 2 granular scramblers</br>
&emsp;&emsp;dur, ampl</br>
&emsp;64 - 67 ---- 4 granular shifters</br>
&emsp;&emsp;dur, ampl</br>
&emsp;68-75 ---- 8 SoundFont sample players</br>
&emsp;&emsp;"fffff" - dur, chan, key, ampl, pos</br>
&emsp;&emsp;"s" - load sound file given full file name (cmd 156 = set_file_f)</br>
</br>
&emsp;[EventScheduler interrupt; flush]</br>
&emsp;[OSCVoice fmExample1]</br>
&emsp;[OSCVoice fmExample2]</br>
&emsp;[OSCVoice pluckExample1]</br>
&emsp;[OSCVoice sndExample1]</br>
&emsp;[OSCVoice sndExample2]</br>
&emsp;[OSCVoice sharcExample1]</br>
&emsp;[OSCVoice bellExample1]</br>
&emsp;[OSCVoice vSOSExample1]</br>
&emsp;[OSCVoice granulatorExample1]</br>
&emsp;[OSCVoice granulatorExample2: 1]</br>
</br>
SoundFont Sampler tests</br>
</br>
&emsp;[OSCVoice new send: '/i68/fi' args: '/Users/stp/Code/Audio/Synths/SoundFonts/male.sf2' ]</br>
</br>
SndSynth Tests</br>
</br>
&emsp;ScorePlayerMorph new openMIDIFile - fix this</br>
</br>
----------------------------------------------------------------------------</br>
----------------------------------------------------------------------------</br>
</br>
Music Font debugging</br>
</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) browseAllGlyphs]</br>
&emsp;&emsp;&emsp;&emsp;</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E1D0 to: 16r00E1E7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00ECA0 to: 16r00ECB7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E0A0 to: 16r00E0FC]</br>
</br>
[(((StrikeFont familyName: 'Bravura' size: 100) pointSize: 100) characterFormAtCode: 16r00E1D2) </br>
&emsp;&emsp;displayOn: Display at: (256@256) clippingBox: Display boundingBox </br>
&emsp;&emsp;rule: Form paint fillColor: Color black]</br>
</br>
[DisplayListView loadNoteGlyphsFromFontSized: 100]"&emsp;"load music icons from the font"</br>
DisplayVisual displayMusicGlyphs</br>
</br>
</br>
(((DisplayListView glyphs at: #StdNoteIcons) at: '1' asSymbol) image image) bitEdit</br>
Offsets:</br>
&emsp;1/1 -> 6 @ 66</br>
&emsp;1/2 -> 5 @ 66</br>
(((DisplayListView glyphs at: #OtherNoteIcons) at: '4' asSymbol) image image) bitEdit</br>
&emsp;Offsets (5 @ 45)</br>
</br>
----</br>
</br>
Loading transport icons</br>
</br>
[ | folder |</br>
&emsp;DisplayListView glyphs at: #Transport put: Dictionary new.</br>
&emsp;folder := (FileDirectory default directoryNamed: </br>
&emsp;&emsp;&emsp;&emsp;'Siren9C/Data/Fonts/transport_icons') name, '/'.</br>
&emsp;((FileDirectory on: folder) fileNamesMatching: '*.png') do:</br>
&emsp;[ :jpg | | form |</br>
&emsp;form := (Form fromFileNamed: folder, jpg).</br>
&emsp;form := form scaledToSize: 16 @ 16.</br>
&emsp;(DisplayListView glyphs at: #Transport) at: (jpg copyUpTo: $.) asSymbol put: form]]</br>
</br>
[ | gly right down left up |</br>
gly := DisplayListView glyphs at: #Transport.</br>
right := gly at: #'right-arrow'.</br>
down := right rotateBy: #right centerAt: 0@0.</br>
left := right rotateBy: #pi centerAt: 0@0.</br>
up := right rotateBy: #left centerAt: 0@0.</br>
gly at: #'down-arrow' put: down.</br>
gly at: #'left-arrow' put: left.</br>
gly at: #'up-arrow' put: up.</br>
</br>
right := gly at: #'fast-forward'.</br>
down := right rotateBy: #pi centerAt: 0@0.</br>
gly at: #'rewind' put: down.</br>
</br>
]</br>
</br>
[(DisplayListView glyphs at: #Transport) explore]</br>
</br>
[DisplayListView loadNoteGlyphsFrom: 16r00E1D0 to: 16r00E1E7</br>
&emsp;&emsp;keys: #('2' '4' '1' '1/2' '1/2d' '1/4' '1/4d' '1/8' '1/8d' '1/16' '1/16d' '1/32' '1/32d'  '1/64' '1/64d' )</br>
&emsp;&emsp;into: #StdNoteIcons.</br>
DisplayListView shrinkGlyphs.</br>
DisplayListView tweakGlyphs]</br>
</br>
[DisplayVisual displayMusicGlyphs: #StdNoteIcons]</br>
[HauerSteffensView scaleExample]</br>
[HauerSteffensView scaleExample2]</br>
[EventList accellExample edit]</br>
</br>
</br>
</br>
</br>
</p><hr><h3 id="EventModifiersandMappingFunctions">15 - EventModifiers and Mapping Functions</h3>Test Workspace - stp - 230128</br>
</br>
Known bugs</br>
&emsp;TSV selection update</br>
&emsp;PTV time-region selection(?)</br>
&emsp;DLV selection handles scale with zoom</br>
&emsp;PitchClass octave bugs - (HungarianMinor root: N fa) asPitchesInOctave: 3</br>
&emsp;Ostinato doesn't wait right.</br>
</br>
ToDo</br>
&emsp;MIDI input: kbd & ctrlrs</br>
&emsp;Function & Sound editors</br>
&emsp;CSL vocoder resynth stage</br>
&emsp;New transport panel</br>
</br>
Post-build testing</br>
</br>
Test plug-ins</br>
</br>
&emsp;CStandardLibrary new abs: -42 </br>
&emsp;FFITestLibrary ffiPrintString: 'Hello' </br>
&emsp;FFITestLibrary ffiTestChars: $A with: 32 with: 0 with: 0</br>
&emsp;FFITestLibrary ffiTestInts: 100 with: 32 with: 0 with: 0 </br>
&emsp;[ExternalAddress loadSymbol: 'pm_initialize' module: PortMIDILibrary moduleName]</br>
&emsp;[ExternalAddress loadSymbol: 'not-there' module: PortMIDILibrary moduleName]</br>
</br>
&emsp;[Undeclared inspect]</br>
&emsp;[Smalltalk garbageCollect]</br>
&emsp;[Utilities openUsefulExpressions]</br>
&emsp;[DirectoryEntry currentDirectory]</br>
&emsp;[DependentsFields]</br>
&emsp;[MIDIPort allNotesOff]</br>
&emsp;[MIDIPort cleanUp]</br>
</br>
New Siren GUI Tools</br>
</br>
&emsp;[SirenSession openUtilityVert]</br>
&emsp;[VoiceDialog open]</br>
</br>
==================================</br>
</br>
Display list view examples</br>
</br>
&emsp;[DisplayListView exampleRectangles]</br>
&emsp;[DisplayRectangle rectangleExample2]&emsp;&emsp;"slow - uses rotated rects"</br>
&emsp;[DisplayListView exampleLines]</br>
&emsp;[DisplayListView examplePolylines]</br>
&emsp;[DisplayListView exampleVisuals]</br>
&emsp;[(DisplayList stringsX: 6000 byY: 10000) display]</br>
&emsp;[DisplayListView exampleMixed]&emsp;&emsp;"huge display list - takes a while"</br>
&emsp;[DisplayList exampleHierarchical display]</br>
</br>
&emsp;Display the old and new glyph catalogs</br>
</br>
&emsp;[DisplayVisual displayMusicConstants]&emsp;&emsp;</br>
&emsp;[DisplayVisual displayMusicGlyphs]&emsp;</br>
</br>
Music notation demos</br>
</br>
&emsp;[TimeSequenceView randomExample]</br>
&emsp;[PitchTimeView randomExample]</br>
&emsp;[PitchTimeView randomExample2]</br>
&emsp;[EventList randomSWSSExample2 editPTV]</br>
&emsp;[HauerSteffensView randomExampleQ]</br>
&emsp;[HauerSteffensView cloudExample]</br>
&emsp;[HauerSteffensView cloudsExample]</br>
&emsp;[HauerSteffensView cloudsExample2]</br>
&emsp;[DynamicCloud focusExample]</br>
&emsp;[HauerSteffensView scaleExample]</br>
&emsp;[HauerSteffensView scaleExample2]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[PitchTimeView openOnEventList: EventList randomExample label: 'P T V' pianoRoll: true]</br>
&emsp;[EventList accellExample open]</br>
</br>
Advanced Event Generators</br>
</br>
&emsp;[(Peal on: #(60 62 64 65) duration: (1/8) beat) eventList editPTV]</br>
&emsp;[Arpeggio example1]&emsp;&emsp; "Plays midi"</br>
</br>
&emsp;[Score11 melody1]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[ExtDynamicSelectionCloud chordExample2]</br>
</br>
Function views</br>
</br>
&emsp;[Function functionViewExample]</br>
&emsp;[FunctionView multiFunctionExample]</br>
&emsp;[FunctionView onFunctions: (Function fromFile: 'G1.2a1.env')]</br>
</br>
--------------------------</br>
</br>
Roll timing tests</br>
</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList asSoundScore play]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList playOn: MIDIVoice default]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList </br>
&emsp;&emsp;&emsp;&emsp;&emsp;playOn: (OSCVoice cslHost: pMapForCSLSimpleFM)]</br>
</br>
----</br>
</br>
MIDI Tests</br>
</br>
&emsp;[PortMIDILibrary pm_count_devices ]</br>
&emsp;[PortMIDILibrary pm_default_input_device ] </br>
&emsp;[PortMIDILibrary pm_default_output_device ] </br>
&emsp;PortMIDILibrary pm_test: PortMIDILibrary new pm_default_output_device </br>
&emsp;[PortMIDIPort listDeviceTable]</br>
&emsp;[PortMIDILibrary testAllNotes]</br>
&emsp;[ExternalLibrary clearAllCaches.]</br>
&emsp;[PortMIDILibrary pm_terminate]</br>
&emsp;[MIDIVoice scaleExample]</br>
&emsp;[MIDIVoice randomExample]</br>
</br>
Various verbose MIDIVoice creation methods</br>
</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice defaultOut: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Kontakt' channel: 3)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Nord' channel: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice on: </br>
&emsp;&emsp;&emsp;(MIDIDevice </br>
&emsp;&emsp;&emsp;&emsp;outOn: (PortMIDIPort indexOfOutNamed: '*Kontakt*') </br>
&emsp;&emsp;&emsp;&emsp;port: MIDIPort concreteClass default) </br>
&emsp;&emsp;&emsp;channel: 3)]</br>
&emsp;[PortMIDIPort streams]</br>
&emsp;[EventList multiVoiceExample playOn: MIDIVoice default]</br>
</br>
OSC Tests</br>
</br>
&emsp;Default CSL Synthesis Server Instruments (see CSL7/Src/IO/OSC_main.cpp)</br>
</br>
&emsp;1 - 10 ---- 10 plucked strings</br>
&emsp;&emsp; "fff" - amp, pitch, pos</br>
&emsp;11 - 20 ---- 10 FM instruments</br>
&emsp;&emsp;"ffff" - dur amp pitch pos</br>
&emsp;&emsp;"ffffff" - dur, ampl, c_fr, m_fr, ind, pos</br>
&emsp;21 - 30 ---- 10 FM bells</br>
&emsp;&emsp; "fffffff" - dur, ampl, pitch,  gliss, rat,  ind,  pos</br>
&emsp;31 - 34 ---- 4 sound files (words)</br>
&emsp;&emsp;"ff" - amp, pos</br>
&emsp;35 - 50 ---- 16 SHARC SOS voices (different instruments)</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;51 - 55 ---- 5 basic SHARC-spectrum instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;56 - 61 ---- 5 SHARC-instrument additive cross-fade instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;62 - 63 ---- 2 granular scramblers</br>
&emsp;&emsp;dur, ampl</br>
&emsp;64 - 67 ---- 4 granular shifters</br>
&emsp;&emsp;dur, ampl</br>
&emsp;68-75 ---- 8 SoundFont sample players</br>
&emsp;&emsp;"fffff" - dur, chan, key, ampl, pos</br>
&emsp;&emsp;"s" - load sound file given full file name (cmd 156 = set_file_f)</br>
</br>
&emsp;[EventScheduler interrupt; flush]</br>
&emsp;[OSCVoice fmExample1]</br>
&emsp;[OSCVoice fmExample2]</br>
&emsp;[OSCVoice pluckExample1]</br>
&emsp;[OSCVoice sndExample1]</br>
&emsp;[OSCVoice sndExample2]</br>
&emsp;[OSCVoice sharcExample1]</br>
&emsp;[OSCVoice bellExample1]</br>
&emsp;[OSCVoice vSOSExample1]</br>
&emsp;[OSCVoice granulatorExample1]</br>
&emsp;[OSCVoice granulatorExample2: 1]</br>
</br>
SoundFont Sampler tests</br>
</br>
&emsp;[OSCVoice new send: '/i68/fi' args: '/Users/stp/Code/Audio/Synths/SoundFonts/male.sf2' ]</br>
</br>
SndSynth Tests</br>
</br>
&emsp;ScorePlayerMorph new openMIDIFile - fix this</br>
</br>
----------------------------------------------------------------------------</br>
----------------------------------------------------------------------------</br>
</br>
Music Font debugging</br>
</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) browseAllGlyphs]</br>
&emsp;&emsp;&emsp;&emsp;</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E1D0 to: 16r00E1E7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00ECA0 to: 16r00ECB7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E0A0 to: 16r00E0FC]</br>
</br>
[(((StrikeFont familyName: 'Bravura' size: 100) pointSize: 100) characterFormAtCode: 16r00E1D2) </br>
&emsp;&emsp;displayOn: Display at: (256@256) clippingBox: Display boundingBox </br>
&emsp;&emsp;rule: Form paint fillColor: Color black]</br>
</br>
[DisplayListView loadNoteGlyphsFromFontSized: 100]"&emsp;"load music icons from the font"</br>
DisplayVisual displayMusicGlyphs</br>
</br>
</br>
(((DisplayListView glyphs at: #StdNoteIcons) at: '1' asSymbol) image image) bitEdit</br>
Offsets:</br>
&emsp;1/1 -> 6 @ 66</br>
&emsp;1/2 -> 5 @ 66</br>
(((DisplayListView glyphs at: #OtherNoteIcons) at: '4' asSymbol) image image) bitEdit</br>
&emsp;Offsets (5 @ 45)</br>
</br>
----</br>
</br>
Loading transport icons</br>
</br>
[ | folder |</br>
&emsp;DisplayListView glyphs at: #Transport put: Dictionary new.</br>
&emsp;folder := (FileDirectory default directoryNamed: </br>
&emsp;&emsp;&emsp;&emsp;'Siren9C/Data/Fonts/transport_icons') name, '/'.</br>
&emsp;((FileDirectory on: folder) fileNamesMatching: '*.png') do:</br>
&emsp;[ :jpg | | form |</br>
&emsp;form := (Form fromFileNamed: folder, jpg).</br>
&emsp;form := form scaledToSize: 16 @ 16.</br>
&emsp;(DisplayListView glyphs at: #Transport) at: (jpg copyUpTo: $.) asSymbol put: form]]</br>
</br>
[ | gly right down left up |</br>
gly := DisplayListView glyphs at: #Transport.</br>
right := gly at: #'right-arrow'.</br>
down := right rotateBy: #right centerAt: 0@0.</br>
left := right rotateBy: #pi centerAt: 0@0.</br>
up := right rotateBy: #left centerAt: 0@0.</br>
gly at: #'down-arrow' put: down.</br>
gly at: #'left-arrow' put: left.</br>
gly at: #'up-arrow' put: up.</br>
</br>
right := gly at: #'fast-forward'.</br>
down := right rotateBy: #pi centerAt: 0@0.</br>
gly at: #'rewind' put: down.</br>
</br>
]</br>
</br>
[(DisplayListView glyphs at: #Transport) explore]</br>
</br>
[DisplayListView loadNoteGlyphsFrom: 16r00E1D0 to: 16r00E1E7</br>
&emsp;&emsp;keys: #('2' '4' '1' '1/2' '1/2d' '1/4' '1/4d' '1/8' '1/8d' '1/16' '1/16d' '1/32' '1/32d'  '1/64' '1/64d' )</br>
&emsp;&emsp;into: #StdNoteIcons.</br>
DisplayListView shrinkGlyphs.</br>
DisplayListView tweakGlyphs]</br>
</br>
[DisplayVisual displayMusicGlyphs: #StdNoteIcons]</br>
[HauerSteffensView scaleExample]</br>
[HauerSteffensView scaleExample2]</br>
[EventList accellExample edit]</br>
</br>
</br>
</br>
</br>
</p><hr><h3 id="SchedulersandReal-timeIOforSiren">16 - Schedulers and Real-time IO for Siren</h3>Schedulers and Real-time Performance</br>
</br>
Event lists have events sorted by their relative start times. One "performs" event lists by placing them in a schedule for performance. A schedule can have one or more client objects (usually event lists whose items are simple events, sound events, or function events) that are able to do something in response to the</br>
</br>
</br>
&emsp;anEvent scheduleAt: aTime</br>
</br>
</br>
message. The return value from this message is assumed to be the delay (in usec) before calling the client again. Event lists typically perform the next event (by passing it to its voice) and answer the relative delta time to the next event (which may be 0 for simultaneous events).</br>
</br>
The EventScheduler instance can be accessed by a class message (instance) to class EventScheduler; it can be used to sequence and synchronize event lists that may include a variety of events, event lists, and voices. The Scheduler messages for adding a new "client" and running the schedule are as shown below.</br>
</br>
Play some random notes on the devault voice</br>
</br>
</br>
&emsp;[EventScheduler addClient: (EventList randomExample: 20) at: 500 msec.</br>
&emsp; EventScheduler run]</br>
</br>
Run the simple flashing rectangles example</br>
</br>
</br>
&emsp;[EventScheduler addClient: ActionEvent listExample in: 100 msec; run]</br>
</br>
House-keeping messages</br>
&emsp;[EventScheduler isRunning]</br>
&emsp;[EventScheduler interrupt]</br>
&emsp;[EventScheduler flush]</br>
&emsp;[EventScheduler initialize]</br>
</br>
Get the instance</br>
&emsp;[EventScheduler instance]</br>
</br>
If the SirenUtility vertbosity is set to 2 (very verbose), and you hold down the <SHIFT> key, the schedule will print a timer to the Transcript (useful for testing).</br>
</br>
You can always stop and flush the scheduler with a button in the Siren Utility window</br>
.</br>
</br>
The standard voices for MIDI and OSC output use the built-in schedule for their timing.</br>
Play 64 notes lasting 80 msec--a good test of real-time performance.</br>
This is scheduled in the port, i.e., at the lowest-possible level.</br>
&emsp;[MIDIPort testRandomPlay2: 64 dur: 80]</br>
</br>
Test a roll--it's easier to hear scheduler jitter here. The first example uses the low-level port delays. (try it several times to hear the changes in the jitter.)</br>
&emsp;[MIDIPort testRoll: 40 dur: 60]</br>
</br>
This should sound about the same, but plays an event generator over the the high-level scheduler.</br>
&emsp;[((Roll length: 2400 rhythm: 60 note: 60) ampl: 96) play]</br>
</br>
This example uses the high-level EventScheduler to play a scale. (Jitter is harder to hear here.)</br>
&emsp;[MIDIDevice scheduleExample]</br>
</br>
Scheduler Internals</br>
</br>
The EventScheduler instance (Schedule) holds onto 2 SEventQueues, one for normal clients, and one for timers. The SEventQueue is a simple doubly-linked list of ScheduleRecord objects sorted by start time (with a class pool of ScheduleRecords and an efficient insert method). All times are in microseconds (meaning long integers).</br>
</br>
The main scheduler loop is in the method run forks a process running the loop</br>
&emsp;[running] whileTrue: [self callNextAppointment]</br>
</br>
</br>
It's the callNextAppointment method that looks for a client or timer that's ready and schedules it. If there's nothing to do, the loop sleeps a bit; the actual amount of the inner delay is a class variable.</br>
</p><hr><h3 id="VoicesandProperty-to-ParameterMapping">17 - Voices and Property-to-Parameter Mapping</h3>Voices and Ports in Siren</br>
</br>
The "performance" of events takes place via voice objects. Event properties are assumed to be independent of the parameters of any synthesis instrument or algorithm. A voice object is a "property-to-parameter mapper" that knows about one or more output or input formats for Smoke data. There are voice "device drivers" for common file storage formats--such as note lists file formats for various software sound synthesis packages or MIDI files--or for use with real-time schedulers connected to MIDI, OSC, CSL, or SuperCollider drivers. These classes can be refined to add new event and signal file formats or multilevel mapping (e.g., for MIDI system exclusive messages) in an abstract way. </br>
</br>
Voice objects can also read input streams (e.g., real-time controller data or output from a coprocess), and send messages to other voices, schedulers, event modifiers or event generators. This is how one uses the system for real-time control of complex structures.</br>
</br>
The actual property-to-parameter mapping is often controlled by a dictionary or a block (the parameter map) that takes the properties of an event and creates a statement or command for some output format. This allows the user to customize the voices at run-time (see the OSCVoice class for good examples).</br>
</br>
Voices and Schedulers</br>
</br>
Some voices are "timeless" (e.g., MIDI file readers); they operate at full speed regardless of the relative time of the event list they read or write. Others assume that some scheduler hands events to their voices in real time during performance. The EventScheduler does just this; it can be used to sequence and synchronize event lists that may include a variety of voices.</br>
</br>
Examples</br>
</br>
Create a random event list and write it out to notelist files in any of several formats. Edit the file.</br>
</br>
&emsp;[CsoundVoice randomExampleToFileAndEdit]</br>
&emsp;[SuperColliderVoice randomExampleToFileAndEdit]</br>
&emsp;[CmixVoice randomExampleToFileAndEdit]</br>
&emsp;[CmusicVoice randomExampleToFileAndEdit]</br>
</br>
</br>
Create an event list of 20 notes with semi-random values and play it on a MIDI output voice.</br>
</br>
&emsp;[(EventList randomExample: 20) playOn: MIDIVoice default]</br>
</br>
Use the same random list creation method, but add three lists in parallel.</br>
</br>
&emsp;[((EventList newNamed: #pRand)</br>
&emsp;&emsp;&emsp;addAll: (EventList randomExample: 40);</br>
&emsp;&emsp;&emsp;addAll: (EventList randomExample: 40);</br>
&emsp;&emsp;&emsp;addAll: (EventList randomExample: 40))</br>
&emsp;&emsp;playOn: MIDIVoice new]</br>
</br>
Complex Multimedia Example: Generate and play a mixed-voice event list; a cloud plays alternating notes on MIDI and built-in synthesis, and a list of action events flashes screen rectangles in parallel.</br>
</br>
&emsp;[ | el |</br>
&emsp;el := (Cloud dur: 6&emsp; sec&emsp;&emsp;&emsp;"Create a 6-second stochastic cloud"</br>
&emsp;&emsp;pitch: (48 to: 60)&emsp;&emsp;&emsp;&emsp;"choose pitches in this range"</br>
&emsp;&emsp;ampl: (40 to: 70) &emsp;&emsp;&emsp;&emsp;"choose amplitudes in this range"</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"select from these 2 voices"</br>
&emsp;&emsp;voice: (Array with: (MIDIVoice default) with: (OSCVoice default))</br>
&emsp;&emsp;density: 5) eventList.&emsp;&emsp;&emsp;"play 5 notes per sec. and get the events"</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"add some animation events"</br>
&emsp;el addAll: ActionEvent listExample.</br>
&emsp;el play]&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"and play the merged event list"</br>
</br>
Defaults</br>
</br>
The Voice class has a default subclass. This can be changed with the SirenUtility GUI.</br>
&emsp;[Voice default] i</br>
</br>
This can be changed with the Siren Utility view.</br>
</br>
As with EventLists, Voices can also be stored in a global dictionary and acccessed by name.</br>
</br>
&emsp;[SirenSession voice: #oscFM put: (OSCVoice map: #pMapForCSLSimpleFM)] d</br>
&emsp;[SirenSession voice: #defaultMIDI put: (MIDIVoice named: 'oboe' onDevice: (MIDIDevice on: 1) channel: 1)] d</br>
&emsp;[SirenSession voiceNamed: #oscFM] i</br>
</br>
</br>
There's a tool called the VoiceDialog for creating voices, try it out.  The left-most section is for selecting the medium (MIDI, OSC, Sound and File) and voice name.  The other sections are dependent on the selected medium, and allow one to configure voices. The "Create voice" button then creates the voice in the global dictionary of voices.</br>
</br>
&emsp;[VoiceDialog open] d</br>
</br>
</br>
</br>
MIDI Input Voices (broken in Siren 9C)</br>
</br>
The MIDI file voice can read standard MIDI file format and generate a Siren event list, as in the example below.</br>
</br>
&emsp;[(MIDIFileVoice newOn: 'jazzrock.mid')</br>
&emsp;&emsp;readOnto: (EventList newNamed: #JR).</br>
&emsp;(EventList named: #JR) explore]</br>
</br>
Extending the Voice Framework</br>
</br>
By adding new voice classes, you can add parsers and generators for new score file formats, or extend the system with new real-time output driver interfaces. Look at the uses of the parameter maps in the notelist voices, or the OSC and CSL voices.</br>
</p><hr><h3 id="MIDIIOandControlinSiren">18 - MIDI IO and Control in Siren</h3>Test Workspace - stp - 230128</br>
</br>
Known bugs</br>
&emsp;TSV selection update</br>
&emsp;PTV time-region selection(?)</br>
&emsp;DLV selection handles scale with zoom</br>
&emsp;PitchClass octave bugs - (HungarianMinor root: N fa) asPitchesInOctave: 3</br>
&emsp;Ostinato doesn't wait right.</br>
</br>
ToDo</br>
&emsp;MIDI input: kbd & ctrlrs</br>
&emsp;Function & Sound editors</br>
&emsp;CSL vocoder resynth stage</br>
&emsp;New transport panel</br>
</br>
Post-build testing</br>
</br>
Test plug-ins</br>
</br>
&emsp;CStandardLibrary new abs: -42 </br>
&emsp;FFITestLibrary ffiPrintString: 'Hello' </br>
&emsp;FFITestLibrary ffiTestChars: $A with: 32 with: 0 with: 0</br>
&emsp;FFITestLibrary ffiTestInts: 100 with: 32 with: 0 with: 0 </br>
&emsp;[ExternalAddress loadSymbol: 'pm_initialize' module: PortMIDILibrary moduleName]</br>
&emsp;[ExternalAddress loadSymbol: 'not-there' module: PortMIDILibrary moduleName]</br>
</br>
&emsp;[Undeclared inspect]</br>
&emsp;[Smalltalk garbageCollect]</br>
&emsp;[Utilities openUsefulExpressions]</br>
&emsp;[DirectoryEntry currentDirectory]</br>
&emsp;[DependentsFields]</br>
&emsp;[MIDIPort allNotesOff]</br>
&emsp;[MIDIPort cleanUp]</br>
</br>
New Siren GUI Tools</br>
</br>
&emsp;[SirenSession openUtilityVert]</br>
&emsp;[VoiceDialog open]</br>
</br>
==================================</br>
</br>
Display list view examples</br>
</br>
&emsp;[DisplayListView exampleRectangles]</br>
&emsp;[DisplayRectangle rectangleExample2]&emsp;&emsp;"slow - uses rotated rects"</br>
&emsp;[DisplayListView exampleLines]</br>
&emsp;[DisplayListView examplePolylines]</br>
&emsp;[DisplayListView exampleVisuals]</br>
&emsp;[(DisplayList stringsX: 6000 byY: 10000) display]</br>
&emsp;[DisplayListView exampleMixed]&emsp;&emsp;"huge display list - takes a while"</br>
&emsp;[DisplayList exampleHierarchical display]</br>
</br>
&emsp;Display the old and new glyph catalogs</br>
</br>
&emsp;[DisplayVisual displayMusicConstants]&emsp;&emsp;</br>
&emsp;[DisplayVisual displayMusicGlyphs]&emsp;</br>
</br>
Music notation demos</br>
</br>
&emsp;[TimeSequenceView randomExample]</br>
&emsp;[PitchTimeView randomExample]</br>
&emsp;[PitchTimeView randomExample2]</br>
&emsp;[EventList randomSWSSExample2 editPTV]</br>
&emsp;[HauerSteffensView randomExampleQ]</br>
&emsp;[HauerSteffensView cloudExample]</br>
&emsp;[HauerSteffensView cloudsExample]</br>
&emsp;[HauerSteffensView cloudsExample2]</br>
&emsp;[DynamicCloud focusExample]</br>
&emsp;[HauerSteffensView scaleExample]</br>
&emsp;[HauerSteffensView scaleExample2]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[PitchTimeView openOnEventList: EventList randomExample label: 'P T V' pianoRoll: true]</br>
&emsp;[EventList accellExample open]</br>
</br>
Advanced Event Generators</br>
</br>
&emsp;[(Peal on: #(60 62 64 65) duration: (1/8) beat) eventList editPTV]</br>
&emsp;[Arpeggio example1]&emsp;&emsp; "Plays midi"</br>
</br>
&emsp;[Score11 melody1]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[ExtDynamicSelectionCloud chordExample2]</br>
</br>
Function views</br>
</br>
&emsp;[Function functionViewExample]</br>
&emsp;[FunctionView multiFunctionExample]</br>
&emsp;[FunctionView onFunctions: (Function fromFile: 'G1.2a1.env')]</br>
</br>
--------------------------</br>
</br>
Roll timing tests</br>
</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList asSoundScore play]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList playOn: MIDIVoice default]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList </br>
&emsp;&emsp;&emsp;&emsp;&emsp;playOn: (OSCVoice cslHost: pMapForCSLSimpleFM)]</br>
</br>
----</br>
</br>
MIDI Tests</br>
</br>
&emsp;[PortMIDILibrary pm_count_devices ]</br>
&emsp;[PortMIDILibrary pm_default_input_device ] </br>
&emsp;[PortMIDILibrary pm_default_output_device ] </br>
&emsp;PortMIDILibrary pm_test: PortMIDILibrary new pm_default_output_device </br>
&emsp;[PortMIDIPort listDeviceTable]</br>
&emsp;[PortMIDILibrary testAllNotes]</br>
&emsp;[ExternalLibrary clearAllCaches.]</br>
&emsp;[PortMIDILibrary pm_terminate]</br>
&emsp;[MIDIVoice scaleExample]</br>
&emsp;[MIDIVoice randomExample]</br>
</br>
Various verbose MIDIVoice creation methods</br>
</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice defaultOut: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Kontakt' channel: 3)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Nord' channel: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice on: </br>
&emsp;&emsp;&emsp;(MIDIDevice </br>
&emsp;&emsp;&emsp;&emsp;outOn: (PortMIDIPort indexOfOutNamed: '*Kontakt*') </br>
&emsp;&emsp;&emsp;&emsp;port: MIDIPort concreteClass default) </br>
&emsp;&emsp;&emsp;channel: 3)]</br>
&emsp;[PortMIDIPort streams]</br>
&emsp;[EventList multiVoiceExample playOn: MIDIVoice default]</br>
</br>
OSC Tests</br>
</br>
&emsp;Default CSL Synthesis Server Instruments (see CSL7/Src/IO/OSC_main.cpp)</br>
</br>
&emsp;1 - 10 ---- 10 plucked strings</br>
&emsp;&emsp; "fff" - amp, pitch, pos</br>
&emsp;11 - 20 ---- 10 FM instruments</br>
&emsp;&emsp;"ffff" - dur amp pitch pos</br>
&emsp;&emsp;"ffffff" - dur, ampl, c_fr, m_fr, ind, pos</br>
&emsp;21 - 30 ---- 10 FM bells</br>
&emsp;&emsp; "fffffff" - dur, ampl, pitch,  gliss, rat,  ind,  pos</br>
&emsp;31 - 34 ---- 4 sound files (words)</br>
&emsp;&emsp;"ff" - amp, pos</br>
&emsp;35 - 50 ---- 16 SHARC SOS voices (different instruments)</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;51 - 55 ---- 5 basic SHARC-spectrum instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;56 - 61 ---- 5 SHARC-instrument additive cross-fade instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;62 - 63 ---- 2 granular scramblers</br>
&emsp;&emsp;dur, ampl</br>
&emsp;64 - 67 ---- 4 granular shifters</br>
&emsp;&emsp;dur, ampl</br>
&emsp;68-75 ---- 8 SoundFont sample players</br>
&emsp;&emsp;"fffff" - dur, chan, key, ampl, pos</br>
&emsp;&emsp;"s" - load sound file given full file name (cmd 156 = set_file_f)</br>
</br>
&emsp;[EventScheduler interrupt; flush]</br>
&emsp;[OSCVoice fmExample1]</br>
&emsp;[OSCVoice fmExample2]</br>
&emsp;[OSCVoice pluckExample1]</br>
&emsp;[OSCVoice sndExample1]</br>
&emsp;[OSCVoice sndExample2]</br>
&emsp;[OSCVoice sharcExample1]</br>
&emsp;[OSCVoice bellExample1]</br>
&emsp;[OSCVoice vSOSExample1]</br>
&emsp;[OSCVoice granulatorExample1]</br>
&emsp;[OSCVoice granulatorExample2: 1]</br>
</br>
SoundFont Sampler tests</br>
</br>
&emsp;[OSCVoice new send: '/i68/fi' args: '/Users/stp/Code/Audio/Synths/SoundFonts/male.sf2' ]</br>
</br>
SndSynth Tests</br>
</br>
&emsp;ScorePlayerMorph new openMIDIFile - fix this</br>
</br>
----------------------------------------------------------------------------</br>
----------------------------------------------------------------------------</br>
</br>
Music Font debugging</br>
</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) browseAllGlyphs]</br>
&emsp;&emsp;&emsp;&emsp;</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E1D0 to: 16r00E1E7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00ECA0 to: 16r00ECB7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E0A0 to: 16r00E0FC]</br>
</br>
[(((StrikeFont familyName: 'Bravura' size: 100) pointSize: 100) characterFormAtCode: 16r00E1D2) </br>
&emsp;&emsp;displayOn: Display at: (256@256) clippingBox: Display boundingBox </br>
&emsp;&emsp;rule: Form paint fillColor: Color black]</br>
</br>
[DisplayListView loadNoteGlyphsFromFontSized: 100]"&emsp;"load music icons from the font"</br>
DisplayVisual displayMusicGlyphs</br>
</br>
</br>
(((DisplayListView glyphs at: #StdNoteIcons) at: '1' asSymbol) image image) bitEdit</br>
Offsets:</br>
&emsp;1/1 -> 6 @ 66</br>
&emsp;1/2 -> 5 @ 66</br>
(((DisplayListView glyphs at: #OtherNoteIcons) at: '4' asSymbol) image image) bitEdit</br>
&emsp;Offsets (5 @ 45)</br>
</br>
----</br>
</br>
Loading transport icons</br>
</br>
[ | folder |</br>
&emsp;DisplayListView glyphs at: #Transport put: Dictionary new.</br>
&emsp;folder := (FileDirectory default directoryNamed: </br>
&emsp;&emsp;&emsp;&emsp;'Siren9C/Data/Fonts/transport_icons') name, '/'.</br>
&emsp;((FileDirectory on: folder) fileNamesMatching: '*.png') do:</br>
&emsp;[ :jpg | | form |</br>
&emsp;form := (Form fromFileNamed: folder, jpg).</br>
&emsp;form := form scaledToSize: 16 @ 16.</br>
&emsp;(DisplayListView glyphs at: #Transport) at: (jpg copyUpTo: $.) asSymbol put: form]]</br>
</br>
[ | gly right down left up |</br>
gly := DisplayListView glyphs at: #Transport.</br>
right := gly at: #'right-arrow'.</br>
down := right rotateBy: #right centerAt: 0@0.</br>
left := right rotateBy: #pi centerAt: 0@0.</br>
up := right rotateBy: #left centerAt: 0@0.</br>
gly at: #'down-arrow' put: down.</br>
gly at: #'left-arrow' put: left.</br>
gly at: #'up-arrow' put: up.</br>
</br>
right := gly at: #'fast-forward'.</br>
down := right rotateBy: #pi centerAt: 0@0.</br>
gly at: #'rewind' put: down.</br>
</br>
]</br>
</br>
[(DisplayListView glyphs at: #Transport) explore]</br>
</br>
[DisplayListView loadNoteGlyphsFrom: 16r00E1D0 to: 16r00E1E7</br>
&emsp;&emsp;keys: #('2' '4' '1' '1/2' '1/2d' '1/4' '1/4d' '1/8' '1/8d' '1/16' '1/16d' '1/32' '1/32d'  '1/64' '1/64d' )</br>
&emsp;&emsp;into: #StdNoteIcons.</br>
DisplayListView shrinkGlyphs.</br>
DisplayListView tweakGlyphs]</br>
</br>
[DisplayVisual displayMusicGlyphs: #StdNoteIcons]</br>
[HauerSteffensView scaleExample]</br>
[HauerSteffensView scaleExample2]</br>
[EventList accellExample edit]</br>
</br>
</br>
</br>
</br>
</p><hr><h3 id="OpenSoundControl-OSCIO">19 - OpenSoundControl - OSC IO</h3>Test Workspace - stp - 230128</br>
</br>
Known bugs</br>
&emsp;TSV selection update</br>
&emsp;PTV time-region selection(?)</br>
&emsp;DLV selection handles scale with zoom</br>
&emsp;PitchClass octave bugs - (HungarianMinor root: N fa) asPitchesInOctave: 3</br>
&emsp;Ostinato doesn't wait right.</br>
</br>
ToDo</br>
&emsp;MIDI input: kbd & ctrlrs</br>
&emsp;Function & Sound editors</br>
&emsp;CSL vocoder resynth stage</br>
&emsp;New transport panel</br>
</br>
Post-build testing</br>
</br>
Test plug-ins</br>
</br>
&emsp;CStandardLibrary new abs: -42 </br>
&emsp;FFITestLibrary ffiPrintString: 'Hello' </br>
&emsp;FFITestLibrary ffiTestChars: $A with: 32 with: 0 with: 0</br>
&emsp;FFITestLibrary ffiTestInts: 100 with: 32 with: 0 with: 0 </br>
&emsp;[ExternalAddress loadSymbol: 'pm_initialize' module: PortMIDILibrary moduleName]</br>
&emsp;[ExternalAddress loadSymbol: 'not-there' module: PortMIDILibrary moduleName]</br>
</br>
&emsp;[Undeclared inspect]</br>
&emsp;[Smalltalk garbageCollect]</br>
&emsp;[Utilities openUsefulExpressions]</br>
&emsp;[DirectoryEntry currentDirectory]</br>
&emsp;[DependentsFields]</br>
&emsp;[MIDIPort allNotesOff]</br>
&emsp;[MIDIPort cleanUp]</br>
</br>
New Siren GUI Tools</br>
</br>
&emsp;[SirenSession openUtilityVert]</br>
&emsp;[VoiceDialog open]</br>
</br>
==================================</br>
</br>
Display list view examples</br>
</br>
&emsp;[DisplayListView exampleRectangles]</br>
&emsp;[DisplayRectangle rectangleExample2]&emsp;&emsp;"slow - uses rotated rects"</br>
&emsp;[DisplayListView exampleLines]</br>
&emsp;[DisplayListView examplePolylines]</br>
&emsp;[DisplayListView exampleVisuals]</br>
&emsp;[(DisplayList stringsX: 6000 byY: 10000) display]</br>
&emsp;[DisplayListView exampleMixed]&emsp;&emsp;"huge display list - takes a while"</br>
&emsp;[DisplayList exampleHierarchical display]</br>
</br>
&emsp;Display the old and new glyph catalogs</br>
</br>
&emsp;[DisplayVisual displayMusicConstants]&emsp;&emsp;</br>
&emsp;[DisplayVisual displayMusicGlyphs]&emsp;</br>
</br>
Music notation demos</br>
</br>
&emsp;[TimeSequenceView randomExample]</br>
&emsp;[PitchTimeView randomExample]</br>
&emsp;[PitchTimeView randomExample2]</br>
&emsp;[EventList randomSWSSExample2 editPTV]</br>
&emsp;[HauerSteffensView randomExampleQ]</br>
&emsp;[HauerSteffensView cloudExample]</br>
&emsp;[HauerSteffensView cloudsExample]</br>
&emsp;[HauerSteffensView cloudsExample2]</br>
&emsp;[DynamicCloud focusExample]</br>
&emsp;[HauerSteffensView scaleExample]</br>
&emsp;[HauerSteffensView scaleExample2]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[PitchTimeView openOnEventList: EventList randomExample label: 'P T V' pianoRoll: true]</br>
&emsp;[EventList accellExample open]</br>
</br>
Advanced Event Generators</br>
</br>
&emsp;[(Peal on: #(60 62 64 65) duration: (1/8) beat) eventList editPTV]</br>
&emsp;[Arpeggio example1]&emsp;&emsp; "Plays midi"</br>
</br>
&emsp;[Score11 melody1]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[ExtDynamicSelectionCloud chordExample2]</br>
</br>
Function views</br>
</br>
&emsp;[Function functionViewExample]</br>
&emsp;[FunctionView multiFunctionExample]</br>
&emsp;[FunctionView onFunctions: (Function fromFile: 'G1.2a1.env')]</br>
</br>
--------------------------</br>
</br>
Roll timing tests</br>
</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList asSoundScore play]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList playOn: MIDIVoice default]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList </br>
&emsp;&emsp;&emsp;&emsp;&emsp;playOn: (OSCVoice cslHost: pMapForCSLSimpleFM)]</br>
</br>
----</br>
</br>
MIDI Tests</br>
</br>
&emsp;[PortMIDILibrary pm_count_devices ]</br>
&emsp;[PortMIDILibrary pm_default_input_device ] </br>
&emsp;[PortMIDILibrary pm_default_output_device ] </br>
&emsp;PortMIDILibrary pm_test: PortMIDILibrary new pm_default_output_device </br>
&emsp;[PortMIDIPort listDeviceTable]</br>
&emsp;[PortMIDILibrary testAllNotes]</br>
&emsp;[ExternalLibrary clearAllCaches.]</br>
&emsp;[PortMIDILibrary pm_terminate]</br>
&emsp;[MIDIVoice scaleExample]</br>
&emsp;[MIDIVoice randomExample]</br>
</br>
Various verbose MIDIVoice creation methods</br>
</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice defaultOut: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Kontakt' channel: 3)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Nord' channel: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice on: </br>
&emsp;&emsp;&emsp;(MIDIDevice </br>
&emsp;&emsp;&emsp;&emsp;outOn: (PortMIDIPort indexOfOutNamed: '*Kontakt*') </br>
&emsp;&emsp;&emsp;&emsp;port: MIDIPort concreteClass default) </br>
&emsp;&emsp;&emsp;channel: 3)]</br>
&emsp;[PortMIDIPort streams]</br>
&emsp;[EventList multiVoiceExample playOn: MIDIVoice default]</br>
</br>
OSC Tests</br>
</br>
&emsp;Default CSL Synthesis Server Instruments (see CSL7/Src/IO/OSC_main.cpp)</br>
</br>
&emsp;1 - 10 ---- 10 plucked strings</br>
&emsp;&emsp; "fff" - amp, pitch, pos</br>
&emsp;11 - 20 ---- 10 FM instruments</br>
&emsp;&emsp;"ffff" - dur amp pitch pos</br>
&emsp;&emsp;"ffffff" - dur, ampl, c_fr, m_fr, ind, pos</br>
&emsp;21 - 30 ---- 10 FM bells</br>
&emsp;&emsp; "fffffff" - dur, ampl, pitch,  gliss, rat,  ind,  pos</br>
&emsp;31 - 34 ---- 4 sound files (words)</br>
&emsp;&emsp;"ff" - amp, pos</br>
&emsp;35 - 50 ---- 16 SHARC SOS voices (different instruments)</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;51 - 55 ---- 5 basic SHARC-spectrum instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;56 - 61 ---- 5 SHARC-instrument additive cross-fade instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;62 - 63 ---- 2 granular scramblers</br>
&emsp;&emsp;dur, ampl</br>
&emsp;64 - 67 ---- 4 granular shifters</br>
&emsp;&emsp;dur, ampl</br>
&emsp;68-75 ---- 8 SoundFont sample players</br>
&emsp;&emsp;"fffff" - dur, chan, key, ampl, pos</br>
&emsp;&emsp;"s" - load sound file given full file name (cmd 156 = set_file_f)</br>
</br>
&emsp;[EventScheduler interrupt; flush]</br>
&emsp;[OSCVoice fmExample1]</br>
&emsp;[OSCVoice fmExample2]</br>
&emsp;[OSCVoice pluckExample1]</br>
&emsp;[OSCVoice sndExample1]</br>
&emsp;[OSCVoice sndExample2]</br>
&emsp;[OSCVoice sharcExample1]</br>
&emsp;[OSCVoice bellExample1]</br>
&emsp;[OSCVoice vSOSExample1]</br>
&emsp;[OSCVoice granulatorExample1]</br>
&emsp;[OSCVoice granulatorExample2: 1]</br>
</br>
SoundFont Sampler tests</br>
</br>
&emsp;[OSCVoice new send: '/i68/fi' args: '/Users/stp/Code/Audio/Synths/SoundFonts/male.sf2' ]</br>
</br>
SndSynth Tests</br>
</br>
&emsp;ScorePlayerMorph new openMIDIFile - fix this</br>
</br>
----------------------------------------------------------------------------</br>
----------------------------------------------------------------------------</br>
</br>
Music Font debugging</br>
</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) browseAllGlyphs]</br>
&emsp;&emsp;&emsp;&emsp;</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E1D0 to: 16r00E1E7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00ECA0 to: 16r00ECB7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E0A0 to: 16r00E0FC]</br>
</br>
[(((StrikeFont familyName: 'Bravura' size: 100) pointSize: 100) characterFormAtCode: 16r00E1D2) </br>
&emsp;&emsp;displayOn: Display at: (256@256) clippingBox: Display boundingBox </br>
&emsp;&emsp;rule: Form paint fillColor: Color black]</br>
</br>
[DisplayListView loadNoteGlyphsFromFontSized: 100]"&emsp;"load music icons from the font"</br>
DisplayVisual displayMusicGlyphs</br>
</br>
</br>
(((DisplayListView glyphs at: #StdNoteIcons) at: '1' asSymbol) image image) bitEdit</br>
Offsets:</br>
&emsp;1/1 -> 6 @ 66</br>
&emsp;1/2 -> 5 @ 66</br>
(((DisplayListView glyphs at: #OtherNoteIcons) at: '4' asSymbol) image image) bitEdit</br>
&emsp;Offsets (5 @ 45)</br>
</br>
----</br>
</br>
Loading transport icons</br>
</br>
[ | folder |</br>
&emsp;DisplayListView glyphs at: #Transport put: Dictionary new.</br>
&emsp;folder := (FileDirectory default directoryNamed: </br>
&emsp;&emsp;&emsp;&emsp;'Siren9C/Data/Fonts/transport_icons') name, '/'.</br>
&emsp;((FileDirectory on: folder) fileNamesMatching: '*.png') do:</br>
&emsp;[ :jpg | | form |</br>
&emsp;form := (Form fromFileNamed: folder, jpg).</br>
&emsp;form := form scaledToSize: 16 @ 16.</br>
&emsp;(DisplayListView glyphs at: #Transport) at: (jpg copyUpTo: $.) asSymbol put: form]]</br>
</br>
[ | gly right down left up |</br>
gly := DisplayListView glyphs at: #Transport.</br>
right := gly at: #'right-arrow'.</br>
down := right rotateBy: #right centerAt: 0@0.</br>
left := right rotateBy: #pi centerAt: 0@0.</br>
up := right rotateBy: #left centerAt: 0@0.</br>
gly at: #'down-arrow' put: down.</br>
gly at: #'left-arrow' put: left.</br>
gly at: #'up-arrow' put: up.</br>
</br>
right := gly at: #'fast-forward'.</br>
down := right rotateBy: #pi centerAt: 0@0.</br>
gly at: #'rewind' put: down.</br>
</br>
]</br>
</br>
[(DisplayListView glyphs at: #Transport) explore]</br>
</br>
[DisplayListView loadNoteGlyphsFrom: 16r00E1D0 to: 16r00E1E7</br>
&emsp;&emsp;keys: #('2' '4' '1' '1/2' '1/2d' '1/4' '1/4d' '1/8' '1/8d' '1/16' '1/16d' '1/32' '1/32d'  '1/64' '1/64d' )</br>
&emsp;&emsp;into: #StdNoteIcons.</br>
DisplayListView shrinkGlyphs.</br>
DisplayListView tweakGlyphs]</br>
</br>
[DisplayVisual displayMusicGlyphs: #StdNoteIcons]</br>
[HauerSteffensView scaleExample]</br>
[HauerSteffensView scaleExample2]</br>
[EventList accellExample edit]</br>
</br>
</br>
</br>
</br>
</p><hr><h3 id="AbstractandSampledSoundObjects">20 - Abstract and Sampled Sound Objects</h3>Test Workspace - stp - 230128</br>
</br>
Known bugs</br>
&emsp;TSV selection update</br>
&emsp;PTV time-region selection(?)</br>
&emsp;DLV selection handles scale with zoom</br>
&emsp;PitchClass octave bugs - (HungarianMinor root: N fa) asPitchesInOctave: 3</br>
&emsp;Ostinato doesn't wait right.</br>
</br>
ToDo</br>
&emsp;MIDI input: kbd & ctrlrs</br>
&emsp;Function & Sound editors</br>
&emsp;CSL vocoder resynth stage</br>
&emsp;New transport panel</br>
</br>
Post-build testing</br>
</br>
Test plug-ins</br>
</br>
&emsp;CStandardLibrary new abs: -42 </br>
&emsp;FFITestLibrary ffiPrintString: 'Hello' </br>
&emsp;FFITestLibrary ffiTestChars: $A with: 32 with: 0 with: 0</br>
&emsp;FFITestLibrary ffiTestInts: 100 with: 32 with: 0 with: 0 </br>
&emsp;[ExternalAddress loadSymbol: 'pm_initialize' module: PortMIDILibrary moduleName]</br>
&emsp;[ExternalAddress loadSymbol: 'not-there' module: PortMIDILibrary moduleName]</br>
</br>
&emsp;[Undeclared inspect]</br>
&emsp;[Smalltalk garbageCollect]</br>
&emsp;[Utilities openUsefulExpressions]</br>
&emsp;[DirectoryEntry currentDirectory]</br>
&emsp;[DependentsFields]</br>
&emsp;[MIDIPort allNotesOff]</br>
&emsp;[MIDIPort cleanUp]</br>
</br>
New Siren GUI Tools</br>
</br>
&emsp;[SirenSession openUtilityVert]</br>
&emsp;[VoiceDialog open]</br>
</br>
==================================</br>
</br>
Display list view examples</br>
</br>
&emsp;[DisplayListView exampleRectangles]</br>
&emsp;[DisplayRectangle rectangleExample2]&emsp;&emsp;"slow - uses rotated rects"</br>
&emsp;[DisplayListView exampleLines]</br>
&emsp;[DisplayListView examplePolylines]</br>
&emsp;[DisplayListView exampleVisuals]</br>
&emsp;[(DisplayList stringsX: 6000 byY: 10000) display]</br>
&emsp;[DisplayListView exampleMixed]&emsp;&emsp;"huge display list - takes a while"</br>
&emsp;[DisplayList exampleHierarchical display]</br>
</br>
&emsp;Display the old and new glyph catalogs</br>
</br>
&emsp;[DisplayVisual displayMusicConstants]&emsp;&emsp;</br>
&emsp;[DisplayVisual displayMusicGlyphs]&emsp;</br>
</br>
Music notation demos</br>
</br>
&emsp;[TimeSequenceView randomExample]</br>
&emsp;[PitchTimeView randomExample]</br>
&emsp;[PitchTimeView randomExample2]</br>
&emsp;[EventList randomSWSSExample2 editPTV]</br>
&emsp;[HauerSteffensView randomExampleQ]</br>
&emsp;[HauerSteffensView cloudExample]</br>
&emsp;[HauerSteffensView cloudsExample]</br>
&emsp;[HauerSteffensView cloudsExample2]</br>
&emsp;[DynamicCloud focusExample]</br>
&emsp;[HauerSteffensView scaleExample]</br>
&emsp;[HauerSteffensView scaleExample2]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[PitchTimeView openOnEventList: EventList randomExample label: 'P T V' pianoRoll: true]</br>
&emsp;[EventList accellExample open]</br>
</br>
Advanced Event Generators</br>
</br>
&emsp;[(Peal on: #(60 62 64 65) duration: (1/8) beat) eventList editPTV]</br>
&emsp;[Arpeggio example1]&emsp;&emsp; "Plays midi"</br>
</br>
&emsp;[Score11 melody1]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[ExtDynamicSelectionCloud chordExample2]</br>
</br>
Function views</br>
</br>
&emsp;[Function functionViewExample]</br>
&emsp;[FunctionView multiFunctionExample]</br>
&emsp;[FunctionView onFunctions: (Function fromFile: 'G1.2a1.env')]</br>
</br>
--------------------------</br>
</br>
Roll timing tests</br>
</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList asSoundScore play]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList playOn: MIDIVoice default]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList </br>
&emsp;&emsp;&emsp;&emsp;&emsp;playOn: (OSCVoice cslHost: pMapForCSLSimpleFM)]</br>
</br>
----</br>
</br>
MIDI Tests</br>
</br>
&emsp;[PortMIDILibrary pm_count_devices ]</br>
&emsp;[PortMIDILibrary pm_default_input_device ] </br>
&emsp;[PortMIDILibrary pm_default_output_device ] </br>
&emsp;PortMIDILibrary pm_test: PortMIDILibrary new pm_default_output_device </br>
&emsp;[PortMIDIPort listDeviceTable]</br>
&emsp;[PortMIDILibrary testAllNotes]</br>
&emsp;[ExternalLibrary clearAllCaches.]</br>
&emsp;[PortMIDILibrary pm_terminate]</br>
&emsp;[MIDIVoice scaleExample]</br>
&emsp;[MIDIVoice randomExample]</br>
</br>
Various verbose MIDIVoice creation methods</br>
</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice defaultOut: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Kontakt' channel: 3)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Nord' channel: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice on: </br>
&emsp;&emsp;&emsp;(MIDIDevice </br>
&emsp;&emsp;&emsp;&emsp;outOn: (PortMIDIPort indexOfOutNamed: '*Kontakt*') </br>
&emsp;&emsp;&emsp;&emsp;port: MIDIPort concreteClass default) </br>
&emsp;&emsp;&emsp;channel: 3)]</br>
&emsp;[PortMIDIPort streams]</br>
&emsp;[EventList multiVoiceExample playOn: MIDIVoice default]</br>
</br>
OSC Tests</br>
</br>
&emsp;Default CSL Synthesis Server Instruments (see CSL7/Src/IO/OSC_main.cpp)</br>
</br>
&emsp;1 - 10 ---- 10 plucked strings</br>
&emsp;&emsp; "fff" - amp, pitch, pos</br>
&emsp;11 - 20 ---- 10 FM instruments</br>
&emsp;&emsp;"ffff" - dur amp pitch pos</br>
&emsp;&emsp;"ffffff" - dur, ampl, c_fr, m_fr, ind, pos</br>
&emsp;21 - 30 ---- 10 FM bells</br>
&emsp;&emsp; "fffffff" - dur, ampl, pitch,  gliss, rat,  ind,  pos</br>
&emsp;31 - 34 ---- 4 sound files (words)</br>
&emsp;&emsp;"ff" - amp, pos</br>
&emsp;35 - 50 ---- 16 SHARC SOS voices (different instruments)</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;51 - 55 ---- 5 basic SHARC-spectrum instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;56 - 61 ---- 5 SHARC-instrument additive cross-fade instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;62 - 63 ---- 2 granular scramblers</br>
&emsp;&emsp;dur, ampl</br>
&emsp;64 - 67 ---- 4 granular shifters</br>
&emsp;&emsp;dur, ampl</br>
&emsp;68-75 ---- 8 SoundFont sample players</br>
&emsp;&emsp;"fffff" - dur, chan, key, ampl, pos</br>
&emsp;&emsp;"s" - load sound file given full file name (cmd 156 = set_file_f)</br>
</br>
&emsp;[EventScheduler interrupt; flush]</br>
&emsp;[OSCVoice fmExample1]</br>
&emsp;[OSCVoice fmExample2]</br>
&emsp;[OSCVoice pluckExample1]</br>
&emsp;[OSCVoice sndExample1]</br>
&emsp;[OSCVoice sndExample2]</br>
&emsp;[OSCVoice sharcExample1]</br>
&emsp;[OSCVoice bellExample1]</br>
&emsp;[OSCVoice vSOSExample1]</br>
&emsp;[OSCVoice granulatorExample1]</br>
&emsp;[OSCVoice granulatorExample2: 1]</br>
</br>
SoundFont Sampler tests</br>
</br>
&emsp;[OSCVoice new send: '/i68/fi' args: '/Users/stp/Code/Audio/Synths/SoundFonts/male.sf2' ]</br>
</br>
SndSynth Tests</br>
</br>
&emsp;ScorePlayerMorph new openMIDIFile - fix this</br>
</br>
----------------------------------------------------------------------------</br>
----------------------------------------------------------------------------</br>
</br>
Music Font debugging</br>
</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) browseAllGlyphs]</br>
&emsp;&emsp;&emsp;&emsp;</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E1D0 to: 16r00E1E7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00ECA0 to: 16r00ECB7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E0A0 to: 16r00E0FC]</br>
</br>
[(((StrikeFont familyName: 'Bravura' size: 100) pointSize: 100) characterFormAtCode: 16r00E1D2) </br>
&emsp;&emsp;displayOn: Display at: (256@256) clippingBox: Display boundingBox </br>
&emsp;&emsp;rule: Form paint fillColor: Color black]</br>
</br>
[DisplayListView loadNoteGlyphsFromFontSized: 100]"&emsp;"load music icons from the font"</br>
DisplayVisual displayMusicGlyphs</br>
</br>
</br>
(((DisplayListView glyphs at: #StdNoteIcons) at: '1' asSymbol) image image) bitEdit</br>
Offsets:</br>
&emsp;1/1 -> 6 @ 66</br>
&emsp;1/2 -> 5 @ 66</br>
(((DisplayListView glyphs at: #OtherNoteIcons) at: '4' asSymbol) image image) bitEdit</br>
&emsp;Offsets (5 @ 45)</br>
</br>
----</br>
</br>
Loading transport icons</br>
</br>
[ | folder |</br>
&emsp;DisplayListView glyphs at: #Transport put: Dictionary new.</br>
&emsp;folder := (FileDirectory default directoryNamed: </br>
&emsp;&emsp;&emsp;&emsp;'Siren9C/Data/Fonts/transport_icons') name, '/'.</br>
&emsp;((FileDirectory on: folder) fileNamesMatching: '*.png') do:</br>
&emsp;[ :jpg | | form |</br>
&emsp;form := (Form fromFileNamed: folder, jpg).</br>
&emsp;form := form scaledToSize: 16 @ 16.</br>
&emsp;(DisplayListView glyphs at: #Transport) at: (jpg copyUpTo: $.) asSymbol put: form]]</br>
</br>
[ | gly right down left up |</br>
gly := DisplayListView glyphs at: #Transport.</br>
right := gly at: #'right-arrow'.</br>
down := right rotateBy: #right centerAt: 0@0.</br>
left := right rotateBy: #pi centerAt: 0@0.</br>
up := right rotateBy: #left centerAt: 0@0.</br>
gly at: #'down-arrow' put: down.</br>
gly at: #'left-arrow' put: left.</br>
gly at: #'up-arrow' put: up.</br>
</br>
right := gly at: #'fast-forward'.</br>
down := right rotateBy: #pi centerAt: 0@0.</br>
gly at: #'rewind' put: down.</br>
</br>
]</br>
</br>
[(DisplayListView glyphs at: #Transport) explore]</br>
</br>
[DisplayListView loadNoteGlyphsFrom: 16r00E1D0 to: 16r00E1E7</br>
&emsp;&emsp;keys: #('2' '4' '1' '1/2' '1/2d' '1/4' '1/4d' '1/8' '1/8d' '1/16' '1/16d' '1/32' '1/32d'  '1/64' '1/64d' )</br>
&emsp;&emsp;into: #StdNoteIcons.</br>
DisplayListView shrinkGlyphs.</br>
DisplayListView tweakGlyphs]</br>
</br>
[DisplayVisual displayMusicGlyphs: #StdNoteIcons]</br>
[HauerSteffensView scaleExample]</br>
[HauerSteffensView scaleExample2]</br>
[EventList accellExample edit]</br>
</br>
</br>
</br>
</br>
</p><hr><h3 id="SoundFilesandStreamingSoundIO">21 - Sound Files and Streaming Sound IO</h3>Sound File I/O</br>
</br>
NOTE: THIS PAGE DESCRIBED THE OLD SIREN SAMPLED SOUND FRAMEWORK, WHICH HAS NOT YET BEEN MERGED WITH THE SQUEAK FRAMEWORK IN THE CATEGORY 'Sound-Synthesis'</br>
</br>
</br>
Siren sound objects can be read from and written to sound files using an external interface to Eric DeCastro's libSndFile library. This supports all popular (and many very obscure) sound file formats.</br>
</br>
Store a swept sine to a file</br>
&emsp;[(SampledSound sweepDur: 2.0 rate: 44100 from: 30 to: 300 chans: 1)</br>
&emsp;&emsp;&emsp;storeOnFileNamed: 'sweep.aiff']</br>
</br>
Look at the file using your favorite sound file editor, or do</br>
&emsp;[(SampledSound fromFile: 'sweep.aiff') edit]</br>
</br>
Read various file formats</br>
&emsp;[(SampledSound fromFile: 'unbelichtet.aiff') edit]</br>
&emsp;[(SampledSound fromFile: 'kombination1a.snd') edit]</br>
</br>
Streaming Sound Record/Playback</br>
</br>
To support real-time streaming sound recording and playback, an external interface is provided to the cross-platform PortAudio library. The singleton instance of PortAudioPort communicates with the external driver. As with the MIDI port, the sound port object loads and maintains a device table. For my system, this is,</br>
</br>
Sound Device Table 2007</br>
&emsp;1: Built-in Microphone 2 in 0 out 44100 Hz</br>
&emsp;2: Built-in Line Input 2 in 0 out 44100 Hz</br>
&emsp;3: Built-in Output 0 in 2 out 44100 Hz</br>
&emsp;4: TASCAM FW-1804 8 in 8 out 96000 Hz</br>
</br>
2020 Sound device table</br>
</br>
Found 6 PortAudio devices</br>
&emsp;&emsp;0: Built-in Output - 0 i 2 o   SR: 44100</br>
&emsp;&emsp;1: Display Audio - 1 i 2 o  (def_in)  SR: 44100</br>
&emsp;&emsp;2: USB audio CODEC - 0 i 2 o   SR: 48000</br>
&emsp;&emsp;3: USB audio CODEC - 1 i 0 o   SR: 48000</br>
&emsp;&emsp;4: BlackHole 16ch - 16 i 16 o   SR: 44100</br>
&emsp;&emsp;5: OrionStudio2017 - 32 i 32 o  (def_out)  SR: 44100</br>
PA_open_p: 2 out, sr 44100 bs 2048 fmt 8</br>
</br>
To play a sound file using the default external utility , use</br>
&emsp;[Sound playFile: 'unbelichtet.aiff']</br>
</br>
(see the method SirenUtility playSoundFile: to change the actual command line,)</br>
</br>
This example plays a 3-second sine wave sweep</br>
&emsp;[PortAudioPort playSweep]</br>
</br>
Same only 20 seconds long</br>
&emsp;[PortAudioPort playSweepLong]</br>
</br>
The class SoundPort is abstract and has two subclasses: PortAudioPort and SmartAudioPort. SmartAudioPort uses call-backs from the C callback into Smalltalk. It works for recording and playback, but is still buggy (clicks a lot); see the class examples.</br>
</p><hr><h3 id="TheSirenGraphicsFramework">22 - The Siren Graphics Framework</h3>The Siren Graphics Framework</br>
</br>
The Siren graphical applications are based on the simple display list graphics framework in the categories MusicUI-DisplayLists and MusicUI-DisplayListViews. This package includes display items such as lines, polygons, curves, text items, and images, hierarchical display lists, and display list views, editors, and controllers. The display list view/controller/editor are MVC components for viewing and manipulating display lists. Simple examples of the display list framework are given below.</br>
</br>
There are several layouts for the zoom/scroll bars; in the default layout, the bars are grouped on the left and bottom of the window. The zoom bars are gray sliders on the outside, and the scroll bars are the usual color and look, and are set inside of the zoom bars. Take a look at the following and use the zoom/scroll bars.</br>
</br>
</br>
&emsp;[DisplayList rectangleExample] d</br>
</br>
Note the light-blue control panel at the top-left corner of the view; this has buttons for scrolling, zooming and inspecting the display list view.  The 'o' key in the center zooms back to scale 1@1.  (Special note: the zoom-in/out buttons apply to the x-axis only if you have the shift key pressed.)</br>
</br>
The pop-up menu has many functions that are not implemented in the top-level display list view.</br>
</br>
Display random strings, lines, polylines, visual glyphs and rotated rectangles</br>
&emsp;[DisplayList stringExample]</br>
&emsp;[DisplayListView exampleLines]</br>
&emsp;[DisplayListView examplePolylines]</br>
&emsp;[DisplayListView exampleVisuals]</br>
</br>
&emsp;[DisplayRectangle rectangleExample2]&emsp;&emsp;"slow - uses rotated rects"</br>
</br>
Larger mixed display list </br>
&emsp;[DisplayList randomExample display]</br>
</br>
Display a hierarchical list</br>
&emsp;[DisplayListView exampleHierarchical]</br>
</br>
These examples create huge display lists to test display/scroll performance</br>
</br>
[(DisplayList stringsX: 6000 byY: 10000) display]</br>
[DisplayListView exampleMixed]&emsp;&emsp;&emsp;&emsp;"huge display list - takes a while"</br>
[DisplayList exampleHierarchical display]</br>
</br>
</br>
There are many more examples in the display item classes, and the display list view hierarchy.</br>
</br>
</br>
</br>
Layout Managers and Navigator MVC</br>
</br>
The Siren version of "Navigator MVC" framework is based on layout manager objects that can generate display lists from structured objects. This enables, for example, a variety of musical notations. </br>
</br>
LayoutManagers take data structures and generate display lists based on their layout policies. For example, to see a class inheritance hierarchy as an indented list, use an IndentedListLayoutManager as in,</br>
</br>
&emsp; [IndentedListLayoutManager colorListExample display]</br>
</br>
(Note that color denotes species in this example: red for durations, green for pitches, blue for amplitudes, etc.)</br>
</br>
To view the same structure as a tree-like layout, use an IndentedTreeLayoutManager, as in,</br>
</br>
&emsp;[IndentedTreeLayoutManager listExample display]</br>
</br>
</br>
</br>
Graphical Forms</br>
</br>
Siren includes a hierarchical dictionary of images for use in musical notations. Execute the following to display the various forms. The method below steps through the form dictionaries and displays them in a window.</br>
</br>
&emsp;[DisplayVisual displayMusicConstants]</br>
&emsp;[DisplayVisual displayMusicGlyphs]</br>
</p><hr><h3 id="SirenGUIsandApplicationSupport">23 - Siren GUIs and Application Support</h3>Siren GUI Applications</br>
</br>
Quick tour: http://fastlabinc.com/Siren/Doc/Siren.GUI_2007.html</br>
</br>
Based on the display list view framework and the Navigator layout managers, Siren implements a variety of musical notations. Layout managers serve as the basis for Siren's music notation applications. The basic event-oriented layout manager uses the horizontal axis to denote time (flowing from left to right), as in the next example, which opens a time sequence view on a random event list.</br>
</br>
&emsp;[TimeSequenceView randomExample]</br>
</br>
In the time sequence view, the "note head" signifies the event's voice, not the duration.  Try zooming this view.  Note also that the control panel now has a 4th row with buttons for rewind, stop and play.</br>
</br>
A pitch/time view is an extension of this that uses the vertical dimension to display an event's pitch, as in piano-roll notation; for example, to display a pitch/time view on a 3-stream event list, try,</br>
</br>
&emsp;[PitchTimeView randomExample]</br>
&emsp;[PitchTimeView openOnEventList: (EventList scaleFrom: 48 to: 84 in: 8)]</br>
</br>
In the above example, the note heads denote the events' voices, horizontal blue lines originating at the note heads show the events' lengths, and red vertical lines show the events' amplitudes. To see how this is done, look at class PitchTimeView's various implementation of the itemFor: method.</br>
</br>
Open a pitch/time view on a *very long* 3-stream event list.</br>
</br>
&emsp;[PitchTimeView randomExampleLong]</br>
</br>
A more complete example is Hauer-Steffens notation, which has a clef and staff lines as in common-practise notation.</br>
</br>
&emsp;[HauerSteffensView randomExample]</br>
&emsp;[HauerSteffensView randomSWSSExample]</br>
&emsp;[(EventList scaleFrom: 55 to: 67 in: 3) edit]</br>
</br>
Test panning and zooming these examples using the control panel.</br>
</br>
</br>
</br>
Sound View (VisualWorks-only to-date)</br>
</br>
The sound view is a simple waveform display. One can scroll, zoom, and edit.</br>
Use the pop-up menu to create sound objects based on a number of standard synthesis methods.</br>
</br>
&emsp;[(SampledSound sweepDur: 3.0 rate: 44100 from: 10 to: 400 chans: 1) edit]</br>
&emsp;[SoundView openOn: (SampledSound fromFile: 'kombination.snd')]</br>
</br>
File Browser Extensions</br>
</br>
Select a sound or score file in the file browser and note the new tab in the file pane. this allows you to play, edit, or remove files easily.</br>
</br>
See also</br>
</br>
&emsp;FunctionViews</br>
&emsp;Loris GUI Examples</br>
&emsp;LPC GUI Examples</br>
</br>
Extending Siren's MVC Framework</br>
</br>
One can of course easily build new notations and new editors with the Siren MVC framework and GUI widget set. New layout managers generally consist of less than 1 page of code, and new controller/editor functions are quite simple to add. Most new tools consist of composite panes that use the simple Siren display widgets as components, and add fancier editor behaviors.</br>
</p><hr><h3 id="UsingtheSirenUtilityPaneandTransports">24 - Using the Siren Utility Pane and Transports</h3>Using the Siren Utility Pane and Transports</br>
</br>
Support classes SirenUtility and SirenSession</br>
</br>
There are two classes (in category Music-Support) with utility and session management methods: SirenUtility and SirenSession.</br>
</br>
SirenUtility is never instantiated, but has class methods for a number of usefiul utility functions related to system configuration (global verbosity flag and search directories).  There are special functions for file search (see the section below on this page) and for handling s7 files (see below as well).  The SirenUtility class initialization method sets the global logging verbosity level and creates a couple of lists of directories for searching for sound or score files. Users will typically customize this method so that Siren can find their data files.</br>
</br>
SirenSession holds onto the user's persistent data (e.g., sounds, voices and scores) in class-side dictionaries. This means that, by default, every sound or score that you give a name to becomes persistent and is stored in your Smalltalk virtual image. There are special functions for loading these caches from your hard disk, or for flushing them.</br>
</br>
Links to the EventScheduler</br>
</br>
The SirenSession also registers itself as a dependent of the EventScheduler, so it handles event logging and transport functions.</br>
</br>
SirenUtility Panel</br>
</br>
There are two main GUIs for Siren configuration: the Utility and the Transport.</br>
</br>
The Siren utility panel has buttons for configuring and testing MIDI, sound, and OSC I/O, as well as for setting some global values such as the logging verbosity. There are also buttons in this panel for loading and flushing the session data.</br>
</br>
To open the Siren utility view, use the button in the Launcher, or execute,</br>
&emsp;[SirenSession openUtility] </br>
</br>
or use the new vertical version,</br>
</br>
&emsp;[SirenSession openUtilityVert] </br>
</br>
</br>
The left-most (or top-most) buttons in the pane are for setting up and testing the MIDI and OSC I/O defaults. The next section is for sound I/O configuration.</br>
</br>
SirenTransport Panel (VisualWorks-only to-date)</br>
</br>
The other SirenSession class GUI is the transport panel; to open this, hold down <SHIFT> while pressing the Siren utility button in the launcher, or execute,</br>
&emsp;[SirenSession openTransport] d</br>
</br>
The transport has menu buttons along the left for accessing your data (sounds, scores, and voices) and for controlling the EventScheduler. Below are some useful utility messages.</br>
</br>
&emsp;"SirenSession release"</br>
&emsp;"SirenSession instanceCount"</br>
&emsp;"SirenSession allInstances do: [ :ss | ss release]"</br>
&emsp;"EventScheduler instanceCount"</br>
&emsp;"EventScheduler instance"</br>
</br>
SirenUtility file tricks</br>
</br>
The folliowing examples demonstrate the SirenUtility class support for sound/score data. As mentioned above, users can customize the search directories by editing the SirenUtility class initialize method.</br>
</br>
Find a file with the given name in any of the user's sound/score folders</br>
</br>
&emsp;[SirenUtility findFile: 'stp.ev'] p</br>
</br>
Find a directory</br>
</br>
&emsp;[SirenUtility findDir: 'SHARC' tryHard: false] p</br>
&emsp;[SirenUtility findDir: 'NotThere' tryHard: true] p</br>
</br>
List all files with the given extension</br>
</br>
&emsp;[SirenUtility findFiles: 'au'] p</br>
&emsp;[SirenUtility findFiles: 'mid'] p</br>
</br>
Create a new s7 folder and ask for the next free of a specific type name in it ( (VisualWorks-only to-date))</br>
</br>
&emsp;[SirenUtility createS7: ((SirenUtility findDir: 'Data/'), 'testing')] d</br>
&emsp;[SirenUtility nextName: 'testing' type: 'aiff' ] p</br>
</br>
SirenSession Storage</br>
&emsp;[SirenSession eventLists] I</br>
</br>
</br>
Recreate the instance</br>
&emsp;SirenSession refresh</br>
&emsp;SirenSession release</br>
&emsp;SirenSession instance</br>
</p><hr><h3 id="ExternalInterfacesviaDLLCC">25 - External Interfaces via DLLCC</h3>Siren DLLCC External Interfaces (VisualWorks-only to-date)</br>
</br>
Note: The LibSndFile, PortAudio and FFTW back-ends are not needed in Squeak, and the PortMIDI driver has been ported using Squeak FFI (the similar to VisualWorks DLLCC).  See the page above for MIDI details.</br>
</br>
Siren includes several interfaces between Smalltalk and C to access sound and MIDI I/O in a cross-platform manner. These use the DLLCC package to generate Smalltalk classes whose methods are references to C functions in a dynamic library. </br>
</br>
To compile and load these, you should either down-load the CSL library binaries package from the CSL home page (http://fastlabinc.com/CSL) or else you need to be able to use your platform's C compiler and linker (a Makefile is provided), and to capture the standard output from a VisualWorks virtual machine (normally routed to a console window).</br>
</br>
Load and test the DLLCC External Interfaces</br>
&emsp;LibSndFile - sound file IO in many formats</br>
&emsp;&emsp;[LibSndFileInterface example1: 'unbelichtet.aiff']</br>
&emsp;PortMIDI - cross-platform MIDI API</br>
&emsp;&emsp;[PortMidiInterface testMIDI]</br>
&emsp;PortAudio - cross-platform audio API</br>
&emsp;&emsp;[PortAudioInterface example0]</br>
&emsp;FFTW - Fast Fourier Transform</br>
&emsp;&emsp;[FFTWInterface example] (try this twice)</br>
</br>
Look at each of the interface class defs in MusicIO-External and plug in the directory names for your dynamic libraries. Each of these tests dumps output to the transcript and to the VM's stdout/console.</br>
</br>
Flush all</br>
&emsp;[SirenExternalInterface unload]</br>
</br>
LibSndFile - see the class def for Siren.LibSndFileInterface in category MusicIO-External; tune the lines</br>
</br>
&emsp;&emsp;#(#libraryFiles #('libsndfile.dylib' 'sndfile_lite.dylib'))</br>
&emsp;&emsp;#(#libraryDirectories #('Siren7.5/DLLCC' '/usr/local/lib'))</br>
</br>
This test dumps the first few 100 samples of the test file to the transcript.</br>
&emsp;[LibSndFileInterface example1: 'unbelichtet.aiff'] </br>
&emsp;"LibSndFileInterface unloadLibraries"</br>
</br>
PortMIDI - see the class def for Siren.LibSndFileInterface in category MusicIO-External; tune the lines</br>
</br>
&emsp;&emsp;#(#libraryFiles #('portmidi_lite.dylib' 'portmidi.dylib' 'CoreMIDI'))</br>
&emsp;&emsp;#(#libraryDirectories #('/usr/local/lib' 'Siren7.5/DLLCC' </br>
&emsp;&emsp;&emsp;&emsp;&emsp;'/System/Library/Frameworks/CoreMIDI.framework/Versions/Current'))</br>
</br>
This test prints the return values of a few simple MIDI operations to the transcript.</br>
Look in the standard output of the VM (on the Mac, this means open a console tool) to see the device list that is dumped by the initialize method.</br>
&emsp;[MIDIPort testOpenClose]</br>
&emsp;[PortMidiInterface testMIDI] </br>
&emsp;[MIDIPort testANote]</br>
&emsp;"PortMidiInterface unloadLibraries"</br>
</br>
PortAudio - see the class def for Siren.PortAudioInterface in category MusicIO-External; tune the lines</br>
</br>
&emsp;&emsp;#(#libraryFiles #('portaudio_lite.dylib' 'libportaudio.dylib'))</br>
&emsp;&emsp;#(#libraryDirectories #('Siren7.5/DLLCC' '/usr/local/lib'))</br>
</br>
These tests are progressive, first open/close only, then simple call-backs, then actual data transfer</br>
Look in the standard output of the VM (on the Mac, this means open a console tool) to see the device list that is dumped by the initialize method.</br>
&emsp;[PortAudioInterface example0]</br>
&emsp;[PortAudioInterface example1]</br>
&emsp;[PortAudioPort playSweep]</br>
&emsp;"PortAudioInterface unloadLibraries"</br>
</br>
FFTW - see the class def for Siren.FFTWInterface in category MusicIO-External; tune the lines</br>
</br>
&emsp;&emsp;#(#libraryFiles #('fftw_lite.dylib' 'libfftw3f.a'))</br>
&emsp;&emsp;#(#libraryDirectories #('/usr/local/lib'))</br>
</br>
The basic test creates a sawtooth wave and takes its FFT, displaying the result in a function view. The view also displays the original signal if you hold <SHIFT> down while executing the expression.</br>
</br>
&emsp;[FFTWInterface example]</br>
&emsp;[Spectrum sweepExample display]</br>
&emsp;[Spectrum fileExample display]</br>
</br>
There are more examples of the use of FFTW in the Spectrum class.</br>
</br>
See also the sections below on the SWIG interfaces to CSL and Loris.</br>
</p><hr><h3 id="TestingtheExternalSWIGInterfaces">26 - Testing the External SWIG Interfaces</h3>Loading the SWIG Packages in Siren (VisualWorks-only to-date)</br>
</br>
[Obsolete since SWIG no longer Smalltalk - sad]</br>
</br>
There is a Smalltalk back-end to the SWIG interface generator ported by Ian Upright. This allows us to use the SWIG APIs to access CSL and Loris packages from within Siren. If you're new to this, look at the README files in the SWIG example folders, then at the example notes below. See esp. </br>
&emsp;http://commonsmalltalk.wikispaces.com/SWIG+Documentation</br>
and</br>
&emsp;http://commonsmalltalk.wikispaces.com/SwigForVW</br>
</br>
Note that normal Siren uesrs don't need to go into this; you can use the CSL and Loris interfaces (see the workbook section on models below) without having to regenerate the SWIG interfaces.</br>
</br>
Testing the Smalltalk SWIG Interface using Ian Upright's Example code</br>
</br>
Basic SWIG test: shared constants in the API - First you have to go to the example folder (Siren7.5/SWIG_Smalltalk/Examples/smalltalk/constants) and compile the example library, producing a .dll or .a file. The code block below calls the AMLImporter to load a list of .ssi files, creating an external interface and group of classes in the Siren namespace. (Edit your folder name in below.)</br>
</br>
[#( 'ExampleConstants' 'ExampleConstantsConstants' 'ExampleConstantsEmbeddedConstants'</br>
&emsp; 'ExampleConstantsNI' 'ExampleConstantsTest' ) </br>
&emsp;&emsp;do: [:nam |</br>
&emsp;&emsp;&emsp;AMLImporter new</br>
&emsp;&emsp;&emsp;&emsp;baseDirectoryName: 'Siren7.5/SWIG_Smalltalk/Examples/smalltalk/constants/' ;</br>
&emsp;&emsp;&emsp;&emsp;namespace: Smalltalk.Siren ;</br>
&emsp;&emsp;&emsp;&emsp;import: nam]]</br>
</br>
Look at the class def for ExampleConstantsNIExternalInterface and make certain the DLL name and folder are correct; I have to paste in,</br>
&emsp;&emsp;&emsp;#(#libraryFiles #('ExampleConstants.a'))</br>
&emsp;&emsp;&emsp;#(#libraryDirectories #('Siren7.5/SWIG_Smalltalk/Examples/smalltalk/constants'))</br>
</br>
Now test is with (this prints stuff to the transcript)</br>
&emsp;[Siren.ExampleConstantsTest run] d</br>
</br>
Next step: variables in C. Compile the ExampleVariables library as above, then execute the following block.</br>
</br>
["#( 'ExampleVariables' 'ExampleVariablesNI' 'ExampleVariablesTest' 'SwigTypePint' 'SwigTypePPoint' )" </br>
 #( 'ExampleVariablesTest' ) do: [:nam |</br>
AMLImporter new</br>
&emsp;baseDirectoryName: 'Siren7.5/SWIG_Smalltalk/Examples/smalltalk/variables/' ;</br>
&emsp;namespace: Smalltalk.Siren ;</br>
&emsp;import: nam]]</br>
</br>
Look at the class def for ExampleVariablesNIExternalInterface, editing it to fit your environment; then try,</br>
&emsp;[Siren.ExampleVariablesTest run] d&emsp;&emsp;"prints stuff to the transcript"</br>
</br>
Now try loading a C++ class hierarchy and creating some shape objects</br>
</br>
[ #( 'ExampleClassTest' ) do: [:nam |</br>
AMLImporter new</br>
&emsp;baseDirectoryName: 'Siren7.5/SWIG_Smalltalk/Examples/smalltalk/class/' ;</br>
&emsp;namespace: Smalltalk.Siren ;</br>
&emsp;import: nam]]</br>
</br>
Look at the class def for ExampleClassNIExternalInterface</br>
</br>
Siren.ExampleClassTest run&emsp;&emsp;"prints stuff to the transcript" </br>
</p><hr><h3 id="SWIGInterfacestoLorisandCSL">27 - SWIG Interfaces to Loris and CSL</h3>Using Loris and CSL via SWIG</br>
</br>
[Obsolete since SWIG no longer Smalltalk - sad]</br>
</br>
Loris is a sound analysis/resynthesis package written by Kelly Fitz that uses the model of time-reassigned bandwidth-enhanced partial lists to allow one flexible resynthesis control and sound morphing. Siren uses the SWIG-generated interface and glue code to create Smalltalk classes with methods for modeling Loris analyzers and partial lists. To get the current Loris release, see http://sourceforge.net/projects/loris</br>
</br>
To build it from scratch (not necessary unless you change the C++ code), first declare the shared variable for the interface, then load all the SSI files.</br>
</br>
[Siren.Loris defineSharedVariable: #LorisNI</br>
&emsp;private: false</br>
&emsp;constant: false</br>
&emsp;category: 'external'</br>
&emsp;initializer: nil</br>
&emsp;attributes: #( #(#package 'Siren'))] d</br>
</br>
To import the Loris interface (the SSI files generated by swig), execute the following.</br>
</br>
[AMLImporter new</br>
&emsp;baseDirectoryName: 'Siren7.5/SWIG_Loris/';&emsp;&emsp;"Edit your folder name in here"</br>
&emsp;namespace: Smalltalk.Siren.Loris ;&emsp;&emsp;&emsp;&emsp;"put it in its own namespace"</br>
&emsp;import: 'Loris'] d</br>
</br>
Look at the class definition for LorisNIExternalInterface and make certain the DLL or dylib name is right for your platform, and that the path is correct; I paste in the following lines,</br>
</br>
&emsp;&emsp;&emsp;#(#libraryFiles #('loris_smalltalk.dylib'))&emsp;&emsp;&emsp;&emsp;"Edit your DLL name in here"</br>
&emsp;&emsp;&emsp;#(#libraryDirectories #('Siren7.5/SWIG_Loris')) &emsp;&emsp;"Edit your folder name in here"</br>
&emsp;&emsp;&emsp;#(#beVirtual false)</br>
&emsp;&emsp;&emsp;#(#optimizationLevel #full))</br>
</br>
and accept the change. You might want to file in ./Siren7.5/Loris-freeModule.st</br>
</br>
For normal usage, set-up with this</br>
&emsp;[Siren.Loris.Loris initializeModule] d</br>
&emsp;[Siren.Loris.LorisNI] i&emsp;&emsp;&emsp;"inspect the interface if you're interested"</br>
</br>
Test with this (prints the Loris version string)</br>
&emsp;[Siren.Loris.Loris version] p</br>
</br>
Clean up utilities</br>
&emsp;Siren.Loris.Loris freeModule</br>
&emsp;Siren.Loris.LorisNIExternalInterface unloadLibraries</br>
&emsp;Siren.Loris.LorisNIExternalInterface instanceCount</br>
&emsp;Siren.LorisSound instanceCount</br>
&emsp;Siren.LorisSound allInstances</br>
</br>
Using the SWIG Interface to CSL</br>
</br>
The CREATE Signal Library (CSL) is a C++ framework for building digital audio synthesis and processing applications. Siren uses the SWIG-generated CSL interface and glue code together with CSL.dylib to create CSL object networks (DSP flow graphs) from within Smalltalk.</br>
</br>
Get CSL</br>
&emsp;http://FASTLabInc.com/CSL</br>
</br>
The C++ code still has lots of multiple inheritance (i.e., Scalable, Phased, etc.), which makes some problems in the generated (single inheritance) Smalltalk models; I've added some utility messages to UnitGenerator (e.g., setScale: and setOffset:), but these might cause problems if used incorrectly.</br>
</br>
To build it from scratch (not necessary unless you change the C++ code), first declare the shared variable for the interface, then load all the SSI files.</br>
</br>
[Siren.CSL defineSharedVariable: #CslNI</br>
&emsp;private: false</br>
&emsp;constant: false</br>
&emsp;category: 'external'</br>
&emsp;initializer: nil</br>
&emsp;attributes: #( #(#package 'Siren'))] d</br>
</br>
[AMLImporter new</br>
&emsp;baseDirectoryName: 'Siren7.5/SWIG_CSL/';&emsp;&emsp;&emsp;&emsp;&emsp;"Edit your folder name in here"</br>
&emsp;namespace: Smalltalk.Siren.CSL ;</br>
&emsp;import: 'CSL']</br>
</br>
Look at the class definition for LorisNIExternalInterface and make certain the DLL or dylib name is right for your platform, and that the path is correct.</br>
&emsp;&emsp;&emsp;#(#libraryFiles #('CSL_SWIG_wrap.so'))</br>
&emsp;&emsp;&emsp;#(#libraryDirectories #('Siren7.5/SWIG_CSL'))&emsp;&emsp;"Edit your folder name in here"</br>
&emsp;&emsp;&emsp;#(#beVirtual false)</br>
&emsp;&emsp;&emsp;#(#optimizationLevel #full))</br>
</br>
To test CSL, try the following,</br>
</br>
Set-up</br>
&emsp;[Siren.CSL.CSL initializeModule] d</br>
</br>
First test; print a random number</br>
&emsp;[Siren.CSL.CSL fRand&emsp;  ] p</br>
</br>
Test the logging</br>
&emsp;[Siren.CSL.CSL logMsg: 'Testing logging from Smalltalk'] d</br>
</br>
House-keeping</br>
&emsp;[Siren.CSL.CslNI] i</br>
&emsp;Siren.CSL.CSL freeModule</br>
&emsp;Siren.CSL.CslNIExternalInterface unloadLibraries</br>
&emsp;Siren.CSL.CslNIExternalInterface instanceCount</br>
</br>
The CSL IO classes cache the singleton IO object, so you might have to explicitly flush it from time to time</br>
&emsp;[Siren.CSL.IO release]</br>
</p><hr><h3 id="SirenModelsforLorisandCSL">28 - Siren Models for Loris and CSL</h3>Object Models for Loris and CSL</br>
</br>
[Obsolete since SWIG no longer Smalltalk - sad]</br>
</br>
The Siren kernel of the Loris interface is in the classes LirosSound and LirosAnalyzer. The class LorisAnalysisConfiguration represents the variables used by the analyzer.</br>
</br>
Simple Loris tests</br>
</br>
To load a sound file and run it, saving the result as SDIF and opening a display (read this method to see how to use the Loris API)</br>
&emsp;[LorisSound example: '1.2a1.aiff' resolution: 70] db</br>
&emsp;[LorisSound fromSDIF: 'horns1c.sdif']</br>
</br>
Loris Analyzer Configuration</br>
</br>
There is a special class that manages the Loris analyzer settings; it has an editor default Loris analyzer settings (when set to resolution of 70 Hz) are:</br>
&emsp;hopT 0.0142857</br>
&emsp;winWidth 70</br>
&emsp;size 1291</br>
&emsp;BWwid 2000</br>
&emsp;sideLobes 90</br>
&emsp;cropT 0.0142857</br>
&emsp;freqDrift 35</br>
&emsp;freqFloor 70</br>
&emsp;ampFloor -90</br>
</br>
Loris Sound</br>
</br>
LorisSound is a subclass of sound that has before/after versions of a sound and methods for managing the various envelopes and analysis behaviors.</br>
</br>
LorisEditor GUI</br>
</br>
The LorisEditor GUI has 4 main panes: 2 for sound views, a function view, and a spectrum view. Depending on the application, these might be an original and a resynthesized sound (for tuning analysis parameters), or two different sounds (for morphing). The menu bar at the top of the editor view contains items for all the important Loris functions.</br>
</br>
CSL Models in Siren</br>
</br>
The CSL unit generator models are in the Siren.CSL namespace. the CSLGraph class represents an instrument or DSP patch in the same sense that a CSL instrument object does. There are numerous example methods in the CSLGraph class.</br>
</br>
To oest a CSL graph; play a simple note</br>
&emsp;[CSLGraph testSimpleGraph] d</br>
</br>
Test FM</br>
&emsp;[CSLGraph testFM]</br>
</br>
Test processors: filtered noise</br>
&emsp;[CSLGraph testStaticFilter]</br>
&emsp;[CSLGraph testDynamicFilter]</br>
</br>
Play a sound sample</br>
&emsp;[CSLGraph testSoundFile]</br>
</br>
Play 25 oscillators with random-walk freq and position.</br>
&emsp;[CSLGraph testOscillatorBank]</br>
</br>
If you have a MIDI fader box, try the following demo</br>
&emsp;[CSLGraph testMIDIOscillatorBank]</br>
</p><hr><h3 id="PersistencyandSirenDatabases">29 - Persistency and Siren Databases</h3>Data Load/Store and the Paleo Database (VisualWorks-only)</br>
</br>
Siren supports several mechanisms for object persistency. First of all, the Smalltalk virtual image facility allows one to save Siren data in a convenient database format (the Smalltalk virtual image snapshot file). The SirenSession class shared dictionaries hold Sounds, EventLists, and Voices in the virtual image, so that they are saved across snapshots. There's a utility method to load the user's sound and score data into the image, and one to flush the shared storage.</br>
</br>
&emsp;[SirenSession loadDemoData]&emsp;&emsp;"load all your data into Smalltalk"</br>
&emsp;[SirenSession openTransport]&emsp;&emsp;"See the sound and score menus"</br>
&emsp;"EventScheduler interrupt; flush"</br>
&emsp;"EventScheduler release"</br>
&emsp;[SirenSession initialize]&emsp;&emsp;&emsp;&emsp;"flush everything"</br>
</br>
Now use the pop-up menus in the transport view to browse and select sounds, scores, timers, etc.</br>
</br>
</br>
</br>
Siren Native Format and BOSS</br>
</br>
As described in the sections above, Siren can read and write a variety of standard multimedia file formats. Where we require features not present in other formats we also use several Siren-specific file formats, for example to store sets of envelope functions as breakpoint envelopes in a single file -- Siren's ".env" files supported by the Function class and used by the Loris package.</br>
</br>
Siren also defines a new package file format called ".s7" files. These are folders (named xxx.s7) that contain various kinds of files (sound, SDIF, envelope, LPC data, etc.) that are to be treated as a group. This supports, e.g., versioning of Loris analysis/resynthesis files. The code that implements this format is in the class SirenUtility.</br>
</br>
</br>
</br>
Paleo SMS (Squeak MinneStore)</br>
</br>
</br>
Note: The paleo test data is not included with this release, and the examples below are stale.</br>
</br>
MinneStore is a smalltalk native object-oriented database.</br>
</br>
Load Event Lists from MIDI files</br>
</br>
[&emsp;| num fn el |</br>
&emsp;Cursor wait showWhile: </br>
&emsp;&emsp;[1 to: 100 do: [ :ind |</br>
&emsp;&emsp;&emsp;num := ind asZeroFilledString: 3.</br>
&emsp;&emsp;&emsp;fn := SirenUtility scoreDir, 'Scarlatti/K', num, '.MID'.</br>
&emsp;&emsp;&emsp;(FileDirectory root fileExists: fn)</br>
&emsp;&emsp;&emsp;&emsp;ifTrue: [el := (MIDIFileReader scoreFromFileNamed: fn) asEventList.</br>
&emsp;&emsp;&emsp;&emsp;&emsp;el at: #name put: (''ScarlattiK'', num) asSymbol.</br>
&emsp;&emsp;&emsp;&emsp;&emsp;el at: #composer put: ''Domenico Scarlatti''.</br>
&emsp;&emsp;&emsp;&emsp;&emsp;el at: #instrumentation put: #harpsichord.</br>
&emsp;&emsp;&emsp;&emsp;&emsp;el at: #style put: #Baroque.</br>
&emsp;&emsp;&emsp;&emsp;&emsp;Siren eventLists at: (''ScarlattiK'', num) asSymbol put: el]]]]</br>
</p><hr><h3 id="CRAMApplicationManagement">30 - CRAM Application Management</h3>The CREATE Real-time Applications Manager</br>
</br>
(Obsolete)</br>
</br>
CRAM is a distributed processing environment (DPE) database and management tool. For more information, see http://create.ucsb.edu/CRAM. CRAM assumes the existence of a Postgress-SQL database with network and application tables as described in the documentation. CRAM applications are generally written in C++ or SuperCollider. The CRAM manager is in Smaltalk.</br>
</br>
NodeSocketInterface Examples</br>
</br>
Try pinging the CRAM node manager on the local host.</br>
&emsp;NodeSocketInterface pingExample</br>
&emsp;NodeSocketInterface errorExample</br>
&emsp;NodeSocketInterface nameExample</br>
</br>
Creating and starting a clock service via the CRAM node manager on the local host.</br>
&emsp;NodeSocketInterface createServiceExample</br>
</br>
Try pinging the emergency port of the node manager on the local host.</br>
&emsp;NodeSocketInterface emergencyPingExample</br>
</br>
Restart the node manager</br>
&emsp;NodeSocketInterface emergencyRestartExample</br>
</br>
Try getting the log text of the node manager on the local host.</br>
&emsp;NodeSocketInterface getLogExample</br>
</br>
Try getting the tail of the log text.</br>
&emsp;NodeSocketInterface getLogTailExample</br>
</br>
Try creating and starting 2 clock services.</br>
&emsp;NodeSocketInterface handleServicesExample</br>
</br>
Stop all running services.</br>
&emsp;NodeSocketInterface killServicesExample</br>
</br>
Get the list of service names from the CRAM node manager on the local host.</br>
&emsp;NodeSocketInterface listServicesExample</br>
</br>
Try getting the run-time statistics from the CRAM node manager on the local host.</br>
&emsp;NodeSocketInterface statisticsExample</br>
&emsp;NodeSocketInterface benchmarkExample</br>
&emsp;</br>
Database</br>
</br>
Basic test using PostgresSql -- dump the machines table to the Transcript</br>
&emsp;DPE_Util test0</br>
</br>
Manager GUI</br>
</br>
CRAM.ManagerGUI open</br>
</p><hr><h3 id="MusicalExamples">31 - Musical Examples</h3>Extended Siren Examples</br>
</br>
There are a number of additional files with example code from my compositions</br>
See the files in the StaleCode folder of the Siren 7.5 release, especially MusicApps-Pieces.st.</br>
</br>
There is also a 15-minute sampler/tour of my music and the tools used to make it (almost all of them in Smalltalk) on my label's web site at</br>
&emsp;http://HeavenEverywhere.com/RitualAndMemory/Tour</br>
</br>
Tools Used for Individual Pieces</br>
</br>
Requiem Aeternam dona Eis (1985-4): DoubleTalk PetriNet simulation generated score files for cmusic.</br>
</br>
Day (1986-7): EventGenerators + interactive interfaces for simlpe MIDI sequencing.</br>
</br>
Kombination XI (1988-90): TrTree-based speech editors and prosody morphing.</br>
</br>
All Gates are Open (1991-3): Vocoder scripting in Makefiles generated from a speech database.</br>
</br>
Sensing/Speaking Space (1999): Segmented phonemes in 8S speech database used for speaker textures generated by SuperCollider.</br>
</br>
Four Magic Sentences (2000): as above, + 12-tone rows as pitch classes.</br>
</br>
Leur Songe de la Paix (2002-3): 8S database + drone lists + Morse code layer.</br>
</br>
Eternal Dream (2003-5): Percussion event generators via sample libraries.</br>
</br>
Jerusalem's Secrets (2005-6): EventGenerators for sample patterns.</br>
</br>
Ora penso invece che il mondo... (2006): Serial methods dumped via MIDI to Sibelius notation package for (human) string quartet.</br>
</br>
These last 4 items are the movements of "Secrets, Dreams, Faith and Wonder" (https://vimeo.com/92867679)</br>
</br>
Works in Progress: CSL/Loris in event lists</br>
</br>
----------</br>
</br>
SleepingSword examples with CSL OSC and Kontakt MIDI servers - start a few of these running...</br>
</br>
Add these to the do-it menu in the launcher</br>
&emsp;ClusterEditor open</br>
&emsp;ClusterEditor openWithSpec: #buttonSpec</br>
</br>
</br>
&emsp;OSCVoice stringExample: 1 to: 2 </br>
&emsp;OSCVoice sndExample3 </br>
&emsp;"OSCVoice fmExample5"</br>
&emsp;OSCVoice vxFadeExample1: 8 </br>
</br>
&emsp;MIDIVoice randomWalk: 100 pitch: 96 dur: 0.11 amp: #ppp chan: 1. </br>
&emsp;MIDIVoice randomWalk: 100 pitch: 84 dur: 0.12 amp: 6 chan: 2. </br>
&emsp;MIDIVoice randomWalk: 100 pitch: 66 dur: 0.08 amp: 40 chan: 3. </br>
&emsp;"Ostinato trillExample"</br>
</br>
&emsp;ClusterEditor open</br>
</p><hr><h3 id="YourBasicSirenDemoScript">32 - Your Basic Siren Demo Script</h3>Your Basic Siren Demo Script</br>
</br>
To use this demo script, read through the text selecting the blocks enclosed in square brackets. The single character after the close-square-bracket (d, p,  i, I, b or db) denotes whether you should "do," "print," "inspect," "explore" or "debug" the block.  The command key map looks like:</br>
&emsp;cmd-d = do-it&emsp;&emsp;&emsp;Execute the selection</br>
&emsp;cmd-p = print-it&emsp;&emsp;Execute the selection and print the result</br>
&emsp;cmd-i = inspect-it&emsp;&emsp;Execute the selection and inspect the result</br>
&emsp;cmd-I = explore-it&emsp;Execute the selection and explore the result (an alternative inspector)</br>
&emsp;cmd-D = debug-it&emsp;&emsp;Open a debugger on the expression so you can single-step through it</br>
&emsp;cmd-b = browse-it&emsp;Browse the code of the expression</br>
</br>
To look at the code for the complex examples below, simply "debug-it" and single-step into the demo method.</br>
</br>
For the function and event list examples below, note that the "open" method edits the receiver by default; if you hold down <SHIFT> while executing it, it will play the receiver, and if you hold down <CTRL> is will inspect the receiver.</br>
</br>
If you're new to reading Smalltalk, look at the workbook section on "Learning to Read Smalltalk." If you're setting up Siren for the first time, see the section above on "Siren Set-up and Testing" and make certain you know how to use the Siren Utility panel and the Siren Transport view.</br>
</br>
Set-up</br>
</br>
Configure and test the MIDI and sound I/O drivers using the utility panel.</br>
</br>
&emsp;[SirenSession openUtilityVert] d</br>
</br>
See the section above on "Siren Set-up."</br>
</br>
=====================================================================</br>
</br>
</br>
MusicMagnitudes</br>
</br>
Print these to see what kinds of music magnitude representations and operations are supported.</br>
</br>
&emsp;[440 Hz asSymbol] p&emsp;&emsp;&emsp;"--> 'a3' pitch"</br>
&emsp;[(1/4 beat) asMsec] p&emsp;&emsp;&emsp;"--> 250 msec"</br>
&emsp;[#mf ampl asMIDI] p&emsp;&emsp;&emsp;"--> 70 vel"</br>
&emsp;[-16 dB asRatio value] p&emsp;&emsp;"--> 0.158489"</br>
</br>
MusicMagnitude operations</br>
</br>
</br>
&emsp;['a4' pitch asMIDI] p</br>
&emsp;[('a4' pitch + 100 Hz) asMIDI] p</br>
&emsp;[('a4' pitch + 100 Hz) asFracMIDI] p</br>
&emsp;['mp' ampl + 3 dB] p</br>
&emsp;[('mp' ampl + 3 dB) asMIDI] p</br>
&emsp;[(1/2 beat) + 100 msec] p</br>
</br>
Pitch expressions ("N" is short-hand for PitchClass)</br>
</br>
&emsp;[N C sharp sharp] p</br>
&emsp;[N C augmentedFourth] p</br>
&emsp;[N C diminishedThirteenth] p</br>
&emsp;[N do flat intervalBetween: N sol] p</br>
&emsp;[PitchClass D flat melodicMinorScale notes] p</br>
&emsp;[(HungarianMinor root: N fa) asPitchesInOctave: 3] p</br>
&emsp;[(BohlenPierceScale root: N mi) notes] p  &emsp;"non-well-tempered pitch class"</br>
</br>
=====================================================================</br>
</br>
</br>
Event Creation Messages</br>
</br>
Create a `generic' event using a class instance creation message.</br>
</br>
&emsp;MusicEvent duration: 1/4 pitch: 'c3' ampl: 'mf' </br>
</br>
Create one with added properties.</br>
</br>
&emsp;[(MusicEvent dur: 1/4 pitch: 'c3') color: #green; accent: #sfz ]</br>
</br>
Terse format: concatenation (with ',') of music magnitudes</br>
</br>
&emsp;[440 Hz, (1/4 beat), 44 dB] i</br>
&emsp;[(#c4 pitch, 0.21 sec, 64 velocity) voice: Voice default] I</br>
</br>
=====================================================================</br>
</br>
</br>
Event Lists</br>
</br>
Verbose form using a class instance creation message; </br>
a chord is simply a set of events at the same time.</br>
</br>
&emsp;(EventList newNamed: #Chord1)</br>
&emsp;&emsp;add: ((1/2  beat), 'd3'  pitch,  'mf' ampl)  at: 0;</br>
&emsp;&emsp;add: ((1/2  beat), 'fs3'  pitch, 'mf' ampl)  at: 0;</br>
&emsp;&emsp;add: ((1/2  beat), 'a4'   pitch, 'mf' ampl)  at: 0</br>
</br>
Open an editor on a scale created with a class message.</br>
</br>
&emsp;[(EventList scaleFrom: 60 to: 72 in: 3 sec) open] d</br>
</br>
Create 64 random events with parameters in the given ranges, play it on the default output voice, or edit it.</br>
</br>
&emsp;[(EventList randomExample: 64 &emsp;&emsp;&emsp;"make 64 notes"</br>
&emsp;&emsp;from: ((#duration: -> (50 to: 200)),&emsp;"duration range in msec"</br>
&emsp;&emsp;&emsp;&emsp;(#pitch: -> (36 to: 60)),&emsp;&emsp;"pitch range in MIDI keys"</br>
&emsp;&emsp;&emsp;&emsp;(#ampl: -> (48 to: 120)),&emsp;&emsp;"amplitude range in MIDI velocities"</br>
&emsp;&emsp;&emsp;&emsp;(#voice: -> (1 to: 4)))&emsp;&emsp;&emsp;"play all on voice 1 to:4"</br>
&emsp;&emsp;) editPTV] d&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"open an pitch-time view on the list"</br>
</br>
Create an event list of 20 notes with semi-random values and play it on an OSC output voice.</br>
</br>
&emsp;[(EventList randomExample: 20) playOn: OSCVoice default] d</br>
</br>
If you prefer pinao-roll notation:</br>
</br>
&emsp;[PitchTimeView openOnEventList: EventList randomExample </br>
&emsp;&emsp;&emsp;label: 'P T V' pianoRoll: true]</br>
</br>
</br>
Event lists don't have to have pitches at all, as in the following word,</br>
</br>
&emsp;[EventList named: 'phrase1'  &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"name it and it becomes persistent"</br>
&emsp;&emsp;fromSelectors: #(duration: loudness: phoneme:)&emsp;&emsp;"3 parameters"</br>
&emsp;&emsp;values: (Array with: #(595 545 545 540 570 800 540) &emsp;"3 value arrays"</br>
&emsp;&emsp;&emsp;&emsp;&emsp;with: #(0.8 0.4 0.5 0.3 0.2 0.7 0.1) </br>
&emsp;&emsp;&emsp;&emsp;&emsp;with: #(#dun #kel #kam #mer #ge #sprae #che)).</br>
&emsp;EventList named: 'phrase1'] i</br>
</br>
Scores can also be stored into any of several text formats; e;g;, to save two-voice "counterpoint" on a Csound note list score file.</br>
</br>
&emsp;[ | vox list |</br>
&emsp;vox := CsoundVoice onFileNamed: 'test.cs'.</br>
&emsp;list := (EventList newNamed: #pRand)</br>
&emsp;&emsp;&emsp;addAll: (EventList randomExample: 20);</br>
&emsp;&emsp;&emsp;addAll: (EventList randomExample: 20).</br>
&emsp;vox play: list.</br>
&emsp;vox close.</br>
&emsp;(FileStream fileNamed: 'test.cs') edit] d</br>
</br>
Here's another example of creating a simple melody with a terse format</br>
</br>
&emsp;[(EventList named: 'melody'  </br>
&emsp;&emsp;fromSelectors: #(pitch: duration: ampl:)</br>
&emsp;&emsp;values: (Array with: #(c d e f g) </br>
&emsp;&emsp;&emsp;&emsp;&emsp;with: #(2 4 4 2 2) reciprocal</br>
&emsp;&emsp;&emsp;&emsp;&emsp;with: #(1))) open] d</br>
</br>
You can also create event lists with snippets of code such as the following 2-octave whole-tone scale.</br>
</br>
&emsp;[ | elist |</br>
&emsp;elist := EventList newAnonymous.</br>
&emsp;0 to: 12 do:</br>
&emsp;&emsp;[ :index |</br>
&emsp;&emsp;elist add: (1/4  beat, (index * 2 + 60) key,  'mf' ampl)].</br>
&emsp;elist open ] d</br>
</br>
Event lists can also be nested into arbitrary structures, as in the following group of four sub-groups that get successively higher and quieter</br>
</br>
&emsp;[((EventList newNamed: 'Hierarchical/4Groups')</br>
&emsp;&emsp;add: (EventList randomExample: 8 </br>
&emsp;&emsp;&emsp;from: ((#duration: -> (60 to: 120)), (#pitch: -> (56 to: 60)), (#ampl: -> #(110)))) </br>
&emsp;&emsp;at: 0 sec;</br>
&emsp;&emsp;add: (EventList randomExample: 8 </br>
&emsp;&emsp;&emsp;from: ((#duration: -> (60 to: 120)), (#pitch: -> (60 to: 64)), (#ampl: -> #(90)))) </br>
&emsp;&emsp;at: 1.5 sec;</br>
&emsp;&emsp;add: (EventList randomExample: 8 </br>
&emsp;&emsp;&emsp;from: ((#duration: -> (60 to: 120)), (#pitch: -> (64 to: 68)), (#ampl: -> #(70)))) </br>
&emsp;&emsp;at: 3 sec;</br>
&emsp;&emsp;add: (EventList randomExample: 8</br>
&emsp;&emsp;&emsp;from: ((#duration: -> (60 to: 120)), (#pitch: -> (68 to: 72)), (#ampl: -> #(50)))) </br>
&emsp;&emsp;at: 4.5 sec) </br>
&emsp;editPTV] d</br>
</br>
</br>
Smalltalk methods can also process event lists, as in this code to increase the durations of the last notes in each of the groups from the previous example.</br>
</br>
&emsp;[(EventList named: 'Hierarchical/4Groups') eventsDo: </br>
&emsp;&emsp;[ :sublist | | evnt |&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"Remember: this is hierarchical, to the events are the sub-groups"</br>
&emsp;&emsp;evnt := sublist events last event.&emsp;&emsp;&emsp;"get the first note of each group"</br>
&emsp;&emsp;evnt duration: evnt duration * 8].&emsp;&emsp;"multiply the duration by 4"</br>
&emsp;(EventList named: 'Hierarchical/4Groups') editPTV] d</br>
</br>
...or the following to take the scale and make it slow down</br>
</br>
&emsp;[ | elist |</br>
&emsp;elist := EventList scaleFrom: 60 to: 36 in: 2.5. </br>
&emsp;1 to: elist size do: </br>
&emsp;&emsp;[ :index | | assoc scale |</br>
&emsp;&emsp;scale := 1 + (index * 2 / elist events size).</br>
&emsp;&emsp;assoc := elist events at: index.</br>
&emsp;&emsp;assoc key: (assoc key * scale).</br>
&emsp;&emsp;assoc value duration: assoc value duration * scale].</br>
&emsp;elist editPTV ] d</br>
</br>
[(ScorePlayerMorph onMIDIFileNamed: (SirenUtility dataDir, 'BWV775.MID')) openInWorld]</br>
</br>
=====================================================================</br>
</br>
EventGenerators</br>
</br>
A cluster is the simplest event generator.</br>
</br>
&emsp;[(Cluster  dur: 1.0</br>
&emsp;&emsp;pitchSet: #(48 50 52 54 56)</br>
&emsp;&emsp;ampl: 50</br>
&emsp;&emsp;voice: 1) edit] d</br>
</br>
Chord object can give you an event list.</br>
</br>
&emsp;[((Chord majorTetradOn: 'f3' inversion: 0) duration: 1.0) edit] d</br>
</br>
Create and play a simple drum roll--another 1-D event generator.</br>
</br>
&emsp;[((Roll length: 2000 rhythm: 50 note: 60) ampl: 80) open] d</br>
</br>
Create and edit a low 6 second stochastic cloud with 5 events per second.</br>
</br>
&emsp;[ | c |</br>
&emsp;c := (Cloud dur: 6 sec&emsp;&emsp;"lasts 6 sec."</br>
&emsp;&emsp;pitch: (60 to: 72)  &emsp;&emsp;"with pitches in this range"</br>
&emsp;&emsp;ampl: (80 to: 120) &emsp;&emsp;"and amplitudes in this range"</br>
&emsp;&emsp;voice: (1 to: 1)&emsp;&emsp;&emsp;"select from these voices"</br>
&emsp;&emsp;density: 5) eventList.&emsp;"play 5 notes per sec. and get the event list"</br>
&emsp;c open] d</br>
</br>
Play a 6-second cloud that goes from low to high and soft to loud.</br>
</br>
&emsp;[(DynamicCloud  dur: 6 sec</br>
&emsp;&emsp;pitch: #((50 to: 64) (70 to: 70))&emsp;&emsp;"given starting and ending selection ranges"</br>
&emsp;&emsp;ampl: #((20 to: 20) (90 to: 120))</br>
&emsp;&emsp;voice: (1 to: 4)</br>
&emsp;&emsp;density: 10)  open] d</br>
</br>
Select notes from a given scale</br>
</br>
&emsp;[(SelectionCloud dur: 4 sec </br>
&emsp;&emsp;pitch: ((NeapolitanMinor root: N do) asPitchesInOctave: 4)</br>
&emsp;&emsp;ampl: #(80 40 120)</br>
&emsp;&emsp;voice: #(1)</br>
&emsp;&emsp;density: 12) open] d</br>
</br>
Play a selection cloud that makes a transition from one triad to another.</br>
</br>
&emsp;[(DynamicSelectionCloud dur: 6 sec</br>
&emsp;&emsp;pitch: #( #(48 50 52) #(72 74 76) )&emsp;"starting and ending pitch sets"</br>
&emsp;&emsp;ampl: #(60 80 120)</br>
&emsp;&emsp;voice: #(1)</br>
&emsp;&emsp;density: 12) open] d</br>
</br>
The extended DynamicSelectionCloud uses a multi-part pitch set of the format (time -> chord) (time -> chord) ... as in the following example.</br>
</br>
&emsp;[ | score chords list |&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"generate the tetrads from the selected scale; scramble the order"</br>
&emsp;chords := ((NeapolitanMinor root: N do) generateChordsPoly: 4 inOctave: 2) shuffled.</br>
&emsp;list := OrderedCollection new.</br>
&emsp;1 to: 7 do:</br>
&emsp;&emsp;[ :ind |&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"shift every other one up 2 octaves"</br>
&emsp;&emsp;ind even ifTrue: [list add: ((ind - 1) * 3 -> ((chords at: ind) collect: [ :no | no + 24]))]</br>
&emsp;&emsp;&emsp;ifFalse: [list add: ((ind - 1) * 3 -> (chords at: ind))]].</br>
&emsp;score := (ExtDynamicSelectionCloud dur: 8 sec&emsp;"now make a cloud from these"</br>
&emsp;&emsp;pitch: list</br>
&emsp;&emsp;ampl: 60</br>
&emsp;&emsp;voice: nil</br>
&emsp;&emsp;density: 16) eventList.</br>
&emsp;score eventsDo: &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"plug in the properties for FM"</br>
&emsp;&emsp;[ :ev |&emsp;</br>
&emsp;&emsp;ev inst: '/i1/pn'.</br>
&emsp;&emsp;ev modIndex: 2.0.</br>
&emsp;&emsp;ev ratio: 1.02.</br>
&emsp;&emsp;ev pos: 0.0].</br>
"&emsp;SirenSession eventList: 'EvGens/dsCloud1' put: score."</br>
&emsp;score editPRN] d</br>
</br>
Mark Lentczner's bell peals ring the changes.</br>
</br>
&emsp;[(Peal upon: #(60 65 68 72)) eventList editPTV] d</br>
</br>
Random walks in several flavors</br>
</br>
&emsp;[Walk example1 editPTV]</br>
&emsp;[Walk example2 editPTV]</br>
&emsp;[Walk example3 editPTV]</br>
</br>
Other EvGen examples (do these and/or browse them to see what's going on)</br>
</br>
&emsp;[PitchTimeView cloudExample]</br>
&emsp;[HauerSteffensView cloudsExample]</br>
&emsp;[PitchTimeView cloudsExample]</br>
&emsp;[DynamicCloud focusExample]</br>
&emsp;[HauerSteffensView scaleExample]</br>
&emsp;[HauerSteffensView scaleExample2]</br>
&emsp;[HauerSteffensView randomExampleQ]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[Arpeggio example1]&emsp;&emsp;&emsp;&emsp; "Plays midi"</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[ExtDynamicSelectionCloud chordExample2]</br>
</br>
Score11</br>
</br>
See the above description of Score11; most of the examples play via MIDI or OSC</br>
</br>
&emsp;[Score11 chorale1 open] d</br>
&emsp;[Score11 melody1 open] d</br>
&emsp;[Score11 sleepingSword1] b</br>
</br>
=====================================================================</br>
</br>
EventModifiers</br>
</br>
One can apply functions to the properties of event lists, as in the following example, which creates a drum roll and applies a decrescendo modifier (fcn goes from 0 to 1) to it.</br>
</br>
&emsp;[ | roll decresc |</br>
&emsp;roll := ((Roll length: 3000 rhythm: 150 note: 60) ampl: 120) eventList.</br>
&emsp;decresc := Swell new function: (ExponentialFunction from: #((0 1 4) (1 0))).</br>
&emsp;decresc applyTo: roll.</br>
&emsp;roll editPTV]</br>
</br>
=====================================================================</br>
</br>
Functions and Control</br>
</br>
Basic ramp up/down (linear and exponential flavors)</br>
</br>
&emsp;[(LinearFunction from: #((0 0) (0.5 1) (1 0))) at: 0.25] p</br>
&emsp;[(ExponentialFunction from: #((0 0 5) (0.5 1 -5) (1 0))) at: 0.25 ] p</br>
</br>
ADSR-like envelopes</br>
</br>
&emsp;[(LinearFunction from: #((0 0) (0.03 1) (0.06 0.7) (0.9 0.5) (1 0))) edit]</br>
&emsp;[(ExponentialFunction from: #((0 0 5) (0.02 1 -25) (0.8 0.25 -2) (1 0))) edit]</br>
</br>
Open a view with a linear envelope, an exponential envelope, a spline curve, and a sum-of-sines function</br>
</br>
&emsp;[FunctionView multiFunctionExample]</br>
</br>
</br>
Load LPC tracking data from a file</br>
</br>
&emsp;[FunctionView onFunctions: (Function fromFile: 'G1.2a1.env') normalize: #(false true true)] d</br>
</br>
One can apply a function to any property of an event list, as in the example below, which makes a crescendo/decrescendo using an exponential triangle function.</br>
</br>
&emsp;[ | list fcn |</br>
&emsp;list := EventList newNamed: #test3.</br>
&emsp;(0 to: 4000 by: 100) do: &emsp;&emsp;"4 seconds, 10 notes per second"</br>
&emsp;&emsp;&emsp;[ :index |&emsp;&emsp;&emsp;&emsp;"add the same note"</br>
&emsp;&emsp;&emsp;list add: (MusicEvent dur: 100 pitch: 60 ampl: 120) at: index].</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"create the fade-in/out triangle function"</br>
&emsp;fcn := ExponentialFunction from: #((0 0.05 1) (0.5 1 -1) (1 0.05)).</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"and apply it to the event list"</br>
&emsp;list applyFunction: fcn to: #loudness.</br>
&emsp;list editPTV] d</br>
</br>
Send function data values out as regular OSC messages</br>
</br>
&emsp;[OSCVoice functionExample] b</br>
</br>
=====================================================================</br>
</br>
Voices and I/O</br>
</br>
&emsp;[CsoundVoice randomExampleToFileAndEdit]</br>
&emsp;[SuperColliderVoice randomExampleToFileAndEdit]</br>
</br>
&emsp;[(EventList randomExample: 20) playOn: MIDIVoice default]</br>
&emsp;[OSCVoice midiScaleExample]</br>
</br>
These use the CSL OSC servers</br>
</br>
&emsp;[OSCVoice fmExample1]</br>
&emsp;[OSCVoice sndExample1]</br>
</br>
These examples loop endlessly, so you have to interrupt or flush the scheduler to stop them</br>
</br>
&emsp;[OSCVoice fmExample2. &emsp;&emsp;5 wait.</br>
&emsp;OSCVoice sndExample2.&emsp;&emsp;5 wait.</br>
&emsp;OSCVoice fmExample4]</br>
&emsp;[EventScheduler flush]</br>
</br>
As an example that mixes styles, the following expression plays a long low FM note and then uses Siren function objects to send continuous controls to make the note glissando down and pan from left to right.</br>
</br>
&emsp;[OSCVoice fmExample3]</br>
</br>
=====================================================================</br>
</br>
MIDI Control</br>
</br>
Talk directly to the MIDI Driver for low-0level queries</br>
</br>
&emsp;[PortMIDILibrary pm_count_devices ] p</br>
&emsp;[PortMIDILibrary pm_default_input_device ] p</br>
&emsp;[PortMIDILibrary pm_default_output_device ] p</br>
&emsp;[PortMIDIPort listDeviceTable] d&emsp;&emsp;&emsp;"prints to Transcript"</br>
</br>
Simple examples</br>
</br>
&emsp;[MIDIVoice scaleExample]</br>
&emsp;[MIDIVoice randomExample]</br>
</br>
If you have a multi-timbral synth with all 16 channels mapped, try this,</br>
</br>
&emsp;[EventList multiVoiceExample playOn: MIDIVoice default]</br>
</br>
Open MIDI, play notes based on the mouse position (x --> dur; y --> pitch) until mouse down.</br>
</br>
&emsp;[MIDIPort testMouseMIDI] d</br>
</br>
Demonstrate program change by setting up an organ instrument to play on.</br>
</br>
&emsp;[MIDIPort testProgramChange] d</br>
</br>
Down-load a general MIDI patch for a 16-voice percussion ensemble.</br>
</br>
&emsp;[MIDIPort setupTunedPercussion. MIDIPort testAScale] d</br>
</br>
Reset the GM map (removed, see old code file-ins)</br>
</br>
&emsp;[MIDIPort resetEnsemble]</br>
</br>
Demonstrate control commands by playing a note and making a crescendo with the volume pedal.</br>
</br>
&emsp;[MIDIPort testControlContinuous] d</br>
</br>
Demonstrate pitch-bend by playing two notes and bending them.</br>
</br>
&emsp;[MIDIPort testBend] d</br>
</br>
ANO</br>
</br>
&emsp;[MIDIPort allNotesOff]</br>
</br>
Close down and clean up.</br>
</br>
&emsp;[MIDIPort cleanUp]</br>
</br>
MIDI Tests</br>
&emsp;</br>
&emsp;[PortMIDILibrary pm_write_data3: 0 with: 144 with: 60 with: 100.]</br>
&emsp;[PortMIDILibrary pm_terminate]</br>
</br>
&emsp;Various verbose MIDIVoice creation methods</br>
</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice defaultOut: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Kontakt' channel: 3)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Nord' channel: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice on: </br>
&emsp;&emsp;&emsp;(MIDIDevice </br>
&emsp;&emsp;&emsp;&emsp;outOn: (PortMIDIPort indexOfOutNamed: '*Kontakt*') </br>
&emsp;&emsp;&emsp;&emsp;port: MIDIPort concreteClass default) </br>
&emsp;&emsp;&emsp;channel: 3)]</br>
&emsp;[PortMIDIPort streams]</br>
</br>
=====================================================================</br>
</br>
OpenSoundSontrol - OSC</br>
</br>
The OSC examples assume you've got an OSC-based server (e.g., CSL or SuperCollider) listening on some port; see the doc above to the recommended instrument library.</br>
</br>
&emsp;[OSCVoice fmExample1]</br>
&emsp;[OSCVoice fmExample2]</br>
&emsp;[OSCVoice pluckExample1]</br>
&emsp;[OSCVoice sndExample1]</br>
&emsp;[OSCVoice sndExample2]</br>
&emsp;[OSCVoice sharcExample1]</br>
&emsp;[OSCVoice bellExample1]</br>
&emsp;[OSCVoice vSOSExample1]</br>
&emsp;[OSCVoice granulatorExample1]</br>
&emsp;[OSCVoice granulatorExample2: 1]</br>
</br>
Roll timing tests</br>
</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList asSoundScore play]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList playOn: MIDIVoice default]</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList </br>
&emsp;&emsp;&emsp;&emsp;&emsp;playOn: (OSCVoice cslHost: pMapForCSLSimpleFM)]</br>
</br>
=====================================================================</br>
</br>
Storage and Persistency</br>
</br>
&emsp;"SirenSession eventList: 'piece1/mvmnt1/part1' put: EventList new"</br>
&emsp;"SirenSession eventList: 'piece1/mvmnt1/part1'"</br>
</br>
=====================================================================</br>
</br>
</br>
Siren Scheduler</br>
</br>
Reset</br>
&emsp;[EventScheduler initialize]</br>
</br>
Here's how to use the event scheduler explicitly.</br>
</br>
&emsp;[EventScheduler instance addClient: (EventList randomExample: 20) in: (500 msec).</br>
&emsp;EventScheduler instance run] d</br>
</br>
Flush and close down the scheduler</br>
</br>
&emsp;[EventScheduler instance interrupt; flush] d</br>
</br>
Action events have arbitrary blocks of Smalltalk code as their "actions." This example creates a list of action events that flash random screen rectangles.</br>
</br>
&emsp;[ActionEvent playExample] d</br>
</br>
Complex Multimedia Example</br>
</br>
&emsp;[ | el |</br>
&emsp;el := (Cloud  dur: 6&emsp;&emsp;&emsp;&emsp;"Create a 6-second stochastic cloud"</br>
&emsp;&emsp;pitch: (48 to: 60)&emsp;&emsp;&emsp;&emsp;"choose pitches in this range"</br>
&emsp;&emsp;ampl: (40 to: 70) &emsp;&emsp;&emsp;&emsp;"choose amplitudes in this range"</br>
&emsp;&emsp;voice: #(1)&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"leave the 1 nil for now"</br>
&emsp;&emsp;density: 5) eventList.&emsp;&emsp;&emsp;"play 5 notes per sec. and get the events"</br>
&emsp;1 to: el events size do:&emsp;&emsp;&emsp;&emsp;"Now plug different voices in to the events"</br>
&emsp;&emsp;[ :ind | &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"ind is the counter"</br>
&emsp;&emsp;(el events at: ind) event voice: </br>
&emsp;&emsp;&emsp;(ind odd &emsp;&emsp;&emsp;&emsp;&emsp;"alternate between two voices"</br>
&emsp;&emsp;&emsp;&emsp;ifTrue: [MIDIVoice default] </br>
&emsp;&emsp;&emsp;&emsp;ifFalse: [OSCVoice default])].</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"add some animation events"</br>
&emsp;el addAll: ActionEvent listExample.</br>
&emsp;el open] d&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"and play the merged event list"</br>
</br>
=====================================================================</br>
</br>
Squeak-native Sound</br>
</br>
Create and view some example sounds using the Squeak-native sound facilities</br>
</br>
Play a scale on an FM synthesis instrument (2 methods)</br>
</br>
&emsp;[(FMSound lowMajorScaleOn: FMSound bassoon1) play] d</br>
&emsp;[(EventList scaleFrom: 48 to: 60 in: 1.5) asSoundScore play] d</br>
</br>
Mix several different instruments</br>
</br>
&emsp;[ | sco voxs | </br>
&emsp;&emsp;sco := EventList scaleFrom: 48 to: 72 in: 4.5.</br>
&emsp;&emsp;voxs := Array with: FMSound oboe1 with: FMSound brass1 </br>
&emsp;&emsp;&emsp;&emsp;with: FMSound marimba with: PluckedSound default.</br>
&emsp;&emsp;sco eventsDo: [ :ev |</br>
&emsp;&emsp;&emsp;ev voice: voxs atRandom].</br>
&emsp;&emsp;sco asSoundScore play] d</br>
</br>
Read in a sound from a file and view it</br>
</br>
&emsp;[(SampledSound fromAIFFfileNamed: 'Siren9C/Data/unbelichtet.aiff') viewSamples] d</br>
</br>
Display a tiny sonogram in the upper-left of the screen (It's a raw morph, so you have to ctrl-click on it and say "delete" to dismiss it)</br>
</br>
&emsp;[ | snd | snd := SampledSound fromAIFFfileNamed: 'Siren9C/Data/unbelichtet.aiff'.</br>
&emsp;snd currentWorld addMorph: (snd sonogramMorph: 32 from: 1 to: snd count nPoints: 256)]</br>
</br>
=====================================================================</br>
</br>
</br>
The Siren Graphics Framework</br>
</br>
Display rectangles in a display list view -- test zoom and scroll.</br>
</br>
&emsp;[DisplayList rectangleExample]</br>
</br>
Display random strings or other visuals</br>
</br>
&emsp;[DisplayList stringExample]</br>
&emsp;[DisplayListView exampleLines]</br>
&emsp;[DisplayListView examplePolylines]</br>
&emsp;[DisplayListView exampleVisuals]</br>
</br>
</br>
Large or complicated display lists</br>
</br>
&emsp;[DisplayRectangle rectangleExample2]&emsp;&emsp;"slow - uses rotated rects"</br>
&emsp;[(DisplayList stringsX: 6000 byY: 10000) display]</br>
&emsp;[DisplayListView exampleMixed]&emsp;&emsp;&emsp;"huge display list - takes a while"</br>
&emsp;[DisplayList exampleHierarchical display]</br>
</br>
Show the result of the IndentedListLayoutManager</br>
</br>
&emsp; [IndentedListLayoutManager colorListExample display] d</br>
&emsp;</br>
(Note that color denotes species in this example: red for durations, green for pitches, blue for amplitudes, etc.)</br>
To view the same structure as a tree-like layout, use an IndentedTreeLayoutManager, as in,</br>
</br>
&emsp;[IndentedTreeLayoutManager listExample display] d</br>
</br>
</br>
Music Notations</br>
</br>
Open a sequence view on a random event list.</br>
</br>
&emsp;[TimeSequenceView randomExample] d</br>
</br>
Try the pitch-time layout</br>
</br>
&emsp;[PitchTimeView randomExample] d</br>
&emsp;[PitchTimeView openOnEventList: (EventList scaleFrom: 48 to: 84 in: 6)] d</br>
</br>
Open a pitch/time view on a *very long* 3-stream event list.</br>
</br>
&emsp;[PitchTimeView randomExampleLong] d</br>
</br>
Open a pitch/time view on an event list with the added properties of envelope, position and duty cycle.</br>
</br>
&emsp;[EventList randomSWSSExample2 editPTV] d</br>
</br>
If you prefer pinao-roll notation:</br>
</br>
&emsp;[PitchTimeView openOnEventList: EventList randomExample </br>
&emsp;&emsp;&emsp;label: 'P T V' pianoRoll: true]</br>
</br>
</br>
A more complete example is Hauer-Steffens notation, which has a clef and staff lines as in common-practise notation.</br>
</br>
</br>
&emsp;[(EventList scaleFrom: 40 to: 66 in: 6) edit] d</br>
&emsp;[HauerSteffensView randomExample] d</br>
&emsp;[HauerSteffensView randomExampleQ] d</br>
</p><hr><h3 id="BuildingSireninSqueak6">33 - Building Siren in Squeak 6</h3>Script to build Siren9C in Squeak6.1-alpha</br>
&emsp;Do not file this in - step through the blocks 1 by 1</br>
</br>
Set-up</br>
</br>
Use the Squeak customization process.</br>
</br>
STP world file-ins (Edit the relative paths below to suit your installation)</br>
</br>
[ #(</br>
&emsp;'Squeak-Siren-pre-build.cs'&emsp;&emsp;&emsp;&emsp;"minor fixes and extensions"</br>
&emsp;'SirenChanges-230116.cs'</br>
&emsp;'SirenChanges-230122.cs'</br>
&emsp;'TheWorldMenu.stp.230116.cs'</br>
&emsp;'NewWorldMenu2.230117.cs'</br>
&emsp;'PackagePaneBrowser-packageListFix-stp-230117.st'</br>
&emsp;'ZPoint.st'</br>
&emsp;'WorkbookWindowSqueak.st'</br>
) do: [ :file |</br>
&emsp;Transcript show: 'Filing in ', file; cr.</br>
&emsp;(FileStream fileNamed: ('./Siren9C/FileIns/', file)) fileIn]]</br>
</br>
</br>
Reorganize system categories (for better 6-paned browsing) before continuing</br>
</br>
System reorg from ./Siren9C/FileIns/SqueakSystemReorg.st (file it in)</br>
</br>
[#( 'Music-Models-Representation.st'</br>
&emsp;'Music-Models-Implementation.st'</br>
&emsp;'Music-Events.st'</br>
&emsp;'Music-EventGenerators.st'</br>
&emsp;'Music-EventModifiers.st'</br>
&emsp;'Music-Functions.st'</br>
&emsp;'Music-Sound.st'</br>
&emsp;'Music-PitchScales.st'</br>
&emsp;'Music-PitchClasses.st'</br>
&emsp;'Music-Support.st'</br>
</br>
&emsp;'MusicIO-Voices.st'</br>
&emsp;'MusicIO-OSC.st'</br>
&emsp;'MusicIO-MIDI.st'</br>
</br>
&emsp;'MusicUI-DisplayLists.st'</br>
&emsp;'MusicUI-DisplayListViews.st'</br>
&emsp;'MusicUI-Editors.st'</br>
&emsp;'MusicUI-Layout.st'</br>
&emsp;'MusicUI-Functions.st'</br>
) do: [ :file |</br>
&emsp;Transcript show: 'Filing in ', file; cr.</br>
&emsp;(FileStream fileNamed: ('./Siren9C/Siren9C_Sources_Squeak/', file)) fileIn]].</br>
]</br>
</br>
Make a new change set</br>
</br>
Load some new fonts</br>
</br>
[TTCFont installFromFileNames: (((FileDirectory default directoryNamed: 'Siren9C/Data/Fonts') </br>
&emsp;&emsp;fileNamesMatching: '*.ttf') collect:</br>
&emsp;&emsp;&emsp;[ :nam |  'Siren9C/Data/Fonts/', nam])]</br>
</br>
Load music icons from the font</br>
</br>
[(FileStream fileNamed: './Siren9C/FileIns/MusicConstants.st') fileIn.</br>
&emsp;DisplayListView loadNoteGlyphsFromFontSized: 100.</br>
&emsp;DisplayListView loadTransportGlyphs]</br>
</br>
Class initializations</br>
</br>
[&emsp;MusicEvent initialize.</br>
&emsp;EventList initialize.</br>
&emsp;MIDIPitch initialize.</br>
&emsp;MIDIVelocity initialize.</br>
&emsp;SymbolicLoudness initialize.</br>
&emsp;SymbolicPitch initialize.</br>
&emsp;MusicModel initialize.</br>
&emsp;Amplitude initialize.</br>
&emsp;MDuration initialize.</br>
&emsp;Pitch initialize.</br>
&emsp;PitchClass initialize.</br>
&emsp;Scale initialize.</br>
&emsp;EventScheduler initialize.</br>
&emsp;PortModel initialize.</br>
&emsp;SEventQueue initialize.</br>
&emsp;SirenUtility initialize.</br>
&emsp;SirenSession initialize.</br>
&emsp;Voice initialize.</br>
&emsp;MIDIDevice initialize.</br>
&emsp;MIDIPort initialize.</br>
&emsp;MIDIVoice initialize.</br>
&emsp;PortMIDILibrary initialize.</br>
&emsp;OSCBundle initialize.</br>
&emsp;OSCVoice initialize.</br>
&emsp;FunctionView initialize.</br>
&emsp;SirenSession new.&emsp;&emsp;"instantiate singleton"</br>
]</br>
</br>
Set system fonts</br>
</br>
StrikeFont actualFamilyNames</br>
Preferences chooseFixedFont</br>
&emsp;&emsp;</br>
[ | family base |</br>
family := 'LibreBaskerville'.</br>
"family := 'Palatino'."</br>
"family := 'BitstreamVeraSerif'."</br>
base := 10.5.</br>
{</br>
   { #setButtonFontTo:&emsp;.&emsp;&emsp;family&emsp;.&emsp;base }.</br>
   { #setMenuFontTo:&emsp;&emsp;.&emsp;&emsp;family&emsp;.&emsp;base + 1.5 }.</br>
   { #setListFontTo:        &emsp;.&emsp;&emsp;family&emsp;.&emsp;base  }.</br>
   { #setCodeFontTo:      &emsp;.&emsp;&emsp;family&emsp;.&emsp;base + 1.5  }.</br>
   { #setWindowTitleFontTo:&emsp;.&emsp;family&emsp;.&emsp;base + 1.5 }.</br>
} do:</br>
      [ :triplet | </br>
         Preferences perform: triplet first with: </br>
&emsp;&emsp;&emsp;(StrikeFont familyName: triplet second pointSize: triplet third)]]</br>
</br>
A few GUI prefs</br>
</br>
[Preferences loadPreferencesFrom: 'my.prefs'.</br>
MorphicProject useCompactButtons.</br>
RealEstateAgent placeWindowsAtPointer.</br>
Preferences setPreference: #reverseWindowStagger toValue: false]</br>
</br>
[WorkbookWindow openFolder: './Siren9C/Workbook/' named: 'Siren Workbook']</br>
</br>
Screen background image</br>
</br>
[Form openAsBackground: '/Users/stp/Code/Smalltalk/Siren9C/display-lite.jpg' ]</br>
</br>
Undeclared inspect</br>
Smalltalk garbageCollect</br>
</br>
Done - make a snapshot here and get to work...</br>
</br>
File-out - Remember to remove the class initializations after you save these</br>
</br>
[SirenUtility fileoutCategories] </br>
</p><hr><h3 id="BuildingSireninCuis6">34 - Building Siren in Cuis 6</h3>Script to build Siren in Cuis (Version 9C)</br>
&emsp;Do not file this in - step through the blocks 1 by 1</br>
</br>
Set-up</br>
</br>
Load themes, choose light theme</br>
Choose small GUI features</br>
Load a couple extra fonts for fun</br>
</br>
[TrueTypeFontFamily readAllTrueTypeFontsIn: DirectoryEntry smalltalkImageDirectory / 'TrueTypeFonts/ComputerModern/ComputerModernSerif'.</br>
TrueTypeFontFamily readAllTrueTypeFontsIn: DirectoryEntry smalltalkImageDirectory / 'TrueTypeFonts/Cream']</br>
</br>
Set font Computer Modern Serif</br>
</br>
</br>
Load packages - optional for now</br>
</br>
[&emsp;Feature require: 'Network-Kernel'.</br>
&emsp;Feature require: 'FFI'.</br>
&emsp;Feature require: 'Tests-FFI'.</br>
&emsp;Feature require: 'Sound'.</br>
&emsp;Feature require: 'SqueakCompatibility' ]   "SqueakCompatibility broken at present; debugger because Utf8String gone"</br>
</br>
STP world file-ins (Edit the relative paths below to suit your installation)</br>
</br>
[ #(</br>
&emsp;'Cuis-GUI-changes.st'</br>
&emsp;'ZPoint.st'</br>
&emsp;'SirenSystemChanges.st'</br>
&emsp;'ST80-compatibility.st'</br>
&emsp;'SixPanedBrowser.st'</br>
&emsp;'SixPanedBrowserWindow.st'</br>
&emsp;'WorkbookWindowCuis.st'</br>
&emsp;'STPTheme.st'</br>
) do: [ :file |</br>
&emsp;Transcript show: 'Filing in ', file; cr.</br>
&emsp;('./Siren9C/FileIns/', file) asFileEntry readStreamDo: </br>
&emsp;&emsp;[ :stream | stream ifNotNil: [stream fileIn]]]]</br>
</br>
Siren file-ins using packages (WIP) or source code files (works)</br>
</br>
[ "In the future - use packages"</br>
&emsp;Feature require: 'Music-Support.pck.st'.</br>
&emsp;Feature require: 'MusicUI-DisplayListViews.pck.st'.</br>
&emsp;Feature require: 'MusicIO-MIDI.pck.st' ]</br>
</br>
OR src code file-in (Edit the relative paths below to suit your installation)</br>
</br>
[ #(&emsp;"'Music-Models-Representation.st'</br>
&emsp;'Music-Models-Implementation.st'</br>
&emsp;'Music-Events.st'</br>
&emsp;'Music-EventGenerators.st'</br>
&emsp;'Music-EventModifiers.st'</br>
&emsp;'Music-Functions.st'</br>
&emsp;'Music-Sound.st'</br>
&emsp;'Music-PitchScales.st'</br>
&emsp;'Music-PitchClasses.st'</br>
&emsp;'Music-Support.st'</br>
</br>
&emsp;'MusicIO-Voices.st'</br>
&emsp;'MusicIO-OSC.st'</br>
&emsp;'MusicIO-MIDI.st'</br>
"</br>
&emsp;'MusicUI-DisplayLists.st'</br>
&emsp;'MusicUI-DisplayListViews.st'</br>
&emsp;'MusicUI-Layout.st'</br>
&emsp;'MusicUI-Editors.st'</br>
</br>
) do: [ :file |</br>
&emsp;Transcript show: 'Filing in ', file; cr.</br>
&emsp;('./Siren9C/Siren9C_Sources_Squeak/', file) asFileEntry readStreamDo:</br>
&emsp;&emsp;[ :stream | stream ifNotNil: [stream fileIn]]]]</br>
</br>
Lastly: the music notation glyph set</br>
</br>
[ './Siren9C/FileIns/MusicConstants.st' asFileEntry readStream fileIn]</br>
</br>
Clean up</br>
</br>
[&emsp;MDuration initialize.</br>
&emsp;MusicModel initializeGenerality.</br>
&emsp;PortModel initialize.</br>
&emsp;SirenUtility initialize.</br>
&emsp;SirenSession initialize.</br>
&emsp;SirenSession new.</br>
]</br>
</br>
Rename categories for Themes and VectorEngineInSmalltalk etc. to be under Graphics or Morphic (for better 6-paned browsing)</br>
</br>
[WorkbookWindow openFolder: './Siren9C/Workbook2' named: 'Siren Workbook' ]</br>
Undeclared inspect</br>
Smalltalk garbageCollect</br>
</br>
Screen background image (edit to taste)</br>
</br>
[self runningWorld backgroundImageData:</br>
&emsp;(UniFileStream new open: '/Users/stp/Code/Smalltalk/Siren9C/display-lite.jpg' forWrite: false) </br>
&emsp;binary contentsOfEntireFile]</br>
</br>
[SirenUtility fileoutCategories]</br>
</p><hr><h3 id="BuildingSireninVisualWorks9">35 - Building Siren in VisualWorks 9</h3>Building a Siren Image in VisualWorks 9.0</br>
</br>
To load Siren into a VisualWorks 9.0 virtual image, follow these steps.</br>
</br>
Start VW 9.0</br>
&emsp;Load your favorite parcels (AT tools, DB, etc.)</br>
&emsp;Siren requires the following packages:</br>
&emsp;&emsp;Store/PostgreSQL, DLLCC, BOSS, OldBrowsers (from vw 8.0)</br>
&emsp;Load Siren9.0.pcl</br>
&emsp;It should automatically do the next 2 steps, see the Transcript.</br>
&emsp;File in the MusicConstants.st file</br>
 &emsp;&emsp;['MusicConstants.st' asFilename fileIn]</br>
</br>
&emsp;Now use the Page/load_all menu item to load the workbook contents from the BOSS file Workbook9.0.bos</br>
&emsp;&emsp;[ListWorkBook open]</br>
</br>
By-hand init (see these methods for site tuning)</br>
&emsp;Siren.SoundFile initialize</br>
&emsp;Siren.SirenUtility initialize (or SirenUtility initializeSirenSTP)</br>
</br>
Load optional L&F hacks (in PostBuild)</br>
&emsp;Left-hand scroll bars - left-scroll-bar.st</br>
&emsp;Custom colors - WidgetPolicy class-initializeDefaultGenericColors.st</br>
</br>
See the appropriate Workbook pages for the following subsystems</br>
</br>
&emsp;SirenUtility initialize. SirenSession initialize</br>
</br>
Load and test the DLLCC External Interfaces (see the C makefiles and interface class defs)</br>
&emsp;LibSndFile - [LibSndFileInterface example1: 'unbelichtet.aiff']</br>
&emsp;PortMIDI - [PortMidiInterface testMIDI]</br>
&emsp;FFTW - [FFTWInterface example]</br>
&emsp;PortAudio - [PortAudioInterface example1]</br>
</br>
Test the OSC I/O (assumes some OSC client)</br>
&emsp;OSCVoice midiScaleExample</br>
</br>
Load and test the SWIG Interfaces</br>
&emsp;CSL </br>
&emsp;&emsp;Siren.CSL.CSL initializeModule</br>
&emsp;&emsp;CSLGraph testSimpleGraph</br>
&emsp;Loris</br>
&emsp;&emsp;Siren.Loris.Loris initializeModule</br>
&emsp;&emsp;Siren.Loris.Loris version</br>
&emsp;&emsp;See examples in LorisSound</br>
</br>
Set up a new changelist and make a snapshot...</br>
</br>
To use the DLLCC-based external interfaces for MIDI and Audio IO and accelerated FFT, copy the files in DLLCC/Libs into /usr/local/lib (on a Mac).</br>
</br>
-----------------</br>
</br>
Basic testing - see the demo script for the basic tests</br>
&emsp;Events and EventLists</br>
&emsp;Displays</br>
</br>
External UIs - some of these print to the Transcript, and some to the stdout as well</br>
</br>
FFTWInterface example&emsp;&emsp;&emsp;&emsp;"works the 2nd time"</br>
LibSndFileInterface example1: 'unbelichtet.aiff' </br>
PortAudioInterface example0</br>
PortMidiInterface example1</br>
PortMidiInterface allInstances</br>
</br>
Harder tests</br>
</br>
PortAudioPort playSweep</br>
MIDIPort testANote</br>
MIDIPort testBend</br>
MIDIVoice scaleExample</br>
</p><hr><h3 id="RelatedSoftware">36 - Related Software</h3>Related Software</br>
</br>
Siren is typically used in consort with a number of other packages; for more information, see the links below</br>
</br>
CSL: the CREATE Signal Library: a C++ framework for building OSC-controllable synthesis/processing servers</br>
&emsp;http://FASTLabInc.com/CSL</br>
</br>
Loris: a sound analysis/resynthesis package written by Kelly Fitz</br>
&emsp;http://sourceforge.net/projects/loris</br>
</br>
SuperCollider: an efficient synthesis and processing language very similar to Smalltalk</br>
&emsp;http://supercollider.sourceforge.net/</br>
</br>
CRAM: the CREATE Real-time Applications Manager: a tool for describing and managing complex distributed real-time software systems</br>
&emsp;http://FASTLabInc.com/CRAM</br>
</br>
Occam: An OSC-to-MIDI translator</br>
&emsp;http://www.mat.ucsb.edu/~c.ramakr/illposed/occam.html</br>
</br>
Macco: a MIDI-to-OSC convertor</br>
&emsp;http://FASTLabInc.com/CSL/Macco.zip</br>
</br>
FMAK: the FASTLab Music analysis Kernel (a sibling of CSL)</br>
&emsp;http://FASTLabInc.com/</br>
</br>
libSndFile: http://www.mega-nerd.com/libsndfile</br>
</br>
PortMidi: http://www.cs.cmu.edu/~music/portmusic</br>
</br>
PortAudio: http://www.portaudio.com</br>
</br>
FFTW: the fastest FFT in the west</br>
&emsp;http://www.fftw.org</br>
</br>
JUCE: the great C++ library for multimedia</br>
&emsp;http://www.juce.com</br>
</p><hr><h3 id="ReleaseNotesandVersionHistory">37 - Release Notes and Version History</h3>Siren 9.0 Release Notes</br>
</br>
Current Status</br>
</br>
This is the V9C release of Siren on VisualWorks, Squeak and Cuis</br>
</br>
Smoke: The Smoke representation is complete, see the event list and event generator examples.</br>
</br>
Voices and Schedulers: The scheduler delivers acceptable real-time performance on a modern CPU. The real-time output via OSC or MIDI is suitable for use in performance.</br>
</br>
Sound I/O: Sound file I/O is implemented for many kinds of sound files (AIFF, WAV, .snd, etc.) via the libSndFile interface. There is a PortAudio callback interface using DLLCC as well as an FFTW interface for the class Spectrum (VisualWorks-only)</br>
</br>
MIDI/OSC: Ports and Voices exist for real-time control I/O.</br>
</br>
There are DLLCC interfaces to CSL and Loris based on SWIG interfaces. (VisualWorks-only)</br>
</br>
Graphics and GUI: The display list framework, Navigator MVC framework, and several MVC-based GUI tools are available; see the examples above.</br>
</br>
Version History</br>
</br>
Siren on Squeak and Cuis</br>
&emsp;9C--FASTLab, Ojai, CA, January, 2023</br>
&emsp;</br>
</br>
Siren on Visualworks</br>
&emsp;9.0--FASTLab, Santa Barbara, May, 2020</br>
&emsp;7.6--FASTLab, Santa Barbara, January, 2013</br>
&emsp;7.5--CREATE, Santa Barbara, April, 2007</br>
&emsp;7.4--CREATE, Santa Barbara, Winter, 2006</br>
&emsp;7.3--CREATE, Santa Barbara, throughout 2005</br>
&emsp;7.2--CREATE, Santa Barbara, Fall, 2003</br>
&emsp;7.0--CREATE, Santa Barbara, Spring, 2001</br>
</br>
Siren on Squeak</br>
&emsp;3.0--T. U. Berlin, Summer, 2000</br>
&emsp;2.2--CREATE, October/November, 1998</br>
&emsp;2.0--CREATE, April-June, 1998</br>
&emsp;1.3--CREATE, August/September, 1997</br>
&emsp;1.0--CREATE, December, 1996</br>
</br>
MODE </br>
&emsp;2.0--(Topaz2) CNMAT/Berkeley, April - December, 1994</br>
&emsp;1.3--(Topaz) SICS/EMS, Stockholm, February - April, 1993</br>
&emsp;1.2--CCRMA/Stanford, July, 1991 - February, 1992</br>
&emsp;1.0--STEIM, Amsterdam, May/June 1990</br>
&emsp;0.8--ParcPlace Systems, CCRMA/Stanford, June, 1989</br>
&emsp;0.4--Xerox PARC, March, 1988</br>
</br>
HyperScoreToolKit</br>
&emsp;1.0--Xerox PARC, October, 1986</br>
</br>
DoubleTalk</br>
&emsp;1.0--PCS/Cadmus GmbH, October, 1984</br>
</p><hr><h3 id="ReferencesandAcknowledgments">38 - References and Acknowledgments</h3>Reference, Acknowledgments</br>
</br>
The main Siren Web site is at http://FASTLabInc.com/Siren.</br>
This outline is on-line at http://FASTLabInc.com/Siren/Doc.</br>
To join the mailing list, see http://www.create.ucsb.edu/mailman/listinfo/Siren.</br>
</br>
To read more about computer music, get a copy of Curtis Roads' "Computer Music Tutorial" (MIT Press).</br>
</br>
To learn more about Smalltalk, see the several excellent on-line Smallatlk tutorials (just ask Google) e.g.,</br>
&emsp;http://www.cincomsmalltalk.com/tutorials/version7/tutorial1/home.htm</br>
&emsp;http://www.smalltalk.org</br>
&emsp;http://www.squeak.org</br>
&emsp;http://www.cosc.canterbury.ac.nz/~wolfgang/cosc205/smalltalk1.html</br>
&emsp;http://daitanmarks.sourceforge.net/or/squeak/squeak_tutorial.html</br>
&emsp;http://www.sra.co.jp/people/aoki/htmls/FreeDocumentsForSmalltalk.html</br>
</br>
The Squeak CD-ROM (http://www.squeak.org/Download/SqueakCD) has a whole collection of good Smalltalk tutorials.</br>
</br>
Acknowledgments</br>
</br>
Siren incorporates the work of many people who have contributed ideas and/or code; it would be most unfair not to acknowledge them here. They include:</br>
&emsp;Paul Alderman</br>
&emsp;Alberto de Campo</br>
&emsp;Roger Dannenberg</br>
&emsp;Lounette Dyer</br>
&emsp;Adrian Freed</br>
&emsp;Guy Garnett</br>
&emsp;Kurt Hebel</br>
&emsp;Frode Holm</br>
&emsp;Helge Horch</br>
&emsp;Dan Ingalls</br>
&emsp;Craig Latta</br>
&emsp;David Leibs</br>
&emsp;Mark Lentczner</br>
&emsp;Hitoshi Katta</br>
&emsp;Alex Kouznetsov</br>
&emsp;John Maloney</br>
&emsp;James McCartney</br>
&emsp;Hans-Martin Mosner</br>
&emsp;Luciano Notarfrancesco</br>
&emsp;Danny Oppenheim</br>
&emsp;Nicola Orio</br>
&emsp;Francois Pachet</br>
&emsp;Andreas Raab</br>
&emsp;Chandrasekhar Ramakrishnan</br>
&emsp;Pierre Roy</br>
&emsp;Carla Scaletti</br>
&emsp;Bill Schottstaedt</br>
&emsp;John Tangney</br>
&emsp;Bill Walker</br>
</br>
I must also here acknowledge the generous support of my employers and the academic institutions where this software (and its predecessors) was developed, including CMRS@Mozarteum/Salzburg (1980-85), PCS/Cadmus GmbH in Munich (1983-6), Xerox PARC (1986-89), ParcPlace Systems, Inc. (1988-94), CCRMA@Stanford (1986-92), the STEIM Foundation in Amsterdam (1990-91), the Swedish Institute for Computer Science (1992-93), CMNAT@UC Berkeley (1993-95),  CREATE@UC Santa Barbara (1995-2010), and the Technical University of Berlin (2000).</br>
</br>
Play icons created by Roundicons, Pixel perfect, Gregor Cresnar & Becris - Flaticon - https://www.flaticon.com/free-icons</br>
</p><hr><h3 id="LearningtoReadSmalltalk">39 - Learning to Read Smalltalk</h3>A Note on Reading the Smalltalk-80 Programming Language</br>
</br>
(stp - 12/91)</br>
</br>
Smalltalk-80 is a message-passing object-oriented programming language where expressions are built to be read as English sentences. The language is based on the concepts of objects (software modules that consist of state [data] and behavior [procedures]), that send messages among each other. All data is organized into objects, and all functionality is described as the behaviors of objects. A Smalltalk- 80 application is a network of objects.</br>
</br>
Objects that have similar state and behaviors are grouped into classes (e.g., the class of all whole numbers [integers], or the class of all 2-dimensional Cartesian points). The classes themselves are arranged into a tree-like sub/superclass hierarchy with inheritance of state and behavior from a superclass to its subclasses (e.g., the class of integers might be defined as a subclass of the class of numbers).</br>
</br>
Names and identifiers are separated by white space and are often composed of a concatenated noun phrase written with embedded upper-case letters, e.g., anEvent or MusicMagnitude. </br>
</br>
In a Smalltalk-80 expression, the noun (i.e., the receiver object) comes first, followed by the message; e.g., to ask the size of an array, one sends it the message "size," as in [anArray size]. </br>
</br>
If the message has any arguments, they are separated from the message keywords in that the keywords all end in ":", so to index the first element of the array, one writes [anArray at: 1]; to set it to zero, use [anArray at: 1 put: 0]. </br>
</br>
</br>
Binary operators are allowed for mathematical (+, *, etc.) and logic (>, =, etc) operations.</br>
</br>
Expressions can be nested using parentheses (i.e., evaluate what's inside the inner-most parentheses first), and fancy expression constructs and control structures are possible.</br>
</br>
Expression examples</br>
</br>
&emsp;Unary messages - [receiver message]</br>
&emsp;&emsp;anArray size</br>
&emsp;&emsp;Date today&emsp;&emsp;&emsp;&emsp;"message to a class that answers an instance of that class"</br>
&emsp;&emsp;x negated</br>
</br>
&emsp;Binary messages - [receiver operation operand]</br>
&emsp;&emsp;3 + 4.2215</br>
&emsp;&emsp;x > 7&emsp;&emsp;&emsp;&emsp;&emsp;"answers true or false"</br>
&emsp;&emsp;(a + b) * (c + d)</br>
</br>
&emsp;Keyword messages - [receiver keyword: operand]</br>
&emsp;&emsp;anArray at: 1&emsp;&emsp;&emsp;&emsp;"get an item from an array"</br>
&emsp;&emsp;anArray at: 1 put: 7&emsp;&emsp;"assign into an array"</br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"longer keyword message example"</br>
&emsp;&emsp;aVisualItem displayOn: aMedium at: aPoint clip: aClipRect mask: aMask</br>
&emsp;&emsp;&emsp;&emsp;(messages called  at:put:  or  displayOn:at:clip:mask:)</br>
</br>
Unary expressions can be concatenated, as in,</br>
&emsp;Date today weekday size odd printString</br>
</br>
which answers "true" or "false," as though it were written,</br>
&emsp;((((Date today) weekday) size) odd) printString</br>
</br>
Unary messages bind more strongly than binary messages, as in,</br>
&emsp;3 negated * 4 sqrt&emsp;&emsp;&emsp;"answers -6 "</br>
this is read as</br>
&emsp;(3 negated) * (4 sqrt)</br>
</br>
Keywords bind the weakest, so that the expressions,</br>
</br>
&emsp;Transcript show: aNumber printString, ' is not equal to ', otherNumber printString.</br>
&emsp;anArray at: index + 1 put: 'hello ', ' world'.</br>
&emsp;</br>
are to be read as,</br>
</br>
&emsp;Transcript show: ((aNumber printString), ' is not equal to ', (otherNumber printString)).</br>
&emsp;anArray at: (index + 1) put: ('hello ', ' world').</br>
</br>
A single expression can contain at most one keyword message, i.e., the compiler always tries to build the longest composed keyword message it can find in an expression. For example, to copy an element from one position in an array to another, we would have to parenthesize the 2 keyword messages, as follows,</br>
</br>
&emsp;anArray at: 1 put: (anArray at: 2)</br>
</br>
because without the parentheses, the message would be interpreted as at:put:at: (which is probably not implemented).</br>
</br>
When several messages are to be sent to the same receiver, and the return values are ignored, one can create a message cascade" by separating the messages with semi-colons instead of periods, and not repeating the receiver, as in,</br>
</br>
&emsp;Transcript show: name printString.</br>
&emsp;Transcript cr.</br>
&emsp;</br>
which can be written as a cascade or 2 messages sent to Transcript,</br>
</br>
&emsp;Transcript show: name printString ; cr.</br>
</br>
Comments</br>
</br>
Double-quotes delineate comments in Smalltalk-80 (e.g., "a comment"); single-quotes are used for string objects (e.g., 'a string'). </br>
</br>
Naming</br>
</br>
Most variable and message names start with lower-case letters and may contain embedded upper-case latters (camelCase) as in the examples above.</br>
</br>
Global-scope objects such as namespaces, shared variables and classes are typically capitalized, as in Date, OrderedCollection, or Siren.Sound (a class name in a namespace).</br>
</br>
Names for temporary variables are declared between vertical bars (e.g.,  | varName1 varName2 | ). </br>
</br>
Symbols are special strings that are stored in a table so as to be unique; they are written with the hash-mark "#" as in #blue, meaning "the symbol blue."</br>
</br>
Immediate Object Formats</br>
</br>
&emsp;Integer&emsp;&emsp;&emsp;7&emsp;&emsp;&emsp;&emsp;244361990863443121 </br>
&emsp;Real&emsp;&emsp;&emsp;3.1415926&emsp;&emsp;2.8879044346233</br>
&emsp;Character&emsp;&emsp;$a &emsp;&emsp;&emsp;&emsp;$.</br>
&emsp;String&emsp;&emsp;&emsp;'hi'&emsp;&emsp;&emsp;&emsp;'longer string'</br>
&emsp;Symbol&emsp;&emsp;&emsp;#hi&emsp;&emsp;&emsp;#SymbolicValue</br>
</br>
&emsp;List (Collection)&emsp;&emsp;#(a b c)</br>
&emsp;Association&emsp;&emsp;&emsp;( a -> b)&emsp;&emsp;"key/value tuple"</br>
&emsp;Dictionary (Map)&emsp;(a -> b), (c -> d)&emsp;"like a hash map"</br>
</br>
Logical constants&emsp;true, false, nil</br>
</br>
Control Structures</br>
</br>
Smalltalk supports deferred execution in the form of closures or anonymous functions called blocks; they are written in square brackets "[...]" and can have arguments and/or local temporary variables. </br>
</br>
The up-arrow or caret (^) is used to return values (objects) from within blocks. </br>
</br>
A block that takes two arguments and returns their sum would look like:</br>
&emsp;[ "arguments" :x :y | "body" ^(x + y)].</br>
</br>
Since Boolean objects and blocks are supported, it's easy to define the standard program logical control flow operations such as if/then/else or do/while. Here are examlpes in Smalltalk</br>
</br>
&emsp;(x < 0) ifTrue: [x := x negated]&emsp;&emsp;&emsp;"like if (x < 0) { x = 0 - x; };"</br>
&emsp;&emsp;&emsp;&emsp;</br>
&emsp;(x < 0) ifTrue: [x := x negated]&emsp;&emsp;&emsp;"like if (x < 0) { } else { }"</br>
&emsp;&emsp;&emsp;ifFalse: [x := x - 1]</br>
</br>
For loop: use x to: y do: [block-with-1-argument]</br>
&emsp;1 to: 10 do: [ :index | Transcript show: index printString; cr]</br>
</br>
While loop</br>
&emsp;[x > 0] whileTrue: [Transcript show x printString; cr.  x := x - 1]</br>
</br>
Collection iteration</br>
&emsp;#(1 3 5 7 9) do: [ :item | "block " ]</br>
&emsp;aSet select: [ :item | item > 0 ]</br>
</br>
The format of a method; the browser uses a standard code template for new methods</br>
</br>
&emsp;methodName: argument</br>
&emsp;&emsp;"Comment stating purpose and return value."</br>
</br>
&emsp;&emsp;| tempVarName |</br>
&emsp;&emsp;method body statements.</br>
&emsp;&emsp;^self &emsp;&emsp;&emsp;"some return value"</br>
</br>
Short-hand and Important Messages</br>
</br>
&emsp;#x - the symbol with the name x</br>
</br>
&emsp;#(a b c) - an Array with members a, b, & c</br>
</br>
&emsp;x -> y - an Association (x = key, y = value)</br>
</br>
&emsp;x @ y - a Point with X = x and Y = y</br>
</br>
The Protocol of All Objects</br>
</br>
There are many methods implemented in class Object that are understood by everyong in the system (i.e., you can send them to self in any method).</br>
&emsp;basicAt:, basicAt:Put: - encapsulation-breaking low-level access</br>
&emsp;halt - a breakpoint to get into a debugger</br>
&emsp;inspect - look inside the receiver</br>
&emsp;printString - pretty-print the receiver</br>
&emsp;storeOn: - serialize the receiver on a stream</br>
</br>
All classes understand some useful instance-accessing messages</br>
&emsp;instanceCount - how many of me are there?</br>
&emsp;allInstances - get them all</br>
&emsp;someInstance - pick one</br>
</br>
The Class Library</br>
</br>
Smalltalk includes a rich class library, the main abstractions of which are listed below.</br>
</br>
Magnitudes - understand comparison operators</br>
&emsp;Subclasses like ArithmeticValue, Point, Number, SmallInteger, etc.</br>
&emsp;(arbitrary-precision integers, fractions, meta-numbers)</br>
</br>
Collections - aggregate objects such as arrays and hash maps</br>
&emsp;Set, Dictionary, OrderedCollection, SortedCollection, Array</br>
&emsp;Understand size includes:, do: collect: select:</br>
</br>
Streams - read/write streaming I/O, used for files, sockets, etc.</br>
&emsp;Understand next (read something) and nextPut: (write)</br>
</br>
Model/View/Controller - classes for the MVC design pattern used in GUIs</br>
</br>
Networking and Protocols - Support for formatted streams</br>
</br>
UI Support - ApplicationModel, Dialog</br>
</br>
Compilers - Compiler tools</br>
</br>
Programming</br>
</br>
Smalltalk programs are organized as the behaviors (methods) of classes of objects. To program a graphical application, for example, one might start by adding new methods to the point and 3-D point classes for graphical transformations, and build a family of "smart" visible display objects that know how to present themselves in interesting ways. </br>
</br>
Classes are described as being abstract or concrete depending on whether they are meant as models for refinement within a framework, or for reuse "off the shelf" as in the elements in a tool kit.</br>
</br>
Inheritance means that classes of objects are related in hierarchies (i.e., abstract and concrete classes related in trees), where they share their methods and state variables. This means that the class of 3-D points only has to add the z- coordinate and a few new methods when it's defined as being a specialization (subclass) of the 2-D point class.</br>
</br>
Polymorphism means that many kinds of objects respond to the same message with their own methods to carry out related behavior. Examples are the "play" message being handled by event lists in terms of being passed on to their component events in real-time, or of displayable objects and windows all having methods for the "display" message.</br>
</br>
Inheritance and polymorphism mean that one reads Smalltalk-80 programs by learning the basic protocol (messages/methods) of the abstract classes first; this gives one the feel for the basic behaviors of the systems's objects and applications.</br>
</br>
To actually work in Smalltalk, one generally writes code in browsers, then uses inspectors to create and manipulate objects during testing. One can also write tests and demonstrations as class example methods. There are many browser and debugger features that encourage extreme and exploratory programming. Code generally lives in a database and can be easily shared through the various Internet-based code repositories such as Store or Envy.</br>
</br>
For more info, there are several excellent on-line Smallatlk tutorials (just ask Google), see the reference section of this workbook. The Squeak CD-ROM (http://www.squeak.org/Download/SqueakCD) has a whole collection of good Smalltalk tutorials.</br>
</p><hr><h3 id="ThingsToDo">40 - ThingsToDo</h3>Status</br>
</br>
This is a test release; both the Squeak and Cuis ports are work-in-progress and many features are still to be ported.  See the demo script on page 32 for what works in Siren9C-on-Squeak.</br>
</br>
There are certainly many bugs in Siren.</br>
</br>
Some of the VisualWorks demos don't work any more; sorry.</br>
</br>
The SWIG code for Loris and CSL is no longer supported (sadly).</br>
</br>
The old ManualWriter and ComposedTextEditor packages have disappeared, so the list workbook is single-font.</br>
</br>
The display list views have no notion of pages, so longer musical examples don't display well. We need a fancier document model with page layout.</br>
</br>
There's alot of stale code in the Squeak port that's vestiges of the VisualWorks world, all the displayOn: methods are old, as are all the GUIs that use VisualWorks-style set-up.</br>
</br>
</br>
----</br>
</br>
Bugs - see the test workspace below for the list of what I'm working on.</br>
</br>
</p><hr><h3 id="TestWorkspace">41 - Test Workspace</h3>Test Workspace - stp - 230213</br>
</br>
Known bugs</br>
&emsp;TSV selection update</br>
&emsp;PTV time-region selection(?)</br>
&emsp;DLV selection handles scale with zoom</br>
&emsp;PitchClass octave bugs - (HungarianMinor root: N fa) asPitchesInOctave: 3</br>
&emsp;Ostinato doesn't wait right.</br>
&emsp;Score11 has issues with octaves in chords</br>
&emsp;Score11 has issues with rhythmic repeats (e.g., 6*3)</br>
&emsp;SFSampler leaves notes hanging</br>
&emsp;Workbook should remember selection per-page</br>
&emsp;</br>
ToDo</br>
&emsp;PTV scrolling during play</br>
&emsp;&emsp;Update thread</br>
&emsp;Live note capture to PTV</br>
&emsp;&emsp;Ports/Voices log events to SirenSession</br>
&emsp;MIDI input: kbd & ctrlrs (play into PTV)</br>
&emsp;Function & Sound editors</br>
&emsp;CSL vocoder resynth stage</br>
&emsp;New transport panel</br>
</br>
Post-build testing</br>
</br>
Test plug-ins</br>
</br>
&emsp;CStandardLibrary new abs: -42 </br>
&emsp;FFITestLibrary ffiPrintString: 'Hello' </br>
&emsp;FFITestLibrary ffiTestChars: $A with: 32 with: 0 with: 0</br>
&emsp;FFITestLibrary ffiTestInts: 100 with: 32 with: 0 with: 0 </br>
&emsp;[ExternalAddress loadSymbol: 'pm_initialize' module: PortMIDILibrary moduleName]</br>
&emsp;[ExternalAddress loadSymbol: 'not-there' module: PortMIDILibrary moduleName]</br>
</br>
&emsp;[Undeclared inspect]</br>
&emsp;[Smalltalk garbageCollect]</br>
&emsp;[Utilities openUsefulExpressions]</br>
&emsp;[DirectoryEntry currentDirectory]</br>
&emsp;[DependentsFields]</br>
&emsp;[MIDIPort allNotesOff]</br>
&emsp;[MIDIPort cleanUp]</br>
</br>
New Siren GUI Tools</br>
</br>
&emsp;[SirenSession openUtilityVert]</br>
&emsp;[VoiceDialog open]</br>
</br>
==================================</br>
</br>
Display list view examples</br>
</br>
&emsp;[DisplayListView exampleRectangles]</br>
&emsp;[DisplayRectangle rectangleExample2]&emsp;&emsp;"slow - uses rotated rects"</br>
&emsp;[DisplayListView exampleLines]</br>
&emsp;[DisplayListView examplePolylines]</br>
&emsp;[DisplayListView exampleVisuals]</br>
&emsp;[(DisplayList stringsX: 6000 byY: 10000) display]</br>
&emsp;[DisplayListView exampleMixed]&emsp;&emsp;"huge display list - takes a while"</br>
&emsp;[DisplayList exampleHierarchical display]</br>
</br>
&emsp;Display the old and new glyph catalogs</br>
</br>
&emsp;[DisplayVisual displayMusicConstants]&emsp;&emsp;</br>
&emsp;[DisplayVisual displayMusicGlyphs]&emsp;</br>
</br>
Music notation demos</br>
</br>
&emsp;[TimeSequenceView randomExample]</br>
&emsp;[PitchTimeView randomExample]</br>
&emsp;[PitchTimeView randomExample2]</br>
&emsp;[EventList randomSWSSExample2 editPTV]</br>
&emsp;[HauerSteffensView randomExampleQ]</br>
&emsp;[HauerSteffensView cloudExample]</br>
&emsp;[HauerSteffensView cloudsExample]</br>
&emsp;[HauerSteffensView cloudsExample2]</br>
&emsp;[DynamicCloud focusExample]</br>
&emsp;[HauerSteffensView scaleExample]</br>
&emsp;[HauerSteffensView scaleExample2]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[PitchTimeView openOnEventList: EventList randomExample</br>
&emsp;&emsp;&emsp;&emsp;label: 'P T V' pianoRoll: true]</br>
&emsp;[EventList accellExample open]</br>
</br>
Advanced Event Generators</br>
</br>
&emsp;[(Peal on: #(60 62 64 65) duration: (1/8) beat) eventList editPTV]</br>
&emsp;[Arpeggio example1]&emsp;&emsp; "Plays midi"</br>
</br>
&emsp;[Score11 melody1]</br>
&emsp;[ExtDynamicSelectionCloud chordExample]</br>
&emsp;[ExtDynamicSelectionCloud chordExample2]</br>
</br>
Random walks in several flavors</br>
</br>
&emsp;[Walk example1 editPTV]</br>
&emsp;[Walk example2 editPTV]</br>
&emsp;[Walk example3 editPTV]</br>
</br>
Function views</br>
</br>
&emsp;[Function functionViewExample]</br>
&emsp;[FunctionView multiFunctionExample]</br>
&emsp;[FunctionView onFunctions: (Function fromFile: 'G1.2a1.env')]</br>
</br>
--------------------------</br>
</br>
Roll timing tests - compare jitter on synth-sound, MIDI, OSC-synth and OSC-sampler</br>
</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList asSoundScore play]</br>
</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList playOn: MIDIVoice default]</br>
</br>
&emsp;[((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList </br>
&emsp;&emsp;&emsp;&emsp;playOn: (OSCVoice pMap: #pMapForCSLPluck: range: (1 to: 10))]</br>
&emsp;&emsp;&emsp;</br>
&emsp;[ | vox |</br>
&emsp;vox := OSCVoice pMap: #pMapForCSLSFSampler: range: (68 to: 75).</br>
&emsp;vox send: '/i68/fi' args: (Array with: SirenUtility cslDir, 'vibra.sf2').</br>
&emsp;((Roll length: 6 sec rhythm: 60 note: 72) ampl: 100) eventList playOn: vox]</br>
</br>
----</br>
</br>
MIDI Tests</br>
</br>
&emsp;[PortMIDILibrary pm_count_devices ]</br>
&emsp;[PortMIDILibrary pm_default_input_device ] </br>
&emsp;[PortMIDILibrary pm_default_output_device ] </br>
&emsp;PortMIDILibrary pm_test: PortMIDILibrary new pm_default_output_device </br>
&emsp;[PortMIDIPort listDeviceTable]</br>
&emsp;[PortMIDILibrary testAllNotes]</br>
&emsp;[ExternalLibrary clearAllCaches.]</br>
&emsp;[PortMIDILibrary pm_terminate]</br>
&emsp;[MIDIVoice scaleExample]</br>
&emsp;[MIDIVoice randomExample]</br>
</br>
Various verbose MIDIVoice creation methods</br>
</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice defaultOut: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Kontakt' channel: 3)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice onDeviceNamed: 'Nord' channel: 1)]</br>
&emsp;[EventList scaleExample1 playOn: (MIDIVoice on: </br>
&emsp;&emsp;&emsp;(MIDIDevice </br>
&emsp;&emsp;&emsp;&emsp;outOn: (PortMIDIPort indexOfOutNamed: '*Kontakt*') </br>
&emsp;&emsp;&emsp;&emsp;port: MIDIPort concreteClass default) </br>
&emsp;&emsp;&emsp;channel: 3)]</br>
&emsp;[PortMIDIPort streams]</br>
&emsp;[EventList multiVoiceExample playOn: MIDIVoice default]</br>
</br>
OSC Tests</br>
</br>
&emsp;Default CSL Synthesis Server Instruments (see CSL7/Src/IO/OSC_main.cpp)</br>
</br>
&emsp;1 - 10 ---- 10 plucked strings</br>
&emsp;&emsp; "fff" - amp, pitch, pos</br>
&emsp;11 - 20 ---- 10 FM instruments</br>
&emsp;&emsp;"ffff" - dur amp pitch pos</br>
&emsp;&emsp;"ffffff" - dur, ampl, c_fr, m_fr, ind, pos</br>
&emsp;21 - 30 ---- 10 FM bells</br>
&emsp;&emsp; "fffffff" - dur, ampl, pitch,  gliss, rat,  ind,  pos</br>
&emsp;31 - 34 ---- 4 sound files (words)</br>
&emsp;&emsp;"ff" - amp, pos</br>
&emsp;35 - 50 ---- 16 SHARC SOS voices (different instruments)</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;51 - 55 ---- 5 basic SHARC-spectrum instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;56 - 61 ---- 5 SHARC-instrument additive cross-fade instruments w vibrato</br>
&emsp;&emsp;dur, ampl, pitch, pos</br>
&emsp;&emsp;dur, ampl, pitch, pos, att, dec, sus, rel</br>
&emsp;62 - 63 ---- 2 granular scramblers</br>
&emsp;&emsp;dur, ampl</br>
&emsp;64 - 67 ---- 4 granular shifters</br>
&emsp;&emsp;dur, ampl</br>
&emsp;68-75 ---- 8 SoundFont sample players</br>
&emsp;&emsp;"fffff" - dur, chan, key, ampl, pos</br>
&emsp;&emsp;"s" - load sound file given full file name (cmd 156 = set_file_f)</br>
</br>
&emsp;[EventScheduler interrupt; flush]</br>
&emsp;[OSCVoice fmExample1]</br>
&emsp;[OSCVoice fmExample2]</br>
&emsp;[OSCVoice pluckExample1]</br>
&emsp;[OSCVoice sndExample1]</br>
&emsp;[OSCVoice sndExample2]</br>
&emsp;[OSCVoice sharcExample1]</br>
&emsp;[OSCVoice bellExample1]</br>
&emsp;[OSCVoice vSOSExample1]</br>
&emsp;[OSCVoice granulatorExample1]</br>
&emsp;[OSCVoice granulatorExample2: 1]</br>
</br>
SoundFont Sampler tests</br>
</br>
&emsp;[OSCVoice samplerExample1]</br>
&emsp;[OSCVoice samplerExample2]</br>
&emsp;[OSCVoice samplerExample3]</br>
&emsp;[OSCVoice samplerExample3Menu]</br>
&emsp;[OSCVoice samplerExample4]</br>
</br>
SndSynth Tests</br>
</br>
&emsp;[(ScorePlayerMorph new openMIDIFile) openInWorld</br>
&emsp; onMIDIFileNamed: '/Users/stp/Code/Smalltalk/Siren9C/Data/jerusalm.mid') open]</br>
</br>
</br>
----------------------------------------------------------------------------</br>
----------------------------------------------------------------------------</br>
</br>
Music Font debugging</br>
</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) browseAllGlyphs]</br>
&emsp;&emsp;&emsp;&emsp;</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E1D0 to: 16r00E1E7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00ECA0 to: 16r00ECB7]</br>
[((StrikeFont familyName: 'Bravura' size: 100) asPointSize: 100) displayGlyphsFrom: 16r00E0A0 to: 16r00E0FC]</br>
</br>
[(((StrikeFont familyName: 'Bravura' size: 100) pointSize: 100) characterFormAtCode: 16r00E1D2) </br>
&emsp;&emsp;displayOn: Display at: (256@256) clippingBox: Display boundingBox </br>
&emsp;&emsp;rule: Form paint fillColor: Color black]</br>
</br>
[DisplayListView loadNoteGlyphsFromFontSized: 100]"&emsp;"load music icons from the font"</br>
DisplayVisual displayMusicGlyphs</br>
</br>
</br>
(((DisplayListView glyphs at: #StdNoteIcons) at: '1' asSymbol) image image) bitEdit</br>
Offsets:</br>
&emsp;1/1 -> 6 @ 66</br>
&emsp;1/2 -> 5 @ 66</br>
(((DisplayListView glyphs at: #OtherNoteIcons) at: '4' asSymbol) image image) bitEdit</br>
&emsp;Offsets (5 @ 45)</br>
</br>
----</br>
Threads</br>
</br>
[ | i | i := 0.</br>
&emsp;[[i < 10] whileTrue:</br>
&emsp;[Transcript show: i printString; cr.</br>
&emsp;(Delay forSeconds: 1) wait.</br>
&emsp;i := i + 1]] fork]</br>
----</br>
Loading transport icons</br>
</br>
[ | folder |</br>
&emsp;DisplayListView glyphs at: #Transport put: Dictionary new.</br>
&emsp;folder := (FileDirectory default directoryNamed: </br>
&emsp;&emsp;&emsp;&emsp;'Siren9C/Data/Fonts/transport_icons') name, '/'.</br>
&emsp;((FileDirectory on: folder) fileNamesMatching: '*.png') do:</br>
&emsp;[ :jpg | | form |</br>
&emsp;form := (Form fromFileNamed: folder, jpg).</br>
&emsp;form := form scaledToSize: 16 @ 16.</br>
&emsp;(DisplayListView glyphs at: #Transport) at: (jpg copyUpTo: $.) asSymbol put: form]]</br>
</br>
[ | gly right down left up |</br>
gly := DisplayListView glyphs at: #Transport.</br>
right := gly at: #'right-arrow'.</br>
down := right rotateBy: #right centerAt: 0@0.</br>
left := right rotateBy: #pi centerAt: 0@0.</br>
up := right rotateBy: #left centerAt: 0@0.</br>
gly at: #'down-arrow' put: down.</br>
gly at: #'left-arrow' put: left.</br>
gly at: #'up-arrow' put: up.</br>
</br>
right := gly at: #'fast-forward'.</br>
down := right rotateBy: #pi centerAt: 0@0.</br>
gly at: #'rewind' put: down.</br>
</br>
]</br>
</br>
[(DisplayListView glyphs at: #Transport) explore]</br>
</br>
[DisplayListView loadNoteGlyphsFrom: 16r00E1D0 to: 16r00E1E7</br>
&emsp;&emsp;keys: #('2' '4' '1' '1/2' '1/2d' '1/4' '1/4d' '1/8' '1/8d' '1/16' '1/16d' '1/32' '1/32d'  '1/64' '1/64d' )</br>
&emsp;&emsp;into: #StdNoteIcons.</br>
DisplayListView shrinkGlyphs.</br>
DisplayListView tweakGlyphs]</br>
</br>
[DisplayVisual displayMusicGlyphs: #StdNoteIcons]</br>
[HauerSteffensView scaleExample]</br>
[HauerSteffensView scaleExample2]</br>
[EventList accellExample edit]</br>
</br>
----</br>
</br>
</p><hr><h3 id="Sketches">42 - Sketches</h3>Sketches for Sleeping Sword</br>
</br>
Tympani - 3 swells</br>
&emsp;</br>
&emsp;[[ | swell |</br>
&emsp;swell := [ :dur :pit :rhy | | el |</br>
&emsp;el := ((Roll length: dur sec rhythm: rhy note: pit) ampl: 100; inst: '/i4/pn') </br>
&emsp;&emsp;&emsp;eventList scaleDurationsBy: 8.0.</br>
&emsp;el applyFunction: (LinearFunction from: #((0 0.2) (1 1))) to: #loudness.</br>
&emsp;OSCVoice play4vSampler: el].</br>
&emsp;swell value: 6 value: 60 value: 80.</br>
&emsp;6 sec wait.</br>
&emsp;swell value: 6 value: 58 value: 80.</br>
&emsp;6 sec wait.</br>
&emsp;swell value: 10 value: 56 value: 90] fork]</br>
</br>
String clouds - cresc./decresc.</br>
</br>
&emsp;[[ | du base |</br>
&emsp;base := 0.005.</br>
&emsp;10 timesRepeat:</br>
&emsp;&emsp;[du := OSCVoice pluckExample1: (base to: base * 2).</br>
&emsp;&emsp;du wait.</br>
&emsp;&emsp;base := base + 0.007].</br>
&emsp;10 timesRepeat:</br>
&emsp;&emsp;[du := OSCVoice pluckExample1: (base to: base * 2).</br>
&emsp;&emsp;du wait.</br>
&emsp;&emsp;base := base - 0.007]] fork]</br>
</br>
Granular drone surface</br>
</br>
&emsp;[[OSCVoice granulatorExample2: 1] fork]</br>
&emsp;[[OSCVoice granulatorExample2: 2] fork]</br>
&emsp;[[OSCVoice granulatorExample2: 3] fork]</br>
</br>
Low strings and bells</br>
&emsp;</br>
&emsp;[[OSCVoice bellExample2] fork]</br>
&emsp;[OSCVoice fmExample4]&emsp;&emsp;&emsp;runs until the scheduler is stopped</br>
</br>
Bursts of garbled speak'n'spell</br>
</br>
&emsp;[[OSCVoice granulatorExample1] fork]</br>
</br>
Score11 examples</br>
</br>
&emsp;[[Score11 sleepingSword1] fork]</br>
&emsp;[[Score11 sleepingSword2] fork]</br>
&emsp;[[Score11 sleepingSword3] fork]</br>
</br>
Random walks</br>
</br>
&emsp;[[OSCVoice play4vSampler: </br>
&emsp;&emsp;&emsp;&emsp;(Walk len: 60 dur0: 0.15 pitch0: 72 vel0: 80) eventList] fork]</br>
&emsp;[[OSCVoice play4vSampler: </br>
&emsp;&emsp;&emsp;&emsp;(Walk len: 80 pitchSet: #(76 78 81 83) durSet: #(0.1 0.1 0.2) vel: 70)] fork]</br>
&emsp;[[OSCVoice playCSLPlucks: (Walk len: 120 durN: 0.15 pitch0: 72 vel0: 48)] fork]</br>
&emsp;[[OSCVoice play4vSampler: &emsp;&emsp;"tymp"</br>
&emsp;&emsp;&emsp;&emsp;((Walk len: 40 dur0: 2.0 pitch0: 44 vel0: 80) inst: '/i4/pn') eventList] fork]</br>
&emsp;[[(Walk len: 40 dur0: 1.0 pitch0: 64 vel0: 80) eventList playOn: (MIDIVoice defaultOut: 11)] fork]</br>
&emsp;[[(Walk len: 40 dur0: 1.0 pitch0: 64 vel0: 80) eventList playOn: (MIDIVoice defaultOut: 12)] fork]</br>
</br>
Bell peals on MIDI glockenspiel or FM bells</br>
</br>
&emsp;[(((Peal on: #(72 74 76 77)) eventList) setAll: #loudness to: 40 vel) playOn: (MIDIVoice defaultOut: 4)]</br>
&emsp;[(((Peal on: #(72 74 76 77)) eventList) setAll: #loudness to: 80 vel) playOn: (MIDIVoice defaultOut: 3)]</br>
&emsp;[OSCVoice playCSLPlucks: (((Peal on: #(70 72 74 76 77)) eventList) setAll: #loudness to: 30 vel)]</br>
</br>
Arpeggii - assumes a MIDI synth with instruments 3 and 4 panned L/R</br>
</br>
[[&emsp;| scales roots |</br>
&emsp;scales := { HungarianMinor . Oriental . PentatonicScale . </br>
&emsp;&emsp;&emsp;&emsp;ChromaticScale . MelodicMinorScale . MajorScale}.</br>
&emsp;roots := { N do . N mi . N fa . N la}.</br>
&emsp;1 to: 20 do: </br>
&emsp;&emsp;[ :ind | | sca rt ar1 ar2 |</br>
&emsp;&emsp;sca := scales atRandom.</br>
&emsp;&emsp;rt := roots atRandom.</br>
&emsp;&emsp;ar1 := Arpeggio onScale: (sca root: rt) fromOct: 3 toOct: 5 drop: 25 delay: 80 loud: 80.</br>
&emsp;&emsp;ar2  := Arpeggio onScale: (sca root: rt) fromOct: 3 toOct: 5 drop: 25 delay: 85 loud: 40.</br>
&emsp;&emsp;ar1 playOn: (MIDIVoice defaultOut: 3). </br>
&emsp;&emsp;(Delay forMilliseconds: 25) wait.</br>
&emsp;&emsp;ar2 playOn: (MIDIVoice defaultOut: 4).</br>
&emsp;&emsp;(Delay forMilliseconds: (ar1 duration asMsec value) +  250) wait ] ] fork]</br>
</br>
</p></p><HR><p>